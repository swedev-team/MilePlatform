(function(e,t){e.ui=e.ui||{};var n,i=Math.max,r=Math.abs,o=Math.round,s=/left|center|right/,a=/top|center|bottom/,l=/[\+\-]\d+%?/,u=/^\w+/,c=/%$/,d=e.fn.position;function f(e,t,n){return[parseInt(e[0],10)*(c.test(e[0])?t/100:1),parseInt(e[1],10)*(c.test(e[1])?n/100:1)]}function p(t,n){return parseInt(e.css(t,n),10)||0}function h(t){var n=t[0];if(n.nodeType===9){return{width:t.width(),height:t.height(),offset:{top:0,left:0}}}if(e.isWindow(n)){return{width:t.width(),height:t.height(),offset:{top:t.scrollTop(),left:t.scrollLeft()}}}if(n.preventDefault){return{width:0,height:0,offset:{top:n.pageY,left:n.pageX}}}return{width:t.outerWidth(),height:t.outerHeight(),offset:t.offset()}}e.position={scrollbarWidth:function(){if(n!==t){return n}var i,r,o=e("<div style='display:block;width:50px;height:50px;overflow:hidden;'><div style='height:100px;width:auto;'></div></div>"),s=o.children()[0];e("body").append(o);i=s.offsetWidth;o.css("overflow","scroll");r=s.offsetWidth;if(i===r){r=o[0].clientWidth}o.remove();return n=i-r},getScrollInfo:function(t){var n=t.isWindow?"":t.element.css("overflow-x"),i=t.isWindow?"":t.element.css("overflow-y"),r=n==="scroll"||n==="auto"&&t.width<t.element[0].scrollWidth,o=i==="scroll"||i==="auto"&&t.height<t.element[0].scrollHeight;return{width:r?e.position.scrollbarWidth():0,height:o?e.position.scrollbarWidth():0}},getWithinInfo:function(t){var n=e(t||window),i=e.isWindow(n[0]);return{element:n,isWindow:i,offset:n.offset()||{left:0,top:0},scrollLeft:n.scrollLeft(),scrollTop:n.scrollTop(),width:i?n.width():n.outerWidth(),height:i?n.height():n.outerHeight()}}};e.fn.position=function(t){if(!t||!t.of){return d.apply(this,arguments)}t=e.extend({},t);var n,c,q,g,m,_,v=e(t.of),b=e.position.getWithinInfo(t.within),y=e.position.getScrollInfo(b),S=(t.collision||"flip").split(" "),w={};_=h(v);if(v[0].preventDefault){t.at="left top"}c=_.width;q=_.height;g=_.offset;m=e.extend({},g);e.each(["my","at"],function(){var e=(t[this]||"").split(" "),n,i;if(e.length===1){e=s.test(e[0])?e.concat(["center"]):a.test(e[0])?["center"].concat(e):["center","center"]}e[0]=s.test(e[0])?e[0]:"center";e[1]=a.test(e[1])?e[1]:"center";n=l.exec(e[0]);i=l.exec(e[1]);w[this]=[n?n[0]:0,i?i[0]:0];t[this]=[u.exec(e[0])[0],u.exec(e[1])[0]]});if(S.length===1){S[1]=S[0]}if(t.at[0]==="right"){m.left+=c}else if(t.at[0]==="center"){m.left+=c/2}if(t.at[1]==="bottom"){m.top+=q}else if(t.at[1]==="center"){m.top+=q/2}n=f(w.at,c,q);m.left+=n[0];m.top+=n[1];return this.each(function(){var s,a,l=e(this),u=l.outerWidth(),d=l.outerHeight(),h=p(this,"marginLeft"),_=p(this,"marginTop"),C=u+h+p(this,"marginRight")+y.width,E=d+_+p(this,"marginBottom")+y.height,x=e.extend({},m),F=f(w.my,l.outerWidth(),l.outerHeight());if(t.my[0]==="right"){x.left-=u}else if(t.my[0]==="center"){x.left-=u/2}if(t.my[1]==="bottom"){x.top-=d}else if(t.my[1]==="center"){x.top-=d/2}x.left+=F[0];x.top+=F[1];if(!e.support.offsetFractions){x.left=o(x.left);x.top=o(x.top)}s={marginLeft:h,marginTop:_};e.each(["left","top"],function(i,r){if(e.ui.position[S[i]]){e.ui.position[S[i]][r](x,l,{targetWidth:c,targetHeight:q,elemWidth:u,elemHeight:d,collisionPosition:s,collisionWidth:C,collisionHeight:E,offset:[n[0]+F[0],n[1]+F[1]],my:t.my,at:t.at,within:b,elem:l})}});if(t.using){a=function(e){var n=g.left-x.left,o=n+c-u,s=g.top-x.top,a=s+q-d,f={target:{element:v,left:g.left,top:g.top,width:c,height:q},element:{element:l,left:x.left,top:x.top,width:u,height:d},horizontal:o<0?"left":n>0?"right":"center",vertical:a<0?"top":s>0?"bottom":"middle"};if(c<u&&r(n+o)<c){f.horizontal="center"}if(q<d&&r(s+a)<q){f.vertical="middle"}if(i(r(n),r(o))>i(r(s),r(a))){f.important="horizontal"}else{f.important="vertical"}t.using.call(this,e,f)}}l.offset(e.extend(x,{using:a}))})};e.ui.position={fit:{left:function(e,t,n){var r=n.within,o=r.isWindow?r.scrollLeft:r.offset.left,s=r.width,a=e.left-n.collisionPosition.marginLeft,l=o-a,u=a+n.collisionWidth-s-o,c;if(n.collisionWidth>s){if(l>0&&u<=0){c=e.left+l+n.collisionWidth-s-o;e.left+=l-c}else if(u>0&&l<=0){e.left=o}else{if(l>u){e.left=o+s-n.collisionWidth}else{e.left=o}}}else if(l>0){e.left+=l}else if(u>0){e.left-=u}else{e.left=i(e.left-a,e.left)}},top:function(e,t,n){var r=n.within,o=r.isWindow?r.scrollTop:r.offset.top,s=n.within.height,a=e.top-n.collisionPosition.marginTop,l=o-a,u=a+n.collisionHeight-s-o,c;if(n.collisionHeight>s){if(l>0&&u<=0){c=e.top+l+n.collisionHeight-s-o;e.top+=l-c}else if(u>0&&l<=0){e.top=o}else{if(l>u){e.top=o+s-n.collisionHeight}else{e.top=o}}}else if(l>0){e.top+=l}else if(u>0){e.top-=u}else{e.top=i(e.top-a,e.top)}}},flip:{left:function(e,t,n){var i=n.within,o=i.offset.left+i.scrollLeft,s=i.width,a=i.isWindow?i.scrollLeft:i.offset.left,l=e.left-n.collisionPosition.marginLeft,u=l-a,c=l+n.collisionWidth-s-a,d=n.my[0]==="left"?-n.elemWidth:n.my[0]==="right"?n.elemWidth:0,f=n.at[0]==="left"?n.targetWidth:n.at[0]==="right"?-n.targetWidth:0,p=-2*n.offset[0],h,q;if(u<0){h=e.left+d+f+p+n.collisionWidth-s-o;if(h<0||h<r(u)){e.left+=d+f+p;t.trigger("position.horizontal.flip")}}else if(c>0){q=e.left-n.collisionPosition.marginLeft+d+f+p-a;if(q>0||r(q)<c){e.left+=d+f+p;t.trigger("position.horizontal.flip")}}},top:function(e,t,n){var i=n.within,o=i.offset.top+i.scrollTop,s=i.height,a=i.isWindow?i.scrollTop:i.offset.top,l=e.top-n.collisionPosition.marginTop,u=l-a,c=l+n.collisionHeight-s-a,d=n.my[1]==="top",f=d?-n.elemHeight:n.my[1]==="bottom"?n.elemHeight:0,p=n.at[1]==="top"?n.targetHeight:n.at[1]==="bottom"?-n.targetHeight:0,h=-2*n.offset[1],q,g;if(u<0){g=e.top+f+p+h+n.collisionHeight-s-o;if(e.top+f+p+h>u&&(g<0||g<r(u))){e.top+=f+p+h;t.trigger("position.vertical.flip")}}else if(c>0){q=e.top-n.collisionPosition.marginTop+f+p+h-a;if(e.top+f+p+h>c&&(q>0||r(q)<c)){e.top+=f+p+h;t.trigger("position.vertical.flip")}}}},flipfit:{left:function(){e.ui.position.flip.left.apply(this,arguments);e.ui.position.fit.left.apply(this,arguments)},top:function(){e.ui.position.flip.top.apply(this,arguments);e.ui.position.fit.top.apply(this,arguments)}}};(function(){var t,n,i,r,o,s=document.getElementsByTagName("body")[0],a=document.createElement("div");t=document.createElement(s?"div":"body");i={visibility:"hidden",width:0,height:0,border:0,margin:0,background:"none"};if(s){e.extend(i,{position:"absolute",left:"-1000px",top:"-1000px"})}for(o in i){t.style[o]=i[o]}t.appendChild(a);n=s||document.documentElement;n.insertBefore(t,n.firstChild);a.style.cssText="position: absolute; left: 10.7432222px;";r=e(a).offset().left;e.support.offsetFractions=r>10&&r<11;t.innerHTML="";n.removeChild(t)})()})(jQuery);jQuery.migrationFixPosition=function(e){var t,n,i,r;function o(e){if(e[0]!=="-"&&e[0]!=="+"){e="+"+e}return e}if(!e){return e}if($().jquery.indexOf("1.7")>=0||$().jquery.indexOf("1.8")>=0){return e}t=e.at;n=e.offset;if(!n){return e}if(!t){return e}i=t.split(" ");r=n.split(" ");if(r.length){r[0]=o(r[0])}if(r.length>1){r[1]=o(r[1])}e.at=i[0]+r[0]+" "+i[1]+r[1];return e};var Mustache=typeof module!=="undefined"&&module.exports||{};(function(e){e.name="mustache.js";e.version="0.5.0-dev";e.tags=["<%","%>"];e.parse=m;e.compile=y;e.render=S;e.clearCache=b;e.to_html=function(e,t,n,i){var r=S(e,t,n);if(typeof i==="function"){i(r)}else{return r}};var t=Object.prototype.toString;var n=Array.isArray;var i=Array.prototype.forEach;var r=String.prototype.trim;var o;if(n){o=n}else{o=function(e){return t.call(e)==="[object Array]"}}var s;if(i){s=function(e,t,n){return i.call(e,t,n)}}else{s=function(e,t,n){for(var i=0,r=e.length;i<r;++i){t.call(n,e[i],i,e)}}}var a=/^\s*$/;function l(e){return a.test(e)}var u;if(r){u=function(e){return e==null?"":r.call(e)}}else{var c,d;if(l("\xa0")){c=/^\s+/;d=/\s+$/}else{c=/^[\s\xA0]+/;d=/[\s\xA0]+$/}u=function(e){return e==null?"":String(e).replace(c,"").replace(d,"")}}var f={"&":"&amp;","<":"&lt;",">":"&gt;",'"':"&quot;","'":"&#39;"};function p(e){return String(e).replace(/&(?!\w+;)|[<>"']/g,function(e){return f[e]||e})}function h(e,t,n,i){i=i||"<template>";var r=t.split("\n"),o=Math.max(n-3,0),s=Math.min(r.length,n+3),a=r.slice(o,s);var l;for(var u=0,c=a.length;u<c;++u){l=u+o+1;a[u]=(l===n?" >> ":"    ")+a[u]}e.template=t;e.line=n;e.file=i;e.message=[i+":"+n,a.join("\n"),"",e.message].join("\n");return e}function q(e,t,n){if(e==="."){return t[t.length-1]}var i=e.split(".");var r=i.length-1;var o=i[r];var s,a,l=t.length,u,c;while(l){c=t.slice(0);a=t[--l];u=0;while(u<r){a=a[i[u++]];if(a==null){break}c.push(a)}if(a&&typeof a==="object"&&o in a){s=a[o];break}}if(typeof s==="function"){s=s.call(c[c.length-1])}if(s==null){return n}return s}function g(e,t,n,i){var r="";var a=q(e,t);if(i){if(a==null||a===false||o(a)&&a.length===0){r+=n()}}else if(o(a)){s(a,function(e){t.push(e);r+=n();t.pop()})}else if(typeof a==="object"){t.push(a);r+=n();t.pop()}else if(typeof a==="function"){var l=t[t.length-1];var u=function(e){return S(e,l)};r+=a.call(l,n(),u)||""}else if(a){r+=n()}return r}function m(t,n){n=n||{};var i=n.tags||e.tags,r=i[0],o=i[i.length-1];var s=['var buffer = "";',"\nvar line = 1;","\ntry {",'\nbuffer += "'];var a=[],c=false,d=false;var f=function(){if(c&&!d&&!n.space){while(a.length){s.splice(a.pop(),1)}}else{a=[]}c=false;d=false};var p=[],q,g,m;var _=function(e){i=u(e).split(/\s+/);g=i[0];m=i[i.length-1]};var v=function(e){s.push('";',q,'\nvar partial = partials["'+u(e)+'"];',"\nif (partial) {","\n  buffer += render(partial,stack[stack.length - 1],partials);","\n}",'\nbuffer += "')};var b=function(e,i){var r=u(e);if(r===""){throw h(new Error("Section name may not be empty"),t,E,n.file)}p.push({name:r,inverted:i});s.push('";',q,'\nvar name = "'+r+'";',"\nvar callback = (function () {","\n  return function () {",'\n    var buffer = "";','\nbuffer += "')};var y=function(e){b(e,true)};var S=function(e){var i=u(e);var r=p.length!=0&&p[p.length-1].name;if(!r||i!=r){throw h(new Error('Section named "'+i+'" was never opened'),t,E,n.file)}var o=p.pop();s.push('";',"\n    return buffer;","\n  };","\n})();");if(o.inverted){s.push("\nbuffer += renderSection(name,stack,callback,true);")}else{s.push("\nbuffer += renderSection(name,stack,callback);")}s.push('\nbuffer += "')};var w=function(e){s.push('";',q,'\nbuffer += lookup("'+u(e)+'",stack,"");','\nbuffer += "')};var C=function(e){s.push('";',q,'\nbuffer += escapeHTML(lookup("'+u(e)+'",stack,""));','\nbuffer += "')};var E=1,x,F;for(var P=0,T=t.length;P<T;++P){if(t.slice(P,P+r.length)===r){P+=r.length;x=t.substr(P,1);q="\nline = "+E+";";g=r;m=o;c=true;switch(x){case"!":P++;F=null;break;case"=":P++;o="="+o;F=_;break;case">":P++;F=v;break;case"#":P++;F=b;break;case"^":P++;F=y;break;case"/":P++;F=S;break;case"{":o="}"+o;case"&":P++;d=true;F=w;break;default:d=true;F=C}var A=t.indexOf(o,P);if(A===-1){throw h(new Error('Tag "'+r+'" was not closed properly'),t,E,n.file)}var U=t.substring(P,A);if(F){F(U)}var I=0;while(~(I=U.indexOf("\n",I))){E++;I++}P=A+o.length-1;r=g;o=m}else{x=t.substr(P,1);switch(x){case'"':case"\\":d=true;s.push("\\"+x);break;case"\r":break;case"\n":a.push(s.length);s.push("\\n");f();E++;break;default:if(l(x)){a.push(s.length)}else{d=true}s.push(x)}}}if(p.length!=0){throw h(new Error('Section "'+p[p.length-1].name+'" was not closed properly'),t,E,n.file)}f();s.push('";',"\nreturn buffer;","\n} catch (e) { throw {error: e, line: line}; }");var D=s.join("").replace(/buffer \+= "";\n/g,"");if(n.debug){if(typeof console!="undefined"&&console.log){console.log(D)}else if(typeof print==="function"){print(D)}}return D}function _(e,t){var n="view,partials,stack,lookup,escapeHTML,renderSection,render";var i=m(e,t);var r=new Function(n,i);return function(n,i){i=i||{};var o=[n];try{return r(n,i,o,q,p,g,S)}catch(n){throw h(n.error,e,n.line,t.file)}}}var v={};function b(){v={}}function y(e,t){t=t||{};if(t.cache!==false){if(!v[e]){v[e]=_(e,t)}return v[e]}return _(e,t)}function S(e,t,n){return y(e)(t,n)}})(Mustache);var SM;if(typeof module==="object"&&module.exports&&typeof require==="function"){SM=require("../SM")}SM.Html={rtagName:/<([\w:]+)/,rhtml:/<|&#?\w+;/,rxhtmlTag:/<(?!area|br|col|embed|hr|img|input|link|meta|param)(([\w:]+)[^>]*)\/>/gi,wrapMap:{option:[1,'<select multiple="multiple">',"</select>"],legend:[1,"<fieldset>","</fieldset>"],thead:[1,"<table>","</table>"],tr:[2,"<table><tbody>","</tbody></table>"],td:[3,"<table><tbody><tr>","</tr></tbody></table>"],col:[2,"<table><tbody></tbody><colgroup>","</colgroup></table>"],area:[1,"<map>","</map>"],_default:[0,"",""]},support:{},tagRexExes:{},safeFrag:null,init:function(){this._featureTest();this._extendWrapMap();this.safeFrag=document.createDocumentFragment()},hasTag:function(e,t){return!!this.findFirstTag(e,t)},findFirstTag:function(e,t){var n;t=t.toLowerCase();if(!this.tagRexExes[t]){this.tagRexExes[t]=new RegExp("<"+t+"\\s+(.*?)[^<]\\/?>","i")}n=this.tagRexExes[t].exec(e);return n?n[0]:null},getFirstTagName:function(e){return(this.rtagName.exec(e)||["",""])[1].toLowerCase()},removeExternalAttributes:function(e){return e.replace(/\s+(src|href)=/gi," data-src=")},strip:function(e,t){var n,i,r;if(!e){return""}if(t===undefined){t=true}n=document.createElement("div");e=this.removeExternalAttributes(e);n.innerHTML=e;r=n.textContent||n.innerText;if(t){while(r!==n.innerHTML&&r!==i){i=r;n.innerHTML=r;r=n.textContent||n.innerText}}return r===null||r===undefined?"":r},has:function(e){return this.rhtml.test(e)},parse:function(e){var t,n,i,r,o,s,a,l,u,c,d=[];if(!e||typeof e!=="string"){return[]}if(!this.has(e)){return[document.createTextNode(e)]}n=this.safeFrag;t=n.appendChild(document.createElement("div"));e=e.replace(this.rxhtmlTag,"<$1></$2>");i=this.getFirstTagName(e);r=this.wrapMap[i]||this.wrapMap._default;o=r[0];t.innerHTML=r[1]+e+r[2];while(o--){t=t.lastChild}if(!this.tbodySupport){s=this.hasTag(e,"tbody");if(i==="table"&&!s){a=t.firstChild&&t.firstChild.childNodes}else if(r[1]==="<table>"&&!s){a=t.childNodes}else{a=[]}for(u=a.length-1;u>=0;--u){l=a[u];if(l.nodeName&&l.nodeName.toUpperCase()==="tbody".toUpperCase()&&!l.childNodes.length){l.parentNode.removeChild(l)}}}e=t.childNodes;c=e.length;for(u=0;u<c;u++){d[u]=e[u]}t=n.lastChild;n.removeChild(t);e=t=n=null;return d},_featureTest:function(){var e=document.createElement("div");e.innerHTML="<link/><table></table>";this.support.htmlSerialize=!!e.getElementsByTagName("link").length;this.support.tbody=!e.getElementsByTagName("tbody").length},_extendWrapMap:function(){var e=this.wrapMap;e.optgroup=e.option;e.tbody=e.tfoot=e.colgroup=e.caption=e.thead;e.th=e.td}};SM.Html.init();if(typeof module==="object"&&module.exports){module.exports=SM.Html}var SM;if(typeof module==="object"&&module.exports&&typeof require==="function"){SM=require("../SM");require("./string");require("./html")}SM.Template={r_mustache_html_whitespace:/(([#\/\^!][^<]*%>)|([^%]>))(\s+)((<[^%])|(<%(?=[#\/\^!])))/g,whitespaceFunc:function(){return arguments[0].replace(arguments[4],"")},render:function(e,t,n){var i,r;if(!this._templates[e]){i=document.getElementById(e);if(!i){throw new Error("Template not found, id: "+e)}r=i.innerHTML;if(i.getAttribute("remove-ws")){r=r.replace(this.r_mustache_html_whitespace,this.whitespaceFunc)}r=SM.String.trim(r);this._templates[e]=r}if(t===undefined){return this._templates[e]}return Mustache.render(this._templates[e],t,n)},renderHTML:function(e,t){var n=this.render(e,t),i=SM.Html.parse(n)[0];i.parentNode.removeChild(i);return i},_templates:{}};if(typeof module==="object"&&module.exports){module.exports=SM.Template}var SM;if(typeof module==="object"&&module.exports&&typeof require==="function"){SM=require("../SM");require("./object");require("./widget");require("./template")}SM.View=SM.Object.extend(SM.Widget,{__templateID:undefined,__beforeRender:function(){return this.__settings},__render:function(e){return SM.Template.renderHTML(this.__templateID,e)},__afterRender:function(){},__update:function(e){var t=this.__beforeRender(e),n=this.el.tagName.toLowerCase(),i=n==="input"||n==="button",r=this.__render(t),o=r.attributes,s,a,l=o.length,u=0;try{for(;u<l;u++){s=o[u];a=r.getAttributeNode(s.name);if(a&&(a.nodeValue||a.nodeValue==="")&&!(i&&s.name.toLowerCase()==="type")){if(s.name==="class"){this.el.className=s.value}else{this.el.setAttribute(s.name,s.value)}}}}catch(e){SM.Error.log(e,"Error setting attribute: "+s.name+", value: "+s.name)}this.$el.html(r.innerHTML);this.__afterRender(t)},render:function(){this.__update.apply(this,arguments)},destroy:function(){this.clearBindings();if(this.__destroy){this.__destroy()}},bindModel:function(){var e,t,n,i;if(arguments.length<3){throw new Error("requires at least 3 arguments")}e=arguments[0];n=arguments[1];i=arguments[arguments.length-1];if(!$.isFunction(e.on)){throw new Error("the first argument was not a model")}if(typeof n!=="string"){throw new Error("the second argument was not an event string")}if(!$.isFunction(i)){throw new Error("the last argument was not a callback function")}t=Array.prototype.slice.call(arguments,0);t[1]=t[1]+"."+this.__NAME+this.__uid;e.on.apply(e,t.slice(1));this.__bindings.push(t)},unbindModel:function(){var e,t,n;if(arguments.length<2){throw new Error("requires at least 2 arguments")}e=arguments[0];n=arguments[1];if(arguments.length>2){t=arguments[arguments.length-1]}if(!$.isFunction(e.on)){throw new Error("the first argument was not a model")}if(typeof n!=="string"){throw new Error("the second argument was not an event string")}if(t&&!$.isFunction(t)){throw new Error("the last argument was not a callback function")}this.__removeBinding(e,n,t)},clearBindings:function(){if(this.__bindings.length){$.each(this.__bindings,function(e,t){var n=t[0],i=t[1],r=t[t.length-1];n.off(i,r)});this.__bindings=[]}},__removeBinding:function(e,t,n){var i=t+"."+this.__NAME+this.__uid,r=this.__bindings,o,s=0,a,l,u;for(;s<r.length;s++){o=r[s];l=o[0];a=o[1];u=o[o.length-1];if(l===e&&a===i){if(n){if(n===u){l.off(a,u);r.splice(s,1);s--}}else{l.off(a);r.splice(s,1);s--}}}}});SM.Views={register:function(e){if(!e.__NAME){throw new Error("the __NAME property must be defined")}if(!e.__templateID){throw new Error("the __templateID property must be defined")}e=SM.Object.extend(SM.View,e);e.__counter=0;return e},extend:function(e,t){var n=SM.Object.extend(e,t);return this.register(n)},deepExtend:function(e,t){var n=SM.Object.deepExtend(e,t);return this.register(n)},create:function(e,t){var n,i;if(e.__counter===0&&e.__setup){e.__setup()}n=SM.Object.create(e);if(t&&t.templateID){n.__templateID=t.templateID}n.__bindings=[];n.__initSettings(t);t=t||{};if(t.model){if(e.__model===undefined){throw new Error("SM.Views.create: if model option is given your view must define a __model property")}n[e.__model]=t.model}n.__uid=e.__counter++;if(typeof n.__create==="function"){n.__create(t)}i=n.__beforeRender(t);n.el=n.__render(i);n.$el=$(n.el);n.__afterRender(i);n.$el.attr("view-role",e.__NAME);$.data(n.el,e.__NAME,n);if(e.__init){n.__init(t)}n.$el.on("remove",{self:this},function(){n.destroy()});return n}};if(typeof module==="object"&&module.exports){module.exports.View=SM.View;module.exports.Views=SM.Views}SM.DialogView=SM.Views.deepExtend({__NAME:"dialog",__templateID:"dialog-template",__defaults:{isModal:false,isFixed:true,noOverlay:false,width:350,position:{my:"center",at:"center",collision:"none"},fixedPosition:null,easyClose:true,closeBtn:true},_hasShownOnce:false,__afterRender:function(){var e;this.$el.css("width",this.__settings.width);if(this.__settings.title){this.$el.attr("title",this.__settings.title)}e=this.$el.attr("title");if(e){this._addTitlebar(e);this.$el.removeAttr("title")}if(this.__settings.closeBtn){this._addCloseBtn()}if(this._hasShownOnce){this.$el.addClass("open");this.$el.removeClass("close")}else{this.$el.addClass("close");this.$el.removeClass("open")}},__onBeforeOpen:function(){$(window).on(SM.Event.RESIZE+"."+this.__NAME+this.__uid,{self:this},this._onResize);this.subscribe(SM.Event.KEYDOWN,this._onOpenKeydown);this.$el.on("click",".dialog-close-btn",{self:this},this._onCloseClick)},__onAfterOpen:function(){},__onBeforeClose:function(){$(window).off(SM.Event.RESIZE+"."+this.__NAME+this.__uid,this._onResize);this.unsubscribe(SM.Event.KEYDOWN,this._onOpenKeydown);this.$el.off("click",this._onCloseClick)},__onAfterClose:function(){},__onWindowResize:function(){if(!this.__settings.noOverlay){this.position()}},open:function(e){if(this._isOpen){return this}if(e){SM.Object.update(this.__settings,e)}this.trigger("beforeOpen");this.__onBeforeOpen();this._open();return this},update:function(e){if(e.title){this._updateTitlebar(e.title)}},close:function(){var e=$.Event("beforeClose",{dialog:this});if(!this._isOpen){return this}this.trigger(e);if(e.isDefaultPrevented()){return this}this.__onBeforeClose();this._close();return this},position:function(){var e;if(!this.__settings.position.of){this.__settings.position.of=window}e=$.migrationFixPosition({my:this.__settings.position.my,at:this.__settings.position.at,of:this.__settings.position.of,offset:this.__settings.position.offset,within:this.__settings.position.within,collision:this.__settings.position.collision});this.$el.position(e);this.trigger("position")},isOpen:function(){return this._isOpen},_$overlay:null,_isOpen:false,_open:function(){var e,t,n=this;e=SM.Template.renderHTML("dialog-container-template");this._$dialogContainer=$(e);this._$dialogContainer.appendTo(document.body);if(!this.__settings.noOverlay){t=SM.Template.renderHTML("dialog-overlay-template",{isModal:this.__settings.isModal});this._$overlay=$(t);if(this.$el.hasClass("dialog-b")){this._$overlay.addClass("dialog-overlay-b")}this._$overlay.appendTo(this._$dialogContainer);if(this.__settings.easyClose){this._$overlay.on("click",{self:this},n._onOverlayClick)}}else{this._$dialogContainer.addClass("no-overlay")}if(this.__settings.isModal&&this.__settings.isFixed){$("body").addClass("sm-fixed-dialog-modal")}this.$el.appendTo(this._$dialogContainer);setTimeout(function(){n._fadeIn()},0)},_close:function(){var e=this;if(this._$overlay){this._$overlay.removeClass("open")}this.$el.removeClass("open");this.$el.addClass("close");this._isOpen=false;this._hasShownOnce=false;if(this.__settings.isModal){$("body").removeClass("sm-fixed-dialog-modal")}setTimeout(function(){e._fadeOutComplete()},100)},_fadeIn:function(){if(this._$overlay){this._$overlay.addClass("open")}this.$el.addClass("open");this.$el.removeClass("close");if(this.__settings.isFixed&&!this.__settings.isModal){this.$el.closest(".dialog-container").addClass("fixed-dialog")}if(!this.__settings.noOverlay){this.position()}else if(this.__settings.fixedPosition){this._$dialogContainer.css(this.__settings.fixedPosition)}this._isOpen=true;this._hasShownOnce=true;this.trigger("afterOpen");this.__onAfterOpen()},_fadeOutComplete:function(){if(this._$overlay){this._$overlay.off("click");this._$overlay.remove();this._$overlay=null}this.$el.detach();this.trigger("afterClose");this._$dialogContainer.remove();this._$dialogContainer=null;this.__onAfterClose()},_addCloseBtn:function(){var e,t=this.$el.hasClass("dialog-b")?"dialog-close-btn-template-b":"dialog-close-btn-template";e=SM.Template.renderHTML(t);this.$el.prepend(e)},_updateTitlebar:function(e){this.$el.find(".dialog-title-bar").replaceWith(SM.Template.renderHTML("dialog-title-bar-template",{title:e}))},_addTitlebar:function(e){var t=SM.Template.renderHTML("dialog-title-bar-template",{title:e});this.$el.prepend(t)},_onCloseClick:function(e){e.data.self.close();e.preventDefault()},_onOverlayClick:function(e){e.data.self.close()},_onResize:function(e,t){var n=e.data.self;n.__onWindowResize(e,t)},_onOpenKeydown:function(e){var t=e.data.self;if(e.which===SM.KeyCodes.ESCAPE){t.close();e.preventDefault()}},_contains:function(e){return SM.DOM.contains(this.el,e)}});(function(){"use strict";var e=/(\{.*\})/.exec(document.body.innerHTML);if(e){parent.postMessage(e[1],"*")}})();(function(global){(function(e){"use strict";var t,n=["uploaderType","endpointType"];function i(e){var n=u(e||{}),i=r(n);s(i);l(n,i);return t}function r(e){var t=a("uploaderType"),n=a("endpointType");if(t){t=t.charAt(0).toUpperCase()+t.slice(1).toLowerCase();if(n){return new qq[n]["FineUploader"+t](e)}return new qq["FineUploader"+t](e)}else{if(n){return new qq[n].FineUploader(e)}return new qq.FineUploader(e)}}function o(e,n){var i=t.data("fineuploader");if(n){if(i===undefined){i={}}i[e]=n;t.data("fineuploader",i)}else{if(i===undefined){return null}return i[e]}}function s(e){return o("uploader",e)}function a(e,t){return o(e,t)}function l(n,i){var r=n.callbacks={};e.each(i._options.callbacks,function(n,i){var o,s;o=/^on(\w+)/.exec(n)[1];o=o.substring(0,1).toLowerCase()+o.substring(1);s=t;r[n]=function(){var t=Array.prototype.slice.call(arguments),n=[],r,a;e.each(t,function(e,t){n.push(f(t))});r=i.apply(this,t);try{a=s.triggerHandler(o,n)}catch(e){qq.log("Caught error in Fine Uploader jQuery event handler: "+e.message,"error")}if(r!=null){return r}return a}});i._options.callbacks=r}function u(i,r){var o,s;if(r===undefined){if(i.uploaderType!=="basic"){o={element:t[0]}}else{o={}}}else{o=r}e.each(i,function(t,i){if(e.inArray(t,n)>=0){a(t,i)}else if(i instanceof e){o[t]=i[0]}else if(e.isPlainObject(i)){o[t]={};u(i,o[t])}else if(e.isArray(i)){s=[];e.each(i,function(t,n){var i={};if(n instanceof e){e.merge(s,n)}else if(e.isPlainObject(n)){u(n,i);s.push(i)}else{s.push(n)}});o[t]=s}else{o[t]=i}});if(r===undefined){return o}}function c(t){return e.type(t)==="string"&&!t.match(/^_/)&&s()[t]!==undefined}function d(e){var t=[],n=Array.prototype.slice.call(arguments,1),i;u(n,t);i=s()[e].apply(s(),t);return f(i)}function f(t){var n=t;if(t!=null&&typeof t==="object"&&(t.nodeType===1||t.nodeType===9)&&t.cloneNode){n=e(t)}return n}e.fn.fineUploader=function(n){var r=this,o=arguments,a=[];this.each(function(l,u){t=e(u);if(s()&&c(n)){a.push(d.apply(r,o));if(r.length===1){return false}}else if(typeof n==="object"||!n){i.apply(r,o)}else{e.error("Method "+n+" does not exist on jQuery.fineUploader")}});if(a.length===1){return a[0]}else if(a.length>1){return a}return this}})(jQuery);(function(e){"use strict";var t="fineUploaderDnd",n;function i(e){if(!e){e={}}e.dropZoneElements=[n];var t=a(e);s(t);o(new qq.DragAndDrop(t));return n}function r(e,i){var r=n.data(t);if(i){if(r===undefined){r={}}r[e]=i;n.data(t,r)}else{if(r===undefined){return null}return r[e]}}function o(e){return r("dndInstance",e)}function s(t){var i=t.callbacks={};e.each(new qq.DragAndDrop.callbacks,function(e,t){var r=e,o;o=n;i[e]=function(){var e=Array.prototype.slice.call(arguments),t=o.triggerHandler(r,e);return t}})}function a(t,n){var i,r;if(n===undefined){i={}}else{i=n}e.each(t,function(t,n){if(n instanceof e){i[t]=n[0]}else if(e.isPlainObject(n)){i[t]={};a(n,i[t])}else if(e.isArray(n)){r=[];e.each(n,function(t,n){if(n instanceof e){e.merge(r,n)}else{r.push(n)}});i[t]=r}else{i[t]=n}});if(n===undefined){return i}}function l(t){return e.type(t)==="string"&&t==="dispose"&&o()[t]!==undefined}function u(e){var t=[],n=Array.prototype.slice.call(arguments,1);a(n,t);return o()[e].apply(o(),t)}e.fn.fineUploaderDnd=function(t){var r=this,s=arguments,a=[];this.each(function(c,d){n=e(d);if(o()&&l(t)){a.push(u.apply(r,s));if(r.length===1){return false}}else if(typeof t==="object"||!t){i.apply(r,s)}else{e.error("Method "+t+" does not exist in Fine Uploader's DnD module.")}});if(a.length===1){return a[0]}else if(a.length>1){return a}return this}})(jQuery);(function(e){"use strict";e.fn.fineUploaderS3=function(t){if(typeof t==="object"){t.endpointType="s3"}return e.fn.fineUploader.apply(this,arguments)}})(jQuery);var qq=function(e){"use strict";return{hide:function(){e.style.display="none";return this},attach:function(t,n){if(e.addEventListener){e.addEventListener(t,n,false)}else if(e.attachEvent){e.attachEvent("on"+t,n)}return function(){qq(e).detach(t,n)}},detach:function(t,n){if(e.removeEventListener){e.removeEventListener(t,n,false)}else if(e.attachEvent){e.detachEvent("on"+t,n)}return this},contains:function(t){if(!t){return false}if(e===t){return true}if(e.contains){return e.contains(t)}else{return!!(t.compareDocumentPosition(e)&8)}},insertBefore:function(t){t.parentNode.insertBefore(e,t);return this},remove:function(){e.parentNode.removeChild(e);return this},css:function(t){if(e.style==null){throw new qq.Error("Can't apply style to node as it is not on the HTMLElement prototype chain!")}if(t.opacity!=null){if(typeof e.style.opacity!=="string"&&typeof e.filters!=="undefined"){t.filter="alpha(opacity="+Math.round(100*t.opacity)+")"}}qq.extend(e.style,t);return this},hasClass:function(t,n){var i=new RegExp("(^| )"+t+"( |$)");return i.test(e.className)||!!(n&&i.test(e.parentNode.className))},addClass:function(t){if(!qq(e).hasClass(t)){e.className+=" "+t}return this},removeClass:function(t){var n=new RegExp("(^| )"+t+"( |$)");e.className=e.className.replace(n," ").replace(/^\s+|\s+$/g,"");return this},getByClass:function(t,n){var i,r=[];if(n&&e.querySelector){return e.querySelector("."+t)}else if(e.querySelectorAll){return e.querySelectorAll("."+t)}i=e.getElementsByTagName("*");qq.each(i,function(e,n){if(qq(n).hasClass(t)){r.push(n)}});return n?r[0]:r},getFirstByClass:function(t){return qq(e).getByClass(t,true)},children:function(){var t=[],n=e.firstChild;while(n){if(n.nodeType===1){t.push(n)}n=n.nextSibling}return t},setText:function(t){e.innerText=t;e.textContent=t;return this},clearText:function(){return qq(e).setText("")},hasAttribute:function(t){var n;if(e.hasAttribute){if(!e.hasAttribute(t)){return false}return/^false$/i.exec(e.getAttribute(t))==null}else{n=e[t];if(n===undefined){return false}return/^false$/i.exec(n)==null}}}};(function(){"use strict";qq.canvasToBlob=function(e,t,n){return qq.dataUriToBlob(e.toDataURL(t,n))};qq.dataUriToBlob=function(e){var t,n,i=function(e,t){var n=window.BlobBuilder||window.WebKitBlobBuilder||window.MozBlobBuilder||window.MSBlobBuilder,i=n&&new n;if(i){i.append(e);return i.getBlob(t)}else{return new Blob([e],{type:t})}},r,o;if(e.split(",")[0].indexOf("base64")>=0){n=atob(e.split(",")[1])}else{n=decodeURI(e.split(",")[1])}o=e.split(",")[0].split(":")[1].split(";")[0];t=new ArrayBuffer(n.length);r=new Uint8Array(t);qq.each(n,function(e,t){r[e]=t.charCodeAt(0)});return i(t,o)};qq.log=function(e,t){if(window.console){if(!t||t==="info"){window.console.log(e)}else{if(window.console[t]){window.console[t](e)}else{window.console.log("<"+t+"> "+e)}}}};qq.isObject=function(e){return e&&!e.nodeType&&Object.prototype.toString.call(e)==="[object Object]"};qq.isFunction=function(e){return typeof e==="function"};qq.isArray=function(e){return Object.prototype.toString.call(e)==="[object Array]"||e&&window.ArrayBuffer&&e.buffer&&e.buffer.constructor===ArrayBuffer};qq.isItemList=function(e){return Object.prototype.toString.call(e)==="[object DataTransferItemList]"};qq.isNodeList=function(e){return Object.prototype.toString.call(e)==="[object NodeList]"||e.item&&e.namedItem};qq.isString=function(e){return Object.prototype.toString.call(e)==="[object String]"};qq.trimStr=function(e){if(String.prototype.trim){return e.trim()}return e.replace(/^\s+|\s+$/g,"")};qq.format=function(e){var t=Array.prototype.slice.call(arguments,1),n=e,i=n.indexOf("{}");qq.each(t,function(e,t){var r=n.substring(0,i),o=n.substring(i+2);n=r+t+o;i=n.indexOf("{}",i+t.length);if(i<0){return false}});return n};qq.isFile=function(e){return window.File&&Object.prototype.toString.call(e)==="[object File]"};qq.isFileList=function(e){return window.FileList&&Object.prototype.toString.call(e)==="[object FileList]"};qq.isFileOrInput=function(e){return qq.isFile(e)||qq.isInput(e)};qq.isInput=function(e,t){var n=function(e){var n=e.toLowerCase();if(t){return n!=="file"}return n==="file"};if(window.HTMLInputElement){if(Object.prototype.toString.call(e)==="[object HTMLInputElement]"){if(e.type&&n(e.type)){return true}}}if(e.tagName){if(e.tagName.toLowerCase()==="input"){if(e.type&&n(e.type)){return true}}}return false};qq.isBlob=function(e){if(window.Blob&&Object.prototype.toString.call(e)==="[object Blob]"){return true}};qq.isXhrUploadSupported=function(){var e=document.createElement("input");e.type="file";return e.multiple!==undefined&&typeof File!=="undefined"&&typeof FormData!=="undefined"&&typeof qq.createXhrInstance().upload!=="undefined"};qq.createXhrInstance=function(){if(window.XMLHttpRequest){return new XMLHttpRequest}try{return new ActiveXObject("MSXML2.XMLHTTP.3.0")}catch(e){qq.log("Neither XHR or ActiveX are supported!","error");return null}};qq.isFolderDropSupported=function(e){return e.items&&e.items.length>0&&e.items[0].webkitGetAsEntry};qq.isFileChunkingSupported=function(){return!qq.androidStock()&&qq.isXhrUploadSupported()&&(File.prototype.slice!==undefined||File.prototype.webkitSlice!==undefined||File.prototype.mozSlice!==undefined)};qq.sliceBlob=function(e,t,n){var i=e.slice||e.mozSlice||e.webkitSlice;return i.call(e,t,n)};qq.arrayBufferToHex=function(e){var t="",n=new Uint8Array(e);qq.each(n,function(e,n){var i=n.toString(16);if(i.length<2){i="0"+i}t+=i});return t};qq.readBlobToHex=function(e,t,n){var i=qq.sliceBlob(e,t,t+n),r=new FileReader,o=new qq.Promise;r.onload=function(){o.success(qq.arrayBufferToHex(r.result))};r.onerror=o.failure;r.readAsArrayBuffer(i);return o};qq.extend=function(e,t,n){qq.each(t,function(t,i){if(n&&qq.isObject(i)){if(e[t]===undefined){e[t]={}}qq.extend(e[t],i,true)}else{e[t]=i}});return e};qq.override=function(e,t){var n={},i=t(n);qq.each(i,function(t,i){if(e[t]!==undefined){n[t]=e[t]}e[t]=i});return e};qq.indexOf=function(e,t,n){if(e.indexOf){return e.indexOf(t,n)}n=n||0;var i=e.length;if(n<0){n+=i}for(;n<i;n+=1){if(e.hasOwnProperty(n)&&e[n]===t){return n}}return-1};qq.getUniqueId=function(){return"xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,function(e){var t=Math.random()*16|0,n=e=="x"?t:t&3|8;return n.toString(16)})};qq.ie=function(){return navigator.userAgent.indexOf("MSIE")!==-1||navigator.userAgent.indexOf("Trident")!==-1};qq.ie7=function(){return navigator.userAgent.indexOf("MSIE 7")!==-1};qq.ie8=function(){return navigator.userAgent.indexOf("MSIE 8")!==-1};qq.ie10=function(){return navigator.userAgent.indexOf("MSIE 10")!==-1};qq.ie11=function(){return qq.ie()&&navigator.userAgent.indexOf("rv:11")!==-1};qq.edge=function(){return navigator.userAgent.indexOf("Edge")>=0};qq.safari=function(){return navigator.vendor!==undefined&&navigator.vendor.indexOf("Apple")!==-1};qq.chrome=function(){return navigator.vendor!==undefined&&navigator.vendor.indexOf("Google")!==-1};qq.opera=function(){return navigator.vendor!==undefined&&navigator.vendor.indexOf("Opera")!==-1};qq.firefox=function(){return!qq.edge()&&!qq.ie11()&&navigator.userAgent.indexOf("Mozilla")!==-1&&navigator.vendor!==undefined&&navigator.vendor===""};qq.windows=function(){return navigator.platform==="Win32"};qq.android=function(){return navigator.userAgent.toLowerCase().indexOf("android")!==-1};qq.androidStock=function(){return qq.android()&&navigator.userAgent.toLowerCase().indexOf("chrome")<0};qq.ios6=function(){return qq.ios()&&navigator.userAgent.indexOf(" OS 6_")!==-1};qq.ios7=function(){return qq.ios()&&navigator.userAgent.indexOf(" OS 7_")!==-1};qq.ios8=function(){return qq.ios()&&navigator.userAgent.indexOf(" OS 8_")!==-1};qq.ios800=function(){return qq.ios()&&navigator.userAgent.indexOf(" OS 8_0 ")!==-1};qq.ios=function(){return navigator.userAgent.indexOf("iPad")!==-1||navigator.userAgent.indexOf("iPod")!==-1||navigator.userAgent.indexOf("iPhone")!==-1};qq.iosChrome=function(){return qq.ios()&&navigator.userAgent.indexOf("CriOS")!==-1};qq.iosSafari=function(){return qq.ios()&&!qq.iosChrome()&&navigator.userAgent.indexOf("Safari")!==-1};qq.iosSafariWebView=function(){return qq.ios()&&!qq.iosChrome()&&!qq.iosSafari()};qq.preventDefault=function(e){if(e.preventDefault){e.preventDefault()}else{e.returnValue=false}};qq.toElement=function(){var e=document.createElement("div");return function(t){e.innerHTML=t;var n=e.firstChild;e.removeChild(n);return n}}();qq.each=function(e,t){var n,i;if(e){if(window.Storage&&e.constructor===window.Storage){for(n=0;n<e.length;n++){i=t(e.key(n),e.getItem(e.key(n)));if(i===false){break}}}else if(qq.isArray(e)||qq.isItemList(e)||qq.isNodeList(e)){for(n=0;n<e.length;n++){i=t(n,e[n]);if(i===false){break}}}else if(qq.isString(e)){for(n=0;n<e.length;n++){i=t(n,e.charAt(n));if(i===false){break}}}else{for(n in e){if(Object.prototype.hasOwnProperty.call(e,n)){i=t(n,e[n]);if(i===false){break}}}}}};qq.bind=function(e,t){if(qq.isFunction(e)){var n=Array.prototype.slice.call(arguments,2);return function(){var i=qq.extend([],n);if(arguments.length){i=i.concat(Array.prototype.slice.call(arguments))}return e.apply(t,i)}}throw new Error("first parameter must be a function!")};qq.obj2url=function(e,t,n){var i=[],r="&",o=function(e,n){var r=t?/\[\]$/.test(t)?t:t+"["+n+"]":n;if(r!=="undefined"&&n!=="undefined"){i.push(typeof e==="object"?qq.obj2url(e,r,true):Object.prototype.toString.call(e)==="[object Function]"?encodeURIComponent(r)+"="+encodeURIComponent(e()):encodeURIComponent(r)+"="+encodeURIComponent(e))}};if(!n&&t){r=/\?/.test(t)?/\?$/.test(t)?"":"&":"?";i.push(t);i.push(qq.obj2url(e))}else if(Object.prototype.toString.call(e)==="[object Array]"&&typeof e!=="undefined"){qq.each(e,function(e,t){o(t,e)})}else if(typeof e!=="undefined"&&e!==null&&typeof e==="object"){qq.each(e,function(e,t){o(t,e)})}else{i.push(encodeURIComponent(t)+"="+encodeURIComponent(e))}if(t){return i.join(r)}else{return i.join(r).replace(/^&/,"").replace(/%20/g,"+")}};qq.obj2FormData=function(e,t,n){if(!t){t=new FormData}qq.each(e,function(e,i){e=n?n+"["+e+"]":e;if(qq.isObject(i)){qq.obj2FormData(i,t,e)}else if(qq.isFunction(i)){t.append(e,i())}else{t.append(e,i)}});return t};qq.obj2Inputs=function(e,t){var n;if(!t){t=document.createElement("form")}qq.obj2FormData(e,{append:function(e,i){n=document.createElement("input");n.setAttribute("name",e);n.setAttribute("value",i);t.appendChild(n)}});return t};qq.parseJson=function(json){if(window.JSON&&qq.isFunction(JSON.parse)){return JSON.parse(json)}else{return eval("("+json+")")}};qq.getExtension=function(e){var t=e.lastIndexOf(".")+1;if(t>0){return e.substr(t,e.length-t)}};qq.getFilename=function(e){if(qq.isInput(e)){return e.value.replace(/.*(\/|\\)/,"")}else if(qq.isFile(e)){if(e.fileName!==null&&e.fileName!==undefined){return e.fileName}}return e.name};qq.DisposeSupport=function(){var e=[];return{dispose:function(){var t;do{t=e.shift();if(t){t()}}while(t)},attach:function(){var e=arguments;this.addDisposer(qq(e[0]).attach.apply(this,Array.prototype.slice.call(arguments,1)))},addDisposer:function(t){e.push(t)}}}})();(function(){"use strict";if(typeof define==="function"&&define.amd){define(function(){return qq})}else if(typeof module!=="undefined"&&module.exports){module.exports=qq}else{global.qq=qq}})();(function(){"use strict";qq.Error=function(e){this.message="[Fine Uploader "+qq.version+"] "+e};qq.Error.prototype=new Error})();qq.version="5.14.3";qq.supportedFeatures=function(){"use strict";var e,t,n,i,r,o,s,a,l,u,c,d,f,p,h;function q(){var e=true,t;try{t=document.createElement("input");t.type="file";qq(t).hide();if(t.disabled){e=false}}catch(t){e=false}return e}function g(){return(qq.chrome()||qq.opera())&&navigator.userAgent.match(/Chrome\/[2][1-9]|Chrome\/[3-9][0-9]/)!==undefined}function m(){return(qq.chrome()||qq.opera())&&navigator.userAgent.match(/Chrome\/[1][4-9]|Chrome\/[2-9][0-9]/)!==undefined}function _(){if(window.XMLHttpRequest){var e=qq.createXhrInstance();return e.withCredentials!==undefined}return false}function v(){return window.XDomainRequest!==undefined}function b(){if(_()){return true}return v()}function y(){return document.createElement("input").webkitdirectory!==undefined}function S(){try{return!!window.localStorage&&qq.isFunction(window.localStorage.setItem)}catch(e){return false}}function w(){var e=document.createElement("span");return("draggable"in e||"ondragstart"in e&&"ondrop"in e)&&!qq.android()&&!qq.ios()}e=q();i=e&&qq.isXhrUploadSupported();t=i&&!qq.androidStock();n=i&&w();r=n&&g();o=i&&qq.isFileChunkingSupported();s=i&&o&&S();a=i&&m();l=e&&(window.postMessage!==undefined||i);c=_();u=v();d=b();f=y();p=i&&window.FileReader!==undefined;h=function(){if(i){return!qq.androidStock()&&!qq.iosChrome()}return false}();return{ajaxUploading:i,blobUploading:t,canDetermineSize:i,chunking:o,deleteFileCors:d,deleteFileCorsXdr:u,deleteFileCorsXhr:c,dialogElement:!!window.HTMLDialogElement,fileDrop:n,folderDrop:r,folderSelection:f,imagePreviews:p,imageValidation:p,itemSizeValidation:i,pause:o,progressBar:h,resume:s,scaling:p&&t,tiffPreviews:qq.safari(),unlimitedScaledImageSize:!qq.ios(),uploading:e,uploadCors:l,uploadCustomHeaders:i,uploadNonMultipart:i,uploadViaPaste:a}}();qq.isGenericPromise=function(e){"use strict";return!!(e&&e.then&&qq.isFunction(e.then))};qq.Promise=function(){"use strict";var e,t,n=[],i=[],r=[],o=0;qq.extend(this,{then:function(r,s){if(o===0){if(r){n.push(r)}if(s){i.push(s)}}else if(o===-1){s&&s.apply(null,t)}else if(r){r.apply(null,e)}return this},done:function(n){if(o===0){r.push(n)}else{n.apply(null,t===undefined?e:t)}return this},success:function(){o=1;e=arguments;if(n.length){qq.each(n,function(t,n){n.apply(null,e)})}if(r.length){qq.each(r,function(t,n){n.apply(null,e)})}return this},failure:function(){o=-1;t=arguments;if(i.length){qq.each(i,function(e,n){n.apply(null,t)})}if(r.length){qq.each(r,function(e,n){n.apply(null,t)})}return this}})};qq.BlobProxy=function(e,t){"use strict";qq.extend(this,{referenceBlob:e,create:function(){return t(e)}})};qq.UploadButton=function(e){"use strict";var t=this,n=new qq.DisposeSupport,i={acceptFiles:null,element:null,focusClass:"qq-upload-button-focus",folders:false,hoverClass:"qq-upload-button-hover",ios8BrowserCrashWorkaround:false,multiple:false,name:"qqfile",onChange:function(e){},title:null},r,o;qq.extend(i,e);o=qq.getUniqueId();function s(){var e=document.createElement("input");e.setAttribute(qq.UploadButton.BUTTON_ID_ATTR_NAME,o);e.setAttribute("title",i.title);t.setMultiple(i.multiple,e);if(i.folders&&qq.supportedFeatures.folderSelection){e.setAttribute("webkitdirectory","")}if(i.acceptFiles){e.setAttribute("accept",i.acceptFiles)}e.setAttribute("type","file");e.setAttribute("name",i.name);qq(e).css({position:"absolute",right:0,top:0,fontFamily:"Arial",fontSize:qq.ie()&&!qq.ie8()?"3500px":"118px",margin:0,padding:0,cursor:"pointer",opacity:0});!qq.ie7()&&qq(e).css({height:"100%"});i.element.appendChild(e);n.attach(e,"change",function(){i.onChange(e)});n.attach(e,"mouseover",function(){qq(i.element).addClass(i.hoverClass)});n.attach(e,"mouseout",function(){qq(i.element).removeClass(i.hoverClass)});n.attach(e,"focus",function(){qq(i.element).addClass(i.focusClass)});n.attach(e,"blur",function(){qq(i.element).removeClass(i.focusClass)});return e}qq(i.element).css({position:"relative",overflow:"hidden",direction:"ltr"});qq.extend(this,{getInput:function(){return r},getButtonId:function(){return o},setMultiple:function(e,t){var n=t||this.getInput();if(i.ios8BrowserCrashWorkaround&&qq.ios8()&&(qq.iosChrome()||qq.iosSafariWebView())){n.setAttribute("multiple","")}else{if(e){n.setAttribute("multiple","")}else{n.removeAttribute("multiple")}}},setAcceptFiles:function(e){if(e!==i.acceptFiles){r.setAttribute("accept",e)}},reset:function(){if(r.parentNode){qq(r).remove()}qq(i.element).removeClass(i.focusClass);r=null;r=s()}});r=s()};qq.UploadButton.BUTTON_ID_ATTR_NAME="qq-button-id";qq.UploadData=function(e){"use strict";var t=[],n={},i={},r={},o={};function s(e){if(qq.isArray(e)){var n=[];qq.each(e,function(e,i){n.push(t[i])});return n}return t[e]}function a(e){if(qq.isArray(e)){var i=[];qq.each(e,function(e,r){i.push(t[n[r]])});return i}return t[n[e]]}function l(e){var n=[],r=[].concat(e);qq.each(r,function(e,r){var o=i[r];if(o!==undefined){qq.each(o,function(e,i){n.push(t[i])})}});return n}qq.extend(this,{addFile:function(s){var a=s.status||qq.status.SUBMITTING,l=t.push({name:s.name,originalName:s.name,uuid:s.uuid,size:s.size==null?-1:s.size,status:a})-1;if(s.batchId){t[l].batchId=s.batchId;if(o[s.batchId]===undefined){o[s.batchId]=[]}o[s.batchId].push(l)}if(s.proxyGroupId){t[l].proxyGroupId=s.proxyGroupId;if(r[s.proxyGroupId]===undefined){r[s.proxyGroupId]=[]}r[s.proxyGroupId].push(l)}t[l].id=l;n[s.uuid]=l;if(i[a]===undefined){i[a]=[]}i[a].push(l);s.onBeforeStatusChange&&s.onBeforeStatusChange(l);e.onStatusChange(l,null,a);return l},retrieve:function(e){if(qq.isObject(e)&&t.length){if(e.id!==undefined){return s(e.id)}else if(e.uuid!==undefined){return a(e.uuid)}else if(e.status){return l(e.status)}}else{return qq.extend([],t,true)}},reset:function(){t=[];n={};i={};o={}},setStatus:function(n,r){var o=t[n].status,s=qq.indexOf(i[o],n);i[o].splice(s,1);t[n].status=r;if(i[r]===undefined){i[r]=[]}i[r].push(n);e.onStatusChange(n,o,r)},uuidChanged:function(e,i){var r=t[e].uuid;t[e].uuid=i;n[i]=e;delete n[r]},updateName:function(e,n){t[e].name=n},updateSize:function(e,n){t[e].size=n},setParentId:function(e,n){t[e].parentId=n},getIdsInProxyGroup:function(e){var n=t[e].proxyGroupId;if(n){return r[n]}return[]},getIdsInBatch:function(e){var n=t[e].batchId;return o[n]}})};qq.status={SUBMITTING:"submitting",SUBMITTED:"submitted",REJECTED:"rejected",QUEUED:"queued",CANCELED:"canceled",PAUSED:"paused",UPLOADING:"uploading",UPLOAD_RETRYING:"retrying upload",UPLOAD_SUCCESSFUL:"upload successful",UPLOAD_FAILED:"upload failed",DELETE_FAILED:"delete failed",DELETING:"deleting",DELETED:"deleted"};(function(){"use strict";qq.basePublicApi={addBlobs:function(e,t,n){this.addFiles(e,t,n)},addInitialFiles:function(e){var t=this;qq.each(e,function(e,n){t._addCannedFile(n)})},addFiles:function(e,t,n){this._maybeHandleIos8SafariWorkaround();var i=this._storedIds.length===0?qq.getUniqueId():this._currentBatchId,r=qq.bind(function(e){this._handleNewFile({blob:e,name:this._options.blobs.defaultName},i,d)},this),o=qq.bind(function(e){this._handleNewFile(e,i,d)},this),s=qq.bind(function(e){var t=qq.canvasToBlob(e);this._handleNewFile({blob:t,name:this._options.blobs.defaultName+".png"},i,d)},this),a=qq.bind(function(e){var t=e.quality&&e.quality/100,n=qq.canvasToBlob(e.canvas,e.type,t);this._handleNewFile({blob:n,name:e.name},i,d)},this),l=qq.bind(function(e){if(qq.isInput(e)&&qq.supportedFeatures.ajaxUploading){var t=Array.prototype.slice.call(e.files),n=this;qq.each(t,function(e,t){n._handleNewFile(t,i,d)})}else{this._handleNewFile(e,i,d)}},this),u=function(){if(qq.isFileList(e)){e=Array.prototype.slice.call(e)}e=[].concat(e)},c=this,d=[];this._currentBatchId=i;if(e){u();qq.each(e,function(e,t){if(qq.isFileOrInput(t)){l(t)}else if(qq.isBlob(t)){r(t)}else if(qq.isObject(t)){if(t.blob&&t.name){o(t)}else if(t.canvas&&t.name){a(t)}}else if(t.tagName&&t.tagName.toLowerCase()==="canvas"){s(t)}else{c.log(t+" is not a valid file container!  Ignoring!","warn")}});this.log("Received "+d.length+" files.");this._prepareItemsForUpload(d,t,n)}},cancel:function(e){this._handler.cancel(e)},cancelAll:function(){var e=[],t=this;qq.extend(e,this._storedIds);qq.each(e,function(e,n){t.cancel(n)});this._handler.cancelAll()},clearStoredFiles:function(){this._storedIds=[]},continueUpload:function(e){var t=this._uploadData.retrieve({id:e});if(!qq.supportedFeatures.pause||!this._options.chunking.enabled){return false}if(t.status===qq.status.PAUSED){this.log(qq.format("Paused file ID {} ({}) will be continued.  Not paused.",e,this.getName(e)));this._uploadFile(e);return true}else{this.log(qq.format("Ignoring continue for file ID {} ({}).  Not paused.",e,this.getName(e)),"error")}return false},deleteFile:function(e){return this._onSubmitDelete(e)},doesExist:function(e){return this._handler.isValid(e)},drawThumbnail:function(e,t,n,i,r){var o=new qq.Promise,s,a;if(this._imageGenerator){s=this._thumbnailUrls[e];a={customResizeFunction:r,maxSize:n>0?n:null,scale:n>0};if(!i&&qq.supportedFeatures.imagePreviews){s=this.getFile(e)}if(s==null){o.failure({container:t,error:"File or URL not found."})}else{this._imageGenerator.generate(s,t,a).then(function e(t){o.success(t)},function e(t,n){o.failure({container:t,error:n||"Problem generating thumbnail"})})}}else{o.failure({container:t,error:"Missing image generator module"})}return o},getButton:function(e){return this._getButton(this._buttonIdsForFileIds[e])},getEndpoint:function(e){return this._endpointStore.get(e)},getFile:function(e){return this._handler.getFile(e)||null},getInProgress:function(){return this._uploadData.retrieve({status:[qq.status.UPLOADING,qq.status.UPLOAD_RETRYING,qq.status.QUEUED]}).length},getName:function(e){return this._uploadData.retrieve({id:e}).name},getParentId:function(e){var t=this.getUploads({id:e}),n=null;if(t){if(t.parentId!==undefined){n=t.parentId}}return n},getResumableFilesData:function(){return this._handler.getResumableFilesData()},getSize:function(e){return this._uploadData.retrieve({id:e}).size},getNetUploads:function(){return this._netUploaded},getRemainingAllowedItems:function(){var e=this._currentItemLimit;if(e>0){return e-this._netUploadedOrQueued}return null},getUploads:function(e){return this._uploadData.retrieve(e)},getUuid:function(e){return this._uploadData.retrieve({id:e}).uuid},log:function(e,t){if(this._options.debug&&(!t||t==="info")){qq.log("[Fine Uploader "+qq.version+"] "+e)}else if(t&&t!=="info"){qq.log("[Fine Uploader "+qq.version+"] "+e,t)}},pauseUpload:function(e){var t=this._uploadData.retrieve({id:e});if(!qq.supportedFeatures.pause||!this._options.chunking.enabled){return false}if(qq.indexOf([qq.status.UPLOADING,qq.status.UPLOAD_RETRYING],t.status)>=0){if(this._handler.pause(e)){this._uploadData.setStatus(e,qq.status.PAUSED);return true}else{this.log(qq.format("Unable to pause file ID {} ({}).",e,this.getName(e)),"error")}}else{this.log(qq.format("Ignoring pause for file ID {} ({}).  Not in progress.",e,this.getName(e)),"error")}return false},removeFileRef:function(e){this._handler.expunge(e)},reset:function(){this.log("Resetting uploader...");this._handler.reset();this._storedIds=[];this._autoRetries=[];this._retryTimeouts=[];this._preventRetries=[];this._thumbnailUrls=[];qq.each(this._buttons,function(e,t){t.reset()});this._paramsStore.reset();this._endpointStore.reset();this._netUploadedOrQueued=0;this._netUploaded=0;this._uploadData.reset();this._buttonIdsForFileIds=[];this._pasteHandler&&this._pasteHandler.reset();this._options.session.refreshOnReset&&this._refreshSessionData();this._succeededSinceLastAllComplete=[];this._failedSinceLastAllComplete=[];this._totalProgress&&this._totalProgress.reset()},retry:function(e){return this._manualRetry(e)},scaleImage:function(e,t){var n=this;return qq.Scaler.prototype.scaleImage(e,t,{log:qq.bind(n.log,n),getFile:qq.bind(n.getFile,n),uploadData:n._uploadData})},setCustomHeaders:function(e,t){this._customHeadersStore.set(e,t)},setDeleteFileCustomHeaders:function(e,t){this._deleteFileCustomHeadersStore.set(e,t)},setDeleteFileEndpoint:function(e,t){this._deleteFileEndpointStore.set(e,t)},setDeleteFileParams:function(e,t){this._deleteFileParamsStore.set(e,t)},setEndpoint:function(e,t){this._endpointStore.set(e,t)},setForm:function(e){this._updateFormSupportAndParams(e)},setItemLimit:function(e){this._currentItemLimit=e},setName:function(e,t){this._uploadData.updateName(e,t)},setParams:function(e,t){this._paramsStore.set(e,t)},setUuid:function(e,t){return this._uploadData.uuidChanged(e,t)},setStatus:function(e,t){var n=this.getUploads({id:e});if(!n){throw new qq.Error(e+" is not a valid file ID.")}switch(t){case qq.status.DELETED:this._onDeleteComplete(e,null,false);break;case qq.status.DELETE_FAILED:this._onDeleteComplete(e,null,true);break;default:var i="Method setStatus called on '"+name+"' not implemented yet for "+t;this.log(i);throw new qq.Error(i)}},uploadStoredFiles:function(){if(this._storedIds.length===0){this._itemError("noFilesError")}else{this._uploadStoredFiles()}}};qq.basePrivateApi={_addCannedFile:function(e){var t=this;return this._uploadData.addFile({uuid:e.uuid,name:e.name,size:e.size,status:qq.status.UPLOAD_SUCCESSFUL,onBeforeStatusChange:function(n){e.deleteFileEndpoint&&t.setDeleteFileEndpoint(e.deleteFileEndpoint,n);e.deleteFileParams&&t.setDeleteFileParams(e.deleteFileParams,n);if(e.thumbnailUrl){t._thumbnailUrls[n]=e.thumbnailUrl}t._netUploaded++;t._netUploadedOrQueued++}})},_annotateWithButtonId:function(e,t){if(qq.isFile(e)){e.qqButtonId=this._getButtonId(t)}},_batchError:function(e){this._options.callbacks.onError(null,null,e,undefined)},_createDeleteHandler:function(){var e=this;return new qq.DeleteFileAjaxRequester({method:this._options.deleteFile.method.toUpperCase(),maxConnections:this._options.maxConnections,uuidParamName:this._options.request.uuidName,customHeaders:this._deleteFileCustomHeadersStore,paramsStore:this._deleteFileParamsStore,endpointStore:this._deleteFileEndpointStore,cors:this._options.cors,log:qq.bind(e.log,e),onDelete:function(t){e._onDelete(t);e._options.callbacks.onDelete(t)},onDeleteComplete:function(t,n,i){e._onDeleteComplete(t,n,i);e._options.callbacks.onDeleteComplete(t,n,i)}})},_createPasteHandler:function(){var e=this;return new qq.PasteSupport({targetElement:this._options.paste.targetElement,callbacks:{log:qq.bind(e.log,e),pasteReceived:function(t){e._handleCheckedCallback({name:"onPasteReceived",callback:qq.bind(e._options.callbacks.onPasteReceived,e,t),onSuccess:qq.bind(e._handlePasteSuccess,e,t),identifier:"pasted image"})}}})},_createStore:function(e,t){var n={},i=e,r={},o=t,s=function(e){if(qq.isObject(e)){return qq.extend({},e)}return e},a=function(){if(qq.isFunction(o)){return o()}return o},l=function(e,t){if(o&&qq.isObject(t)){qq.extend(t,a())}if(r[e]){qq.extend(t,r[e])}};return{set:function(e,t){if(t==null){n={};i=s(e)}else{n[t]=s(e)}},get:function(e){var t;if(e!=null&&n[e]){t=n[e]}else{t=s(i)}l(e,t);return s(t)},addReadOnly:function(e,t){if(qq.isObject(n)){if(e===null){if(qq.isFunction(t)){o=t}else{o=o||{};qq.extend(o,t)}}else{r[e]=r[e]||{};qq.extend(r[e],t)}}},remove:function(e){return delete n[e]},reset:function(){n={};r={};i=e}}},_createUploadDataTracker:function(){var e=this;return new qq.UploadData({getName:function(t){return e.getName(t)},getUuid:function(t){return e.getUuid(t)},getSize:function(t){return e.getSize(t)},onStatusChange:function(t,n,i){e._onUploadStatusChange(t,n,i);e._options.callbacks.onStatusChange(t,n,i);e._maybeAllComplete(t,i);if(e._totalProgress){setTimeout(function(){e._totalProgress.onStatusChange(t,n,i)},0)}}})},_createUploadButton:function(e){var t=this,n=e.accept||this._options.validation.acceptFiles,i=e.allowedExtensions||this._options.validation.allowedExtensions,r;function o(){if(qq.supportedFeatures.ajaxUploading){if(t._options.workarounds.iosEmptyVideos&&qq.ios()&&!qq.ios6()&&t._isAllowedExtension(i,".mov")){return false}if(e.multiple===undefined){return t._options.multiple}return e.multiple}return false}r=new qq.UploadButton({acceptFiles:n,element:e.element,focusClass:this._options.classes.buttonFocus,folders:e.folders,hoverClass:this._options.classes.buttonHover,ios8BrowserCrashWorkaround:this._options.workarounds.ios8BrowserCrash,multiple:o(),name:this._options.request.inputName,onChange:function(e){t._onInputChange(e)},title:e.title==null?this._options.text.fileInputTitle:e.title});this._disposeSupport.addDisposer(function(){r.dispose()});t._buttons.push(r);return r},_createUploadHandler:function(e,t){var n=this,i={},r={debug:this._options.debug,maxConnections:this._options.maxConnections,cors:this._options.cors,paramsStore:this._paramsStore,endpointStore:this._endpointStore,chunking:this._options.chunking,resume:this._options.resume,blobs:this._options.blobs,log:qq.bind(n.log,n),preventRetryParam:this._options.retry.preventRetryResponseProperty,onProgress:function(e,t,r,o){if(r<0||o<0){return}if(i[e]){if(i[e].loaded!==r||i[e].total!==o){n._onProgress(e,t,r,o);n._options.callbacks.onProgress(e,t,r,o)}}else{n._onProgress(e,t,r,o);n._options.callbacks.onProgress(e,t,r,o)}i[e]={loaded:r,total:o}},onComplete:function(e,t,r,o){delete i[e];var s=n.getUploads({id:e}).status,a;if(s===qq.status.UPLOAD_SUCCESSFUL||s===qq.status.UPLOAD_FAILED){return}a=n._onComplete(e,t,r,o);if(a instanceof qq.Promise){a.done(function(){n._options.callbacks.onComplete(e,t,r,o)})}else{n._options.callbacks.onComplete(e,t,r,o)}},onCancel:function(e,t,i){var r=new qq.Promise;n._handleCheckedCallback({name:"onCancel",callback:qq.bind(n._options.callbacks.onCancel,n,e,t),onFailure:r.failure,onSuccess:function(){i.then(function(){n._onCancel(e,t)});r.success()},identifier:e});return r},onUploadPrep:qq.bind(this._onUploadPrep,this),onUpload:function(e,t){n._onUpload(e,t);n._options.callbacks.onUpload(e,t)},onUploadChunk:function(e,t,i){n._onUploadChunk(e,i);n._options.callbacks.onUploadChunk(e,t,i)},onUploadChunkSuccess:function(e,t,i,r){n._options.callbacks.onUploadChunkSuccess.apply(n,arguments)},onResume:function(e,t,i){return n._options.callbacks.onResume(e,t,i)},onAutoRetry:function(e,t,i,r){return n._onAutoRetry.apply(n,arguments)},onUuidChanged:function(e,t){n.log("Server requested UUID change from '"+n.getUuid(e)+"' to '"+t+"'");n.setUuid(e,t)},getName:qq.bind(n.getName,n),getUuid:qq.bind(n.getUuid,n),getSize:qq.bind(n.getSize,n),setSize:qq.bind(n._setSize,n),getDataByUuid:function(e){return n.getUploads({uuid:e})},isQueued:function(e){var t=n.getUploads({id:e}).status;return t===qq.status.QUEUED||t===qq.status.SUBMITTED||t===qq.status.UPLOAD_RETRYING||t===qq.status.PAUSED},getIdsInProxyGroup:n._uploadData.getIdsInProxyGroup,getIdsInBatch:n._uploadData.getIdsInBatch};qq.each(this._options.request,function(e,t){r[e]=t});r.customHeaders=this._customHeadersStore;if(e){qq.each(e,function(e,t){r[e]=t})}return new qq.UploadHandlerController(r,t)},_fileOrBlobRejected:function(e){this._netUploadedOrQueued--;this._uploadData.setStatus(e,qq.status.REJECTED)},_formatSize:function(e){if(e===0){return e+this._options.text.sizeSymbols[0]}var t=-1;do{e=e/1e3;t++}while(e>999);return Math.max(e,.1).toFixed(1)+this._options.text.sizeSymbols[t]},_generateExtraButtonSpecs:function(){var e=this;this._extraButtonSpecs={};qq.each(this._options.extraButtons,function(t,n){var i=n.multiple,r=qq.extend({},e._options.validation,true),o=qq.extend({},n);if(i===undefined){i=e._options.multiple}if(o.validation){qq.extend(r,n.validation,true)}qq.extend(o,{multiple:i,validation:r},true);e._initExtraButton(o)})},_getButton:function(e){var t=this._extraButtonSpecs[e];if(t){return t.element}else if(e===this._defaultButtonId){return this._options.button}},_getButtonId:function(e){var t,n,i=e;if(i instanceof qq.BlobProxy){i=i.referenceBlob}if(i&&!qq.isBlob(i)){if(qq.isFile(i)){return i.qqButtonId}else if(i.tagName.toLowerCase()==="input"&&i.type.toLowerCase()==="file"){return i.getAttribute(qq.UploadButton.BUTTON_ID_ATTR_NAME)}t=i.getElementsByTagName("input");qq.each(t,function(e,t){if(t.getAttribute("type")==="file"){n=t;return false}});if(n){return n.getAttribute(qq.UploadButton.BUTTON_ID_ATTR_NAME)}}},_getNotFinished:function(){return this._uploadData.retrieve({status:[qq.status.UPLOADING,qq.status.UPLOAD_RETRYING,qq.status.QUEUED,qq.status.SUBMITTING,qq.status.SUBMITTED,qq.status.PAUSED]}).length},_getValidationBase:function(e){var t=this._extraButtonSpecs[e];return t?t.validation:this._options.validation},_getValidationDescriptor:function(e){if(e.file instanceof qq.BlobProxy){return{name:qq.getFilename(e.file.referenceBlob),size:e.file.referenceBlob.size}}return{name:this.getUploads({id:e.id}).name,size:this.getUploads({id:e.id}).size}},_getValidationDescriptors:function(e){var t=this,n=[];qq.each(e,function(e,i){n.push(t._getValidationDescriptor(i))});return n},_handleCameraAccess:function(){if(this._options.camera.ios&&qq.ios()){var e="image/*;capture=camera",t=this._options.camera.button,n=t?this._getButtonId(t):this._defaultButtonId,i=this._options;if(n&&n!==this._defaultButtonId){i=this._extraButtonSpecs[n]}i.multiple=false;if(i.validation.acceptFiles===null){i.validation.acceptFiles=e}else{i.validation.acceptFiles+=","+e}qq.each(this._buttons,function(e,t){if(t.getButtonId()===n){t.setMultiple(i.multiple);t.setAcceptFiles(i.acceptFiles);return false}})}},_handleCheckedCallback:function(e){var t=this,n=e.callback();if(qq.isGenericPromise(n)){this.log(e.name+" - waiting for "+e.name+" promise to be fulfilled for "+e.identifier);return n.then(function(n){t.log(e.name+" promise success for "+e.identifier);e.onSuccess(n)},function(){if(e.onFailure){t.log(e.name+" promise failure for "+e.identifier);e.onFailure()}else{t.log(e.name+" promise failure for "+e.identifier)}})}if(n!==false){e.onSuccess(n)}else{if(e.onFailure){this.log(e.name+" - return value was 'false' for "+e.identifier+".  Invoking failure callback.");e.onFailure()}else{this.log(e.name+" - return value was 'false' for "+e.identifier+".  Will not proceed.")}}return n},_handleNewFile:function(e,t,n){var i=this,r=qq.getUniqueId(),o=-1,s=qq.getFilename(e),a=e.blob||e,l=this._customNewFileHandler?this._customNewFileHandler:qq.bind(i._handleNewFileGeneric,i);if(!qq.isInput(a)&&a.size>=0){o=a.size}l(a,s,r,o,n,t,this._options.request.uuidName,{uploadData:i._uploadData,paramsStore:i._paramsStore,addFileToHandler:function(e,t){i._handler.add(e,t);i._netUploadedOrQueued++;i._trackButton(e)}})},_handleNewFileGeneric:function(e,t,n,i,r,o){var s=this._uploadData.addFile({uuid:n,name:t,size:i,batchId:o});this._handler.add(s,e);this._trackButton(s);this._netUploadedOrQueued++;r.push({id:s,file:e})},_handlePasteSuccess:function(e,t){var n=e.type.split("/")[1],i=t;if(i==null){i=this._options.paste.defaultName}i+="."+n;this.addFiles({name:i,blob:e})},_handleDeleteSuccess:function(e){if(this.getUploads({id:e}).status!==qq.status.DELETED){var t=this.getName(e);this._netUploadedOrQueued--;this._netUploaded--;this._handler.expunge(e);this._uploadData.setStatus(e,qq.status.DELETED);this.log("Delete request for '"+t+"' has succeeded.")}},_handleDeleteFailed:function(e,t){var n=this.getName(e);this._uploadData.setStatus(e,qq.status.DELETE_FAILED);this.log("Delete request for '"+n+"' has failed.","error");if(!t||t.withCredentials===undefined){this._options.callbacks.onError(e,n,"Delete request failed",t)}else{this._options.callbacks.onError(e,n,"Delete request failed with response code "+t.status,t)}},_initExtraButton:function(e){var t=this._createUploadButton({accept:e.validation.acceptFiles,allowedExtensions:e.validation.allowedExtensions,element:e.element,folders:e.folders,multiple:e.multiple,title:e.fileInputTitle});this._extraButtonSpecs[t.getButtonId()]=e},_initFormSupportAndParams:function(){this._formSupport=qq.FormSupport&&new qq.FormSupport(this._options.form,qq.bind(this.uploadStoredFiles,this),qq.bind(this.log,this));if(this._formSupport&&this._formSupport.attachedToForm){this._paramsStore=this._createStore(this._options.request.params,this._formSupport.getFormInputsAsObject);this._options.autoUpload=this._formSupport.newAutoUpload;if(this._formSupport.newEndpoint){this._options.request.endpoint=this._formSupport.newEndpoint}}else{this._paramsStore=this._createStore(this._options.request.params)}},_isDeletePossible:function(){if(!qq.DeleteFileAjaxRequester||!this._options.deleteFile.enabled){return false}if(this._options.cors.expected){if(qq.supportedFeatures.deleteFileCorsXhr){return true}if(qq.supportedFeatures.deleteFileCorsXdr&&this._options.cors.allowXdr){return true}return false}return true},_isAllowedExtension:function(e,t){var n=false;if(!e.length){return true}qq.each(e,function(e,i){if(qq.isString(i)){var r=new RegExp("\\."+i+"$","i");if(t.match(r)!=null){n=true;return false}}});return n},_itemError:function(e,t,n){var i=this._options.messages[e],r=[],o=[].concat(t),s=o[0],a=this._getButtonId(n),l=this._getValidationBase(a),u,c;function d(e,t){i=i.replace(e,t)}qq.each(l.allowedExtensions,function(e,t){if(qq.isString(t)){r.push(t)}});u=r.join(", ").toLowerCase();d("{file}",this._options.formatFileName(s));d("{extensions}",u);d("{sizeLimit}",this._formatSize(l.sizeLimit));d("{minSizeLimit}",this._formatSize(l.minSizeLimit));c=i.match(/(\{\w+\})/g);if(c!==null){qq.each(c,function(e,t){d(t,o[e])})}this._options.callbacks.onError(null,s,i,undefined);return i},_manualRetry:function(e,t){if(this._onBeforeManualRetry(e)){this._netUploadedOrQueued++;this._uploadData.setStatus(e,qq.status.UPLOAD_RETRYING);if(t){t(e)}else{this._handler.retry(e)}return true}},_maybeAllComplete:function(e,t){var n=this,i=this._getNotFinished();if(t===qq.status.UPLOAD_SUCCESSFUL){this._succeededSinceLastAllComplete.push(e)}else if(t===qq.status.UPLOAD_FAILED){this._failedSinceLastAllComplete.push(e)}if(i===0&&(this._succeededSinceLastAllComplete.length||this._failedSinceLastAllComplete.length)){setTimeout(function(){n._onAllComplete(n._succeededSinceLastAllComplete,n._failedSinceLastAllComplete)},0)}},_maybeHandleIos8SafariWorkaround:function(){var e=this;if(this._options.workarounds.ios8SafariUploads&&qq.ios800()&&qq.iosSafari()){setTimeout(function(){window.alert(e._options.messages.unsupportedBrowserIos8Safari)},0);throw new qq.Error(this._options.messages.unsupportedBrowserIos8Safari)}},_maybeParseAndSendUploadError:function(e,t,n,i){if(!n.success){if(i&&i.status!==200&&!n.error){this._options.callbacks.onError(e,t,"XHR returned response code "+i.status,i)}else{var r=n.error?n.error:this._options.text.defaultResponseError;this._options.callbacks.onError(e,t,r,i)}}},_maybeProcessNextItemAfterOnValidateCallback:function(e,t,n,i,r){var o=this;if(t.length>n){if(e||!this._options.validation.stopOnFirstInvalidFile){setTimeout(function(){var e=o._getValidationDescriptor(t[n]),s=o._getButtonId(t[n].file),a=o._getButton(s);o._handleCheckedCallback({name:"onValidate",callback:qq.bind(o._options.callbacks.onValidate,o,e,a),onSuccess:qq.bind(o._onValidateCallbackSuccess,o,t,n,i,r),onFailure:qq.bind(o._onValidateCallbackFailure,o,t,n,i,r),identifier:"Item '"+e.name+"', size: "+e.size})},0)}else if(!e){for(;n<t.length;n++){o._fileOrBlobRejected(t[n].id)}}}},_onAllComplete:function(e,t){this._totalProgress&&this._totalProgress.onAllComplete(e,t,this._preventRetries);this._options.callbacks.onAllComplete(qq.extend([],e),qq.extend([],t));this._succeededSinceLastAllComplete=[];this._failedSinceLastAllComplete=[]},_onAutoRetry:function(e,t,n,i,r){var o=this;o._preventRetries[e]=n[o._options.retry.preventRetryResponseProperty];if(o._shouldAutoRetry(e,t,n)){var s=o._options.retry.autoAttemptDelay*1e3;o._maybeParseAndSendUploadError.apply(o,arguments);o._options.callbacks.onAutoRetry(e,t,o._autoRetries[e]);o._onBeforeAutoRetry(e,t);o._uploadData.setStatus(e,qq.status.UPLOAD_RETRYING);o._retryTimeouts[e]=setTimeout(function(){o.log("Starting retry for "+t+"...");if(r){r(e)}else{o._handler.retry(e)}},s);return true}},_onBeforeAutoRetry:function(e,t){this.log("Waiting "+this._options.retry.autoAttemptDelay+" seconds before retrying "+t+"...")},_onBeforeManualRetry:function(e){var t=this._currentItemLimit,n;if(this._preventRetries[e]){this.log("Retries are forbidden for id "+e,"warn");return false}else if(this._handler.isValid(e)){n=this.getName(e);if(this._options.callbacks.onManualRetry(e,n)===false){return false}if(t>0&&this._netUploadedOrQueued+1>t){this._itemError("retryFailTooManyItems");return false}this.log("Retrying upload for '"+n+"' (id: "+e+")...");return true}else{this.log("'"+e+"' is not a valid file ID","error");return false}},_onCancel:function(e,t){this._netUploadedOrQueued--;clearTimeout(this._retryTimeouts[e]);var n=qq.indexOf(this._storedIds,e);if(!this._options.autoUpload&&n>=0){this._storedIds.splice(n,1)}this._uploadData.setStatus(e,qq.status.CANCELED)},_onComplete:function(e,t,n,i){if(!n.success){this._netUploadedOrQueued--;this._uploadData.setStatus(e,qq.status.UPLOAD_FAILED);if(n[this._options.retry.preventRetryResponseProperty]===true){this._preventRetries[e]=true}}else{if(n.thumbnailUrl){this._thumbnailUrls[e]=n.thumbnailUrl}this._netUploaded++;this._uploadData.setStatus(e,qq.status.UPLOAD_SUCCESSFUL)}this._maybeParseAndSendUploadError(e,t,n,i);return n.success?true:false},_onDelete:function(e){this._uploadData.setStatus(e,qq.status.DELETING)},_onDeleteComplete:function(e,t,n){var i=this.getName(e);if(n){this._handleDeleteFailed(e,t)}else{this._handleDeleteSuccess(e)}},_onInputChange:function(e){var t;if(qq.supportedFeatures.ajaxUploading){for(t=0;t<e.files.length;t++){this._annotateWithButtonId(e.files[t],e)}this.addFiles(e.files)}else if(e.value.length>0){this.addFiles(e)}qq.each(this._buttons,function(e,t){t.reset()})},_onProgress:function(e,t,n,i){this._totalProgress&&this._totalProgress.onIndividualProgress(e,n,i)},_onSubmit:function(e,t){},_onSubmitCallbackSuccess:function(e,t){this._onSubmit.apply(this,arguments);this._uploadData.setStatus(e,qq.status.SUBMITTED);this._onSubmitted.apply(this,arguments);if(this._options.autoUpload){this._options.callbacks.onSubmitted.apply(this,arguments);this._uploadFile(e)}else{this._storeForLater(e);this._options.callbacks.onSubmitted.apply(this,arguments)}},_onSubmitDelete:function(e,t,n){var i=this.getUuid(e),r;if(t){r=qq.bind(t,this,e,i,n)}if(this._isDeletePossible()){this._handleCheckedCallback({name:"onSubmitDelete",callback:qq.bind(this._options.callbacks.onSubmitDelete,this,e),onSuccess:r||qq.bind(this._deleteHandler.sendDelete,this,e,i,n),identifier:e});return true}else{this.log("Delete request ignored for ID "+e+", delete feature is disabled or request not possible "+"due to CORS on a user agent that does not support pre-flighting.","warn");return false}},_onSubmitted:function(e){},_onTotalProgress:function(e,t){this._options.callbacks.onTotalProgress(e,t)},_onUploadPrep:function(e){},_onUpload:function(e,t){this._uploadData.setStatus(e,qq.status.UPLOADING)},_onUploadChunk:function(e,t){},_onUploadStatusChange:function(e,t,n){if(n===qq.status.PAUSED){clearTimeout(this._retryTimeouts[e])}},_onValidateBatchCallbackFailure:function(e){var t=this;qq.each(e,function(e,n){t._fileOrBlobRejected(n.id)})},_onValidateBatchCallbackSuccess:function(e,t,n,i,r){var o,s=this._currentItemLimit,a=this._netUploadedOrQueued;if(s===0||a<=s){if(t.length>0){this._handleCheckedCallback({name:"onValidate",callback:qq.bind(this._options.callbacks.onValidate,this,e[0],r),onSuccess:qq.bind(this._onValidateCallbackSuccess,this,t,0,n,i),onFailure:qq.bind(this._onValidateCallbackFailure,this,t,0,n,i),identifier:"Item '"+t[0].file.name+"', size: "+t[0].file.size})}else{this._itemError("noFilesError")}}else{this._onValidateBatchCallbackFailure(t);o=this._options.messages.tooManyItemsError.replace(/\{netItems\}/g,a).replace(/\{itemLimit\}/g,s);this._batchError(o)}},_onValidateCallbackFailure:function(e,t,n,i){var r=t+1;this._fileOrBlobRejected(e[t].id,e[t].file.name);this._maybeProcessNextItemAfterOnValidateCallback(false,e,r,n,i)},_onValidateCallbackSuccess:function(e,t,n,i){var r=this,o=t+1,s=this._getValidationDescriptor(e[t]);this._validateFileOrBlobData(e[t],s).then(function(){r._upload(e[t].id,n,i);r._maybeProcessNextItemAfterOnValidateCallback(true,e,o,n,i)},function(){r._maybeProcessNextItemAfterOnValidateCallback(false,e,o,n,i)})},_prepareItemsForUpload:function(e,t,n){if(e.length===0){this._itemError("noFilesError");return}var i=this._getValidationDescriptors(e),r=this._getButtonId(e[0].file),o=this._getButton(r);this._handleCheckedCallback({name:"onValidateBatch",callback:qq.bind(this._options.callbacks.onValidateBatch,this,i,o),onSuccess:qq.bind(this._onValidateBatchCallbackSuccess,this,i,e,t,n,o),onFailure:qq.bind(this._onValidateBatchCallbackFailure,this,e),identifier:"batch validation"})},_preventLeaveInProgress:function(){var e=this;this._disposeSupport.attach(window,"beforeunload",function(t){if(e.getInProgress()){t=t||window.event;t.returnValue=e._options.messages.onLeave;return e._options.messages.onLeave}})},_refreshSessionData:function(){var e=this,t=this._options.session;if(qq.Session&&this._options.session.endpoint!=null){if(!this._session){qq.extend(t,{cors:this._options.cors});t.log=qq.bind(this.log,this);t.addFileRecord=qq.bind(this._addCannedFile,this);this._session=new qq.Session(t)}setTimeout(function(){e._session.refresh().then(function(t,n){e._sessionRequestComplete();e._options.callbacks.onSessionRequestComplete(t,true,n)},function(t,n){e._options.callbacks.onSessionRequestComplete(t,false,n)})},0)}},_sessionRequestComplete:function(){},_setSize:function(e,t){this._uploadData.updateSize(e,t);this._totalProgress&&this._totalProgress.onNewSize(e)},_shouldAutoRetry:function(e,t,n){var i=this._uploadData.retrieve({id:e});if(!this._preventRetries[e]&&this._options.retry.enableAuto&&i.status!==qq.status.PAUSED){if(this._autoRetries[e]===undefined){this._autoRetries[e]=0}if(this._autoRetries[e]<this._options.retry.maxAutoAttempts){this._autoRetries[e]+=1;return true}}return false},_storeForLater:function(e){this._storedIds.push(e)},_trackButton:function(e){var t;if(qq.supportedFeatures.ajaxUploading){t=this._handler.getFile(e).qqButtonId}else{t=this._getButtonId(this._handler.getInput(e))}if(t){this._buttonIdsForFileIds[e]=t}},_updateFormSupportAndParams:function(e){this._options.form.element=e;this._formSupport=qq.FormSupport&&new qq.FormSupport(this._options.form,qq.bind(this.uploadStoredFiles,this),qq.bind(this.log,this));if(this._formSupport&&this._formSupport.attachedToForm){this._paramsStore.addReadOnly(null,this._formSupport.getFormInputsAsObject);this._options.autoUpload=this._formSupport.newAutoUpload;if(this._formSupport.newEndpoint){this.setEndpoint(this._formSupport.newEndpoint)}}},_upload:function(e,t,n){var i=this.getName(e);if(t){this.setParams(t,e)}if(n){this.setEndpoint(n,e)}this._handleCheckedCallback({name:"onSubmit",callback:qq.bind(this._options.callbacks.onSubmit,this,e,i),onSuccess:qq.bind(this._onSubmitCallbackSuccess,this,e,i),onFailure:qq.bind(this._fileOrBlobRejected,this,e,i),identifier:e})},_uploadFile:function(e){if(!this._handler.upload(e)){this._uploadData.setStatus(e,qq.status.QUEUED)}},_uploadStoredFiles:function(){var e,t,n=this;while(this._storedIds.length){e=this._storedIds.shift();this._uploadFile(e)}t=this.getUploads({status:qq.status.SUBMITTING}).length;if(t){qq.log("Still waiting for "+t+" files to clear submit queue. Will re-parse stored IDs array shortly.");setTimeout(function(){n._uploadStoredFiles()},1e3)}},_validateFileOrBlobData:function(e,t){var n=this,i=function(){if(e.file instanceof qq.BlobProxy){return e.file.referenceBlob}return e.file}(),r=t.name,o=t.size,s=this._getButtonId(e.file),a=this._getValidationBase(s),l=new qq.Promise;l.then(function(){},function(){n._fileOrBlobRejected(e.id,r)});if(qq.isFileOrInput(i)&&!this._isAllowedExtension(a.allowedExtensions,r)){this._itemError("typeError",r,i);return l.failure()}if(!this._options.validation.allowEmpty&&o===0){this._itemError("emptyError",r,i);return l.failure()}if(o>0&&a.sizeLimit&&o>a.sizeLimit){this._itemError("sizeError",r,i);return l.failure()}if(o>0&&o<a.minSizeLimit){this._itemError("minSizeError",r,i);return l.failure()}if(qq.ImageValidation&&qq.supportedFeatures.imagePreviews&&qq.isFile(i)){new qq.ImageValidation(i,qq.bind(n.log,n)).validate(a.image).then(l.success,function(e){n._itemError(e+"ImageError",r,i);l.failure()})}else{l.success()}return l},_wrapCallbacks:function(){var e,t,n;e=this;t=function(t,n,i){var r;try{return n.apply(e,i)}catch(n){r=n.message||n.toString();e.log("Caught exception in '"+t+"' callback - "+r,"error")}};for(n in this._options.callbacks){(function(){var i,r;i=n;r=e._options.callbacks[i];e._options.callbacks[i]=function(){return t(i,r,arguments)}})()}}}})();(function(){"use strict";qq.FineUploaderBasic=function(e){var t=this;this._options={debug:false,button:null,multiple:true,maxConnections:3,disableCancelForFormUploads:false,autoUpload:true,request:{customHeaders:{},endpoint:"/server/upload",filenameParam:"qqfilename",forceMultipart:true,inputName:"qqfile",method:"POST",params:{},paramsInBody:true,totalFileSizeName:"qqtotalfilesize",uuidName:"qquuid"},validation:{allowedExtensions:[],sizeLimit:0,minSizeLimit:0,itemLimit:0,stopOnFirstInvalidFile:true,acceptFiles:null,image:{maxHeight:0,maxWidth:0,minHeight:0,minWidth:0},allowEmpty:false},callbacks:{onSubmit:function(e,t){},onSubmitted:function(e,t){},onComplete:function(e,t,n,i){},onAllComplete:function(e,t){},onCancel:function(e,t){},onUpload:function(e,t){},onUploadChunk:function(e,t,n){},onUploadChunkSuccess:function(e,t,n,i){},onResume:function(e,t,n){},onProgress:function(e,t,n,i){},onTotalProgress:function(e,t){},onError:function(e,t,n,i){},onAutoRetry:function(e,t,n){},onManualRetry:function(e,t){},onValidateBatch:function(e){},onValidate:function(e){},onSubmitDelete:function(e){},onDelete:function(e){},onDeleteComplete:function(e,t,n){},onPasteReceived:function(e){},onStatusChange:function(e,t,n){},onSessionRequestComplete:function(e,t,n){}},messages:{typeError:"{file} has an invalid extension. Valid extension(s): {extensions}.",sizeError:"{file} is too large, maximum file size is {sizeLimit}.",minSizeError:"{file} is too small, minimum file size is {minSizeLimit}.",emptyError:"{file} is empty, please select files again without it.",noFilesError:"No files to upload.",tooManyItemsError:"Too many items ({netItems}) would be uploaded.  Item limit is {itemLimit}.",maxHeightImageError:"Image is too tall.",maxWidthImageError:"Image is too wide.",minHeightImageError:"Image is not tall enough.",minWidthImageError:"Image is not wide enough.",retryFailTooManyItems:"Retry failed - you have reached your file limit.",onLeave:"The files are being uploaded, if you leave now the upload will be canceled.",unsupportedBrowserIos8Safari:"Unrecoverable error - this browser does not permit file uploading of any kind due to serious bugs in iOS8 Safari.  Please use iOS8 Chrome until Apple fixes these issues."},retry:{enableAuto:false,maxAutoAttempts:3,autoAttemptDelay:5,preventRetryResponseProperty:"preventRetry"},classes:{buttonHover:"qq-upload-button-hover",buttonFocus:"qq-upload-button-focus"},chunking:{enabled:false,concurrent:{enabled:false},mandatory:false,paramNames:{partIndex:"qqpartindex",partByteOffset:"qqpartbyteoffset",chunkSize:"qqchunksize",totalFileSize:"qqtotalfilesize",totalParts:"qqtotalparts"},partSize:2e6,success:{endpoint:null}},resume:{enabled:false,recordsExpireIn:7,paramNames:{resuming:"qqresume"}},formatFileName:function(e){return e},text:{defaultResponseError:"Upload failure reason unknown",fileInputTitle:"file input",sizeSymbols:["kB","MB","GB","TB","PB","EB"]},deleteFile:{enabled:false,method:"DELETE",endpoint:"/server/upload",customHeaders:{},params:{}},cors:{expected:false,sendCredentials:false,allowXdr:false},blobs:{defaultName:"misc_data"},paste:{targetElement:null,defaultName:"pasted_image"},camera:{ios:false,button:null},extraButtons:[],session:{endpoint:null,params:{},customHeaders:{},refreshOnReset:true},form:{element:"qq-form",autoUpload:false,interceptSubmit:true},scaling:{customResizer:null,sendOriginal:true,orient:true,defaultType:null,defaultQuality:80,failureText:"Failed to scale",includeExif:false,sizes:[]},workarounds:{iosEmptyVideos:true,ios8SafariUploads:true,ios8BrowserCrash:false}};qq.extend(this._options,e,true);this._buttons=[];this._extraButtonSpecs={};this._buttonIdsForFileIds=[];this._wrapCallbacks();this._disposeSupport=new qq.DisposeSupport;this._storedIds=[];this._autoRetries=[];this._retryTimeouts=[];this._preventRetries=[];this._thumbnailUrls=[];this._netUploadedOrQueued=0;this._netUploaded=0;this._uploadData=this._createUploadDataTracker();this._initFormSupportAndParams();this._customHeadersStore=this._createStore(this._options.request.customHeaders);this._deleteFileCustomHeadersStore=this._createStore(this._options.deleteFile.customHeaders);this._deleteFileParamsStore=this._createStore(this._options.deleteFile.params);this._endpointStore=this._createStore(this._options.request.endpoint);this._deleteFileEndpointStore=this._createStore(this._options.deleteFile.endpoint);this._handler=this._createUploadHandler();this._deleteHandler=qq.DeleteFileAjaxRequester&&this._createDeleteHandler();if(this._options.button){this._defaultButtonId=this._createUploadButton({element:this._options.button,title:this._options.text.fileInputTitle}).getButtonId()}this._generateExtraButtonSpecs();this._handleCameraAccess();if(this._options.paste.targetElement){if(qq.PasteSupport){this._pasteHandler=this._createPasteHandler()}else{this.log("Paste support module not found","error")}}this._preventLeaveInProgress();this._imageGenerator=qq.ImageGenerator&&new qq.ImageGenerator(qq.bind(this.log,this));this._refreshSessionData();this._succeededSinceLastAllComplete=[];this._failedSinceLastAllComplete=[];this._scaler=qq.Scaler&&new qq.Scaler(this._options.scaling,qq.bind(this.log,this))||{};if(this._scaler.enabled){this._customNewFileHandler=qq.bind(this._scaler.handleNewFile,this._scaler)}if(qq.TotalProgress&&qq.supportedFeatures.progressBar){this._totalProgress=new qq.TotalProgress(qq.bind(this._onTotalProgress,this),function(e){var n=t._uploadData.retrieve({id:e});return n&&n.size||0})}this._currentItemLimit=this._options.validation.itemLimit};qq.FineUploaderBasic.prototype=qq.basePublicApi;qq.extend(qq.FineUploaderBasic.prototype,qq.basePrivateApi)})();qq.AjaxRequester=function(e){"use strict";var t,n,i=[],r={},o={acceptHeader:null,validMethods:["PATCH","POST","PUT"],method:"POST",contentType:"application/x-www-form-urlencoded",maxConnections:3,customHeaders:{},endpointStore:{},paramsStore:{},mandatedParams:{},allowXRequestedWithAndCacheControl:true,successfulResponseCodes:{DELETE:[200,202,204],PATCH:[200,201,202,203,204],POST:[200,201,202,203,204],PUT:[200,201,202,203,204],GET:[200]},cors:{expected:false,sendCredentials:false},log:function(e,t){},onSend:function(e){},onComplete:function(e,t,n){},onProgress:null};qq.extend(o,e);t=o.log;if(qq.indexOf(o.validMethods,o.method)<0){throw new Error("'"+o.method+"' is not a supported method for this type of request!")}function s(){return qq.indexOf(["GET","POST","HEAD"],o.method)>=0}function a(e){var t=false;qq.each(t,function(e,n){if(qq.indexOf(["Accept","Accept-Language","Content-Language","Content-Type"],n)<0){t=true;return false}});return t}function l(e){return o.cors.expected&&e.withCredentials===undefined}function u(){var e;if(window.XMLHttpRequest||window.ActiveXObject){e=qq.createXhrInstance();if(e.withCredentials===undefined){e=new XDomainRequest;e.onload=function(){};e.onerror=function(){};e.ontimeout=function(){};e.onprogress=function(){}}}return e}function c(e,t){var n=r[e].xhr;if(!n){if(t){n=t}else{if(o.cors.expected){n=u()}else{n=qq.createXhrInstance()}}r[e].xhr=n}return n}function d(e){var t=qq.indexOf(i,e),n=o.maxConnections,s;delete r[e];i.splice(t,1);if(i.length>=n&&t<n){s=i[n-1];h(s)}}function f(e,n){var i=c(e),r=o.method,s=n===true;d(e);if(s){t(r+" request for "+e+" has failed","error")}else if(!l(i)&&!y(i.status)){s=true;t(r+" request for "+e+" has failed - response code "+i.status,"error")}o.onComplete(e,i,s)}function p(e){var t=r[e].additionalParams,n=o.mandatedParams,i;if(o.paramsStore.get){i=o.paramsStore.get(e)}if(t){qq.each(t,function(e,t){i=i||{};i[e]=t})}if(n){qq.each(n,function(e,t){i=i||{};i[e]=t})}return i}function h(e,i){var s=c(e,i),a=o.method,u=p(e),d=r[e].payload,f;o.onSend(e);f=q(e,u,r[e].additionalQueryParams);if(l(s)){s.onload=_(e);s.onerror=v(e)}else{s.onreadystatechange=g(e)}m(e);s.open(a,f,true);if(o.cors.expected&&o.cors.sendCredentials&&!l(s)){s.withCredentials=true}b(e);t("Sending "+a+" request for "+e);if(d){s.send(d)}else if(n||!u){s.send()}else if(u&&o.contentType&&o.contentType.toLowerCase().indexOf("application/x-www-form-urlencoded")>=0){s.send(qq.obj2url(u,""))}else if(u&&o.contentType&&o.contentType.toLowerCase().indexOf("application/json")>=0){s.send(JSON.stringify(u))}else{s.send(u)}return s}function q(e,t,i){var s=o.endpointStore.get(e),a=r[e].addToPath;if(a!=undefined){s+="/"+a}if(n&&t){s=qq.obj2url(t,s)}if(i){s=qq.obj2url(i,s)}return s}function g(e){return function(){if(c(e).readyState===4){f(e)}}}function m(e){var t=o.onProgress;if(t){c(e).upload.onprogress=function(n){if(n.lengthComputable){t(e,n.loaded,n.total)}}}}function _(e){return function(){f(e)}}function v(e){return function(){f(e,true)}}function b(e){var t=c(e),n=o.customHeaders,i=r[e].additionalHeaders||{},u=o.method,d={};if(!l(t)){o.acceptHeader&&t.setRequestHeader("Accept",o.acceptHeader);if(o.allowXRequestedWithAndCacheControl){if(!o.cors.expected||(!s()||a(n))){t.setRequestHeader("X-Requested-With","XMLHttpRequest");t.setRequestHeader("Cache-Control","no-cache")}}if(o.contentType&&(u==="POST"||u==="PUT")){t.setRequestHeader("Content-Type",o.contentType)}qq.extend(d,qq.isFunction(n)?n(e):n);qq.extend(d,i);qq.each(d,function(e,n){t.setRequestHeader(e,n)})}}function y(e){return qq.indexOf(o.successfulResponseCodes[o.method],e)>=0}function S(e,t,n,s,a,l,u){r[e]={addToPath:n,additionalParams:s,additionalQueryParams:a,additionalHeaders:l,payload:u};var c=i.push(e);if(c<=o.maxConnections){return h(e,t)}}n=o.method==="GET"||o.method==="DELETE";qq.extend(this,{initTransport:function(e){var t,n,i,r,s,a;return{withPath:function(e){t=e;return this},withParams:function(e){n=e;return this},withQueryParams:function(e){a=e;return this},withHeaders:function(e){i=e;return this},withPayload:function(e){r=e;return this},withCacheBuster:function(){s=true;return this},send:function(l){if(s&&qq.indexOf(["GET","DELETE"],o.method)>=0){n.qqtimestamp=(new Date).getTime()}return S(e,l,t,n,a,i,r)}}},canceled:function(e){d(e)}})};qq.UploadHandler=function(e){"use strict";var t=e.proxy,n={},i=t.onCancel,r=t.getName;qq.extend(this,{add:function(e,t){n[e]=t;n[e].temp={}},cancel:function(e){var t=this,o=new qq.Promise,s=i(e,r(e),o);s.then(function(){if(t.isValid(e)){n[e].canceled=true;t.expunge(e)}o.success()})},expunge:function(e){delete n[e]},getThirdPartyFileId:function(e){return n[e].key},isValid:function(e){return n[e]!==undefined},reset:function(){n={}},_getFileState:function(e){return n[e]},_setThirdPartyFileId:function(e,t){n[e].key=t},_wasCanceled:function(e){return!!n[e].canceled}})};qq.UploadHandlerController=function(e,t){"use strict";var n=this,i=false,r=false,o,s,a,l,u={paramsStore:{},maxConnections:3,chunking:{enabled:false,multiple:{enabled:false}},log:function(e,t){},onProgress:function(e,t,n,i){},onComplete:function(e,t,n,i){},onCancel:function(e,t){},onUploadPrep:function(e){},onUpload:function(e,t){},onUploadChunk:function(e,t,n){},onUploadChunkSuccess:function(e,t,n,i){},onAutoRetry:function(e,t,n,i){},onResume:function(e,t,n){},onUuidChanged:function(e,t){},getName:function(e){},setSize:function(e,t){},isQueued:function(e){},getIdsInProxyGroup:function(e){},getIdsInBatch:function(e){}},c={done:function(e,t,n,i){var r=l._getChunkData(e,t);l._getFileState(e).attemptingResume=false;delete l._getFileState(e).temp.chunkProgress[t];l._getFileState(e).loaded+=r.size;u.onUploadChunkSuccess(e,l._getChunkDataForCallback(r),n,i)},finalize:function(e){var t=u.getSize(e),n=u.getName(e);a("All chunks have been uploaded for "+e+" - finalizing....");l.finalizeChunks(e).then(function(i,r){a("Finalize successful for "+e);var o=p.normalizeResponse(i,true);u.onProgress(e,n,t,t);l._maybeDeletePersistedChunkData(e);p.cleanup(e,o,r)},function(t,i){var r=p.normalizeResponse(t,false);a("Problem finalizing chunks for file ID "+e+" - "+r.error,"error");if(r.reset){c.reset(e)}if(!u.onAutoRetry(e,n,r,i)){p.cleanup(e,r,i)}})},handleFailure:function(e,t,n,i){var o=u.getName(t);a("Chunked upload request failed for "+t+", chunk "+e);l.clearCachedChunk(t,e);var s=p.normalizeResponse(n,false),f;if(s.reset){c.reset(t)}else{f=qq.indexOf(l._getFileState(t).chunking.inProgress,e);if(f>=0){l._getFileState(t).chunking.inProgress.splice(f,1);l._getFileState(t).chunking.remaining.unshift(e)}}if(!l._getFileState(t).temp.ignoreFailure){if(r){l._getFileState(t).temp.ignoreFailure=true;a(qq.format("Going to attempt to abort these chunks: {}. These are currently in-progress: {}.",JSON.stringify(Object.keys(l._getXhrs(t))),JSON.stringify(l._getFileState(t).chunking.inProgress)));qq.each(l._getXhrs(t),function(e,n){a(qq.format("Attempting to abort file {}.{}. XHR readyState {}. ",t,e,n.readyState));n.abort();n._cancelled=true});l.moveInProgressToRemaining(t);d.free(t,true)}if(!u.onAutoRetry(t,o,s,i)){p.cleanup(t,s,i)}}},hasMoreParts:function(e){return!!l._getFileState(e).chunking.remaining.length},nextPart:function(e){var t=l._getFileState(e).chunking.remaining.shift();if(t>=l._getTotalChunks(e)){t=null}return t},reset:function(e){a("Server or callback has ordered chunking effort to be restarted on next attempt for item ID "+e,"error");l._maybeDeletePersistedChunkData(e);l.reevaluateChunking(e);l._getFileState(e).loaded=0},sendNext:function(e){var t=u.getSize(e),n=u.getName(e),i=c.nextPart(e),o=l._getChunkData(e,i),s=l._getFileState(e).attemptingResume,f=l._getFileState(e).chunking.inProgress||[];if(l._getFileState(e).loaded==null){l._getFileState(e).loaded=0}if(s&&u.onResume(e,n,o)===false){c.reset(e);i=c.nextPart(e);o=l._getChunkData(e,i);s=false}if(i==null&&f.length===0){c.finalize(e)}else{a(qq.format("Sending chunked upload request for item {}.{}, bytes {}-{} of {}.",e,i,o.start+1,o.end,t));u.onUploadChunk(e,n,l._getChunkDataForCallback(o));f.push(i);l._getFileState(e).chunking.inProgress=f;if(r){d.open(e,i)}if(r&&d.available()&&l._getFileState(e).chunking.remaining.length){c.sendNext(e)}if(o.blob.size===0){a(qq.format("Chunk {} for file {} will not be uploaded, zero sized chunk.",i,e),"error");c.handleFailure(i,e,"File is no longer available",null)}else{l.uploadChunk(e,i,s).then(function t(n,r){a("Chunked upload request succeeded for "+e+", chunk "+i);l.clearCachedChunk(e,i);var o=l._getFileState(e).chunking.inProgress||[],s=p.normalizeResponse(n,true),u=qq.indexOf(o,i);a(qq.format("Chunk {} for file {} uploaded successfully.",i,e));c.done(e,i,s,r);if(u>=0){o.splice(u,1)}l._maybePersistChunkedState(e);if(!c.hasMoreParts(e)&&o.length===0){c.finalize(e)}else if(c.hasMoreParts(e)){c.sendNext(e)}else{a(qq.format("File ID {} has no more chunks to send and these chunk indexes are still marked as in-progress: {}",e,JSON.stringify(o)))}},function t(n,r){c.handleFailure(i,e,n,r)}).done(function(){l.clearXhr(e,i)})}}}},d={_open:[],_openChunks:{},_waiting:[],available:function(){var e=u.maxConnections,t=0,n=0;qq.each(d._openChunks,function(e,i){t++;n+=i.length});return e-(d._open.length-t+n)},free:function(e,t){var n=!t,i=qq.indexOf(d._waiting,e),r=qq.indexOf(d._open,e),o;delete d._openChunks[e];if(p.getProxyOrBlob(e)instanceof qq.BlobProxy){a("Generated blob upload has ended for "+e+", disposing generated blob.");delete l._getFileState(e).file}if(i>=0){d._waiting.splice(i,1)}else if(n&&r>=0){d._open.splice(r,1);o=d._waiting.shift();if(o>=0){d._open.push(o);p.start(o)}}},getWaitingOrConnected:function(){var e=[];qq.each(d._openChunks,function(t,n){if(n&&n.length){e.push(parseInt(t))}});qq.each(d._open,function(t,n){if(!d._openChunks[n]){e.push(parseInt(n))}});e=e.concat(d._waiting);return e},isUsingConnection:function(e){return qq.indexOf(d._open,e)>=0},open:function(e,t){if(t==null){d._waiting.push(e)}if(d.available()){if(t==null){d._waiting.pop();d._open.push(e)}else{(function(){var n=d._openChunks[e]||[];n.push(t);d._openChunks[e]=n})()}return true}return false},reset:function(){d._waiting=[];d._open=[]}},f={send:function(e,t){l._getFileState(e).loaded=0;a("Sending simple upload request for "+e);l.uploadFile(e).then(function(n,i){a("Simple upload request succeeded for "+e);var r=p.normalizeResponse(n,true),o=u.getSize(e);u.onProgress(e,t,o,o);p.maybeNewUuid(e,r);p.cleanup(e,r,i)},function(n,i){a("Simple upload request failed for "+e);var r=p.normalizeResponse(n,false);if(!u.onAutoRetry(e,t,r,i)){p.cleanup(e,r,i)}})}},p={cancel:function(e){a("Cancelling "+e);u.paramsStore.remove(e);d.free(e)},cleanup:function(e,t,n){var i=u.getName(e);u.onComplete(e,i,t,n);if(l._getFileState(e)){l._clearXhrs&&l._clearXhrs(e)}d.free(e)},getProxyOrBlob:function(e){return l.getProxy&&l.getProxy(e)||l.getFile&&l.getFile(e)},initHandler:function(){var e=t?qq[t]:qq.traditional,n=qq.supportedFeatures.ajaxUploading?"Xhr":"Form";l=new e[n+"UploadHandler"](u,{getDataByUuid:u.getDataByUuid,getName:u.getName,getSize:u.getSize,getUuid:u.getUuid,log:a,onCancel:u.onCancel,onProgress:u.onProgress,onUuidChanged:u.onUuidChanged});if(l._removeExpiredChunkingRecords){l._removeExpiredChunkingRecords()}},isDeferredEligibleForUpload:function(e){return u.isQueued(e)},maybeDefer:function(e,t){if(t&&!l.getFile(e)&&t instanceof qq.BlobProxy){u.onUploadPrep(e);a("Attempting to generate a blob on-demand for "+e);t.create().then(function(t){a("Generated an on-demand blob for "+e);l.updateBlob(e,t);u.setSize(e,t.size);l.reevaluateChunking(e);p.maybeSendDeferredFiles(e)},function(t){var n={};if(t){n.error=t}a(qq.format("Failed to generate blob for ID {}.  Error message: {}.",e,t),"error");u.onComplete(e,u.getName(e),qq.extend(n,s),null);p.maybeSendDeferredFiles(e);d.free(e)})}else{return p.maybeSendDeferredFiles(e)}return false},maybeSendDeferredFiles:function(e){var t=u.getIdsInProxyGroup(e),n=false;if(t&&t.length){a("Maybe ready to upload proxy group file "+e);qq.each(t,function(t,i){if(p.isDeferredEligibleForUpload(i)&&!!l.getFile(i)){n=i===e;p.now(i)}else if(p.isDeferredEligibleForUpload(i)){return false}})}else{n=true;p.now(e)}return n},maybeNewUuid:function(e,t){if(t.newUuid!==undefined){u.onUuidChanged(e,t.newUuid)}},normalizeResponse:function(e,t){var n=e;if(!qq.isObject(e)){n={};if(qq.isString(e)&&!t){n.error=e}}n.success=t;return n},now:function(e){var t=u.getName(e);if(!n.isValid(e)){throw new qq.Error(e+" is not a valid file ID to upload!")}u.onUpload(e,t);if(i&&l._shouldChunkThisFile(e)){c.sendNext(e)}else{f.send(e,t)}},start:function(e){var t=p.getProxyOrBlob(e);if(t){return p.maybeDefer(e,t)}else{p.now(e);return true}}};qq.extend(this,{add:function(e,t){l.add.apply(this,arguments)},upload:function(e){if(d.open(e)){return p.start(e)}return false},retry:function(e){if(r){l._getFileState(e).temp.ignoreFailure=false}if(d.isUsingConnection(e)){return p.start(e)}else{return n.upload(e)}},cancel:function(e){var t=l.cancel(e);if(qq.isGenericPromise(t)){t.then(function(){p.cancel(e)})}else if(t!==false){p.cancel(e)}},cancelAll:function(){var e=d.getWaitingOrConnected(),t;if(e.length){for(t=e.length-1;t>=0;t--){n.cancel(e[t])}}d.reset()},getFile:function(e){if(l.getProxy&&l.getProxy(e)){return l.getProxy(e).referenceBlob}return l.getFile&&l.getFile(e)},isProxied:function(e){return!!(l.getProxy&&l.getProxy(e))},getInput:function(e){if(l.getInput){return l.getInput(e)}},reset:function(){a("Resetting upload handler");n.cancelAll();d.reset();l.reset()},expunge:function(e){if(n.isValid(e)){return l.expunge(e)}},isValid:function(e){return l.isValid(e)},getResumableFilesData:function(){if(l.getResumableFilesData){return l.getResumableFilesData()}return[]},getThirdPartyFileId:function(e){if(n.isValid(e)){return l.getThirdPartyFileId(e)}},pause:function(e){if(n.isResumable(e)&&l.pause&&n.isValid(e)&&l.pause(e)){d.free(e);l.moveInProgressToRemaining(e);return true}return false},isResumable:function(e){return!!l.isResumable&&l.isResumable(e)}});qq.extend(u,e);a=u.log;i=u.chunking.enabled&&qq.supportedFeatures.chunking;r=i&&u.chunking.concurrent.enabled;s=function(){var e={};e[u.preventRetryParam]=true;return e}();p.initHandler()};qq.WindowReceiveMessage=function(e){"use strict";var t={log:function(e,t){}},n={};qq.extend(t,e);qq.extend(this,{receiveMessage:function(e,t){var i=function(e){t(e.data)};if(window.postMessage){n[e]=qq(window).attach("message",i)}else{log("iframe message passing not supported in this browser!","error")}},stopReceivingMessages:function(e){if(window.postMessage){var t=n[e];if(t){t()}}}})};qq.FormUploadHandler=function(e){"use strict";var t=e.options,n=this,i=e.proxy,r=qq.getUniqueId(),o={},s={},a={},l=t.isCors,u=t.inputName,c=i.getUuid,d=i.log,f=new qq.WindowReceiveMessage({log:d});function p(e){delete s[e];if(l){clearTimeout(a[e]);delete a[e];f.stopReceivingMessages(e)}var t=document.getElementById(n._getIframeName(e));if(t){t.setAttribute("src","javascript:false;");qq(t).remove()}}function h(e){return e.split("_")[0]}function q(e){var t=qq.toElement("<iframe src='javascript:false;' name='"+e+"' />");t.setAttribute("id",e);t.style.display="none";document.body.appendChild(t);return t}function g(e,t){var i=e.id,r=h(i),l=c(r);o[l]=t;s[r]=qq(e).attach("load",function(){if(n.getInput(r)){d("Received iframe load event for CORS upload request (iframe name "+i+")");a[i]=setTimeout(function(){var e="No valid message received from loaded iframe for iframe name "+i;d(e,"error");t({error:e})},1e3)}});f.receiveMessage(i,function(e){d("Received the following window message: '"+e+"'");var t=h(i),r=n._parseJsonResponse(e),s=r.uuid,l;if(s&&o[s]){d("Handling response for iframe name "+i);clearTimeout(a[i]);delete a[i];n._detachLoadEvent(i);l=o[s];delete o[s];f.stopReceivingMessages(i);l(r)}else if(!s){d("'"+e+"' does not contain a UUID - ignoring.")}})}qq.extend(this,new qq.UploadHandler(e));qq.override(this,function(e){return{add:function(t,n){e.add(t,{input:n});n.setAttribute("name",u);if(n.parentNode){qq(n).remove()}},expunge:function(t){p(t);e.expunge(t)},isValid:function(t){return e.isValid(t)&&n._getFileState(t).input!==undefined}}});qq.extend(this,{getInput:function(e){return n._getFileState(e).input},_attachLoadEvent:function(e,t){var n;if(l){g(e,t)}else{s[e.id]=qq(e).attach("load",function(){d("Received response for "+e.id);if(!e.parentNode){return}try{if(e.contentDocument&&e.contentDocument.body&&e.contentDocument.body.innerHTML=="false"){return}}catch(e){d("Error when attempting to access iframe during handling of upload response ("+e.message+")","error");n={success:false}}t(n)})}},_createIframe:function(e){var t=n._getIframeName(e);return q(t)},_detachLoadEvent:function(e){if(s[e]!==undefined){s[e]();delete s[e]}},_getIframeName:function(e){return e+"_"+r},_initFormForUpload:function(e){var t=e.method,n=e.endpoint,i=e.params,r=e.paramsInBody,o=e.targetName,s=qq.toElement("<form method='"+t+"' enctype='multipart/form-data'></form>"),a=n;if(r){qq.obj2Inputs(i,s)}else{a=qq.obj2url(i,n)}s.setAttribute("action",a);s.setAttribute("target",o);s.style.display="none";document.body.appendChild(s);return s},_parseJsonResponse:function(e){var t={};try{t=qq.parseJson(e)}catch(e){d("Error when attempting to parse iframe upload response ("+e.message+")","error")}return t}})};qq.XhrUploadHandler=function(e){"use strict";var t=this,n=e.options.namespace,i=e.proxy,r=e.options.chunking,o=e.options.resume,s=r&&e.options.chunking.enabled&&qq.supportedFeatures.chunking,a=o&&e.options.resume.enabled&&s&&qq.supportedFeatures.resume,l=i.getName,u=i.getSize,c=i.getUuid,d=i.getEndpoint,f=i.getDataByUuid,p=i.onUuidChanged,h=i.onProgress,q=i.log;function g(e){qq.each(t._getXhrs(e),function(n,i){var r=t._getAjaxRequester(e,n);i.onreadystatechange=null;i.upload.onprogress=null;i.abort();r&&r.canceled&&r.canceled(e)})}qq.extend(this,new qq.UploadHandler(e));qq.override(this,function(e){return{add:function(n,i){if(qq.isFile(i)||qq.isBlob(i)){e.add(n,{file:i})}else if(i instanceof qq.BlobProxy){e.add(n,{proxy:i})}else{throw new Error("Passed obj is not a File, Blob, or proxy")}t._initTempState(n);a&&t._maybePrepareForResume(n)},expunge:function(n){g(n);t._maybeDeletePersistedChunkData(n);t._clearXhrs(n);e.expunge(n)}}});qq.extend(this,{clearCachedChunk:function(e,n){delete t._getFileState(e).temp.cachedChunks[n]},clearXhr:function(e,n){var i=t._getFileState(e).temp;if(i.xhrs){delete i.xhrs[n]}if(i.ajaxRequesters){delete i.ajaxRequesters[n]}},finalizeChunks:function(e,n){var i=t._getTotalChunks(e)-1,r=t._getXhr(e,i);if(n){return(new qq.Promise).success(n(r),r)}return(new qq.Promise).success({},r)},getFile:function(e){return t.isValid(e)&&t._getFileState(e).file},getProxy:function(e){return t.isValid(e)&&t._getFileState(e).proxy},getResumableFilesData:function(){var e=[];t._iterateResumeRecords(function(n,i){t.moveInProgressToRemaining(null,i.chunking.inProgress,i.chunking.remaining);var r={name:i.name,remaining:i.chunking.remaining,size:i.size,uuid:i.uuid};if(i.key){r.key=i.key}e.push(r)});return e},isResumable:function(e){return!!r&&t.isValid(e)&&!t._getFileState(e).notResumable},moveInProgressToRemaining:function(e,n,i){var r=n||t._getFileState(e).chunking.inProgress,o=i||t._getFileState(e).chunking.remaining;if(r){q(qq.format("Moving these chunks from in-progress {}, to remaining.",JSON.stringify(r)));r.reverse();qq.each(r,function(e,t){o.unshift(t)});r.length=0}},pause:function(e){if(t.isValid(e)){q(qq.format("Aborting XHR upload for {} '{}' due to pause instruction.",e,l(e)));t._getFileState(e).paused=true;g(e);return true}},reevaluateChunking:function(e){if(r&&t.isValid(e)){var n=t._getFileState(e),i,o;delete n.chunking;n.chunking={};i=t._getTotalChunks(e);if(i>1||r.mandatory){n.chunking.enabled=true;n.chunking.parts=i;n.chunking.remaining=[];for(o=0;o<i;o++){n.chunking.remaining.push(o)}t._initTempState(e)}else{n.chunking.enabled=false}}},updateBlob:function(e,n){if(t.isValid(e)){t._getFileState(e).file=n}},_clearXhrs:function(e){var n=t._getFileState(e).temp;qq.each(n.ajaxRequesters,function(e){delete n.ajaxRequesters[e]});qq.each(n.xhrs,function(e){delete n.xhrs[e]})},_createXhr:function(e,n){return t._registerXhr(e,n,qq.createXhrInstance())},_getAjaxRequester:function(e,n){var i=n==null?-1:n;return t._getFileState(e).temp.ajaxRequesters[i]},_getChunkData:function(e,n){var i=r.partSize,o=u(e),s=t.getFile(e),a=i*n,l=a+i>=o?o:a+i,c=t._getTotalChunks(e),d=this._getFileState(e).temp.cachedChunks,f=d[n]||qq.sliceBlob(s,a,l);d[n]=f;return{part:n,start:a,end:l,count:c,blob:f,size:l-a}},_getChunkDataForCallback:function(e){return{partIndex:e.part,startByte:e.start+1,endByte:e.end,totalParts:e.count}},_getLocalStorageId:function(e){var t="5.0",i=l(e),o=u(e),s=r.partSize,a=d(e);return qq.format("qq{}resume{}-{}-{}-{}-{}",n,t,i,o,s,a)},_getMimeType:function(e){return t.getFile(e).type},_getPersistableData:function(e){return t._getFileState(e).chunking},_getTotalChunks:function(e){if(r){var t=u(e),n=r.partSize;return Math.ceil(t/n)}},_getXhr:function(e,n){var i=n==null?-1:n;return t._getFileState(e).temp.xhrs[i]},_getXhrs:function(e){return t._getFileState(e).temp.xhrs},_iterateResumeRecords:function(e){if(a){qq.each(localStorage,function(t,i){if(t.indexOf(qq.format("qq{}resume",n))===0){var r=JSON.parse(i);e(t,r)}})}},_initTempState:function(e){t._getFileState(e).temp={ajaxRequesters:{},chunkProgress:{},xhrs:{},cachedChunks:{}}},_markNotResumable:function(e){t._getFileState(e).notResumable=true},_maybeDeletePersistedChunkData:function(e){var n;if(a&&t.isResumable(e)){n=t._getLocalStorageId(e);if(n&&localStorage.getItem(n)){localStorage.removeItem(n);return true}}return false},_maybePrepareForResume:function(e){var n=t._getFileState(e),i,r;if(a&&n.key===undefined){i=t._getLocalStorageId(e);r=localStorage.getItem(i);if(r){r=JSON.parse(r);if(f(r.uuid)){t._markNotResumable(e)}else{q(qq.format("Identified file with ID {} and name of {} as resumable.",e,l(e)));p(e,r.uuid);n.key=r.key;n.chunking=r.chunking;n.loaded=r.loaded;n.attemptingResume=true;t.moveInProgressToRemaining(e)}}}},_maybePersistChunkedState:function(e){var n=t._getFileState(e),i,r;if(a&&t.isResumable(e)){i=t._getLocalStorageId(e);r={name:l(e),size:u(e),uuid:c(e),key:n.key,chunking:n.chunking,loaded:n.loaded,lastUpdated:Date.now()};try{localStorage.setItem(i,JSON.stringify(r))}catch(t){q(qq.format("Unable to save resume data for '{}' due to error: '{}'.",e,t.toString()),"warn")}}},_registerProgressHandler:function(e,n,i){var r=t._getXhr(e,n),o=l(e),s={simple:function(t,n){var i=u(e);if(t===n){h(e,o,i,i)}else{h(e,o,t>=i?i-1:t,i)}},chunked:function(r,s){var a=t._getFileState(e).temp.chunkProgress,l=t._getFileState(e).loaded,c=r,d=s,f=u(e),p=c-(d-i),q=l;a[n]=p;qq.each(a,function(e,t){q+=t});h(e,o,q,f)}};r.upload.onprogress=function(e){if(e.lengthComputable){var t=i==null?"simple":"chunked";s[t](e.loaded,e.total)}}},_registerXhr:function(e,n,i,r){var o=n==null?-1:n,s=t._getFileState(e).temp;s.xhrs=s.xhrs||{};s.ajaxRequesters=s.ajaxRequesters||{};s.xhrs[o]=i;if(r){s.ajaxRequesters[o]=r}return i},_removeExpiredChunkingRecords:function(){var e=o.recordsExpireIn;t._iterateResumeRecords(function(t,n){var i=new Date(n.lastUpdated);i.setDate(i.getDate()+e);if(i.getTime()<=Date.now()){q("Removing expired resume record with key "+t);localStorage.removeItem(t)}})},_shouldChunkThisFile:function(e){var n=t._getFileState(e);if(!n.chunking){t.reevaluateChunking(e)}return n.chunking.enabled}})};qq.DeleteFileAjaxRequester=function(e){"use strict";var t,n={method:"DELETE",uuidParamName:"qquuid",endpointStore:{},maxConnections:3,customHeaders:function(e){return{}},paramsStore:{},cors:{expected:false,sendCredentials:false},log:function(e,t){},onDelete:function(e){},onDeleteComplete:function(e,t,n){}};qq.extend(n,e);function i(){if(n.method.toUpperCase()==="POST"){return{_method:"DELETE"}}return{}}t=qq.extend(this,new qq.AjaxRequester({acceptHeader:"application/json",validMethods:["POST","DELETE"],method:n.method,endpointStore:n.endpointStore,paramsStore:n.paramsStore,mandatedParams:i(),maxConnections:n.maxConnections,customHeaders:function(e){return n.customHeaders.get(e)},log:n.log,onSend:n.onDelete,onComplete:n.onDeleteComplete,cors:n.cors}));qq.extend(this,{sendDelete:function(e,i,r){var o=r||{};n.log("Submitting delete file request for "+e);if(n.method==="DELETE"){t.initTransport(e).withPath(i).withParams(o).send()}else{o[n.uuidParamName]=i;t.initTransport(e).withParams(o).send()}}})};(function(){function e(e){var t=e.naturalWidth,n=e.naturalHeight,i=document.createElement("canvas"),r;if(t*n>1024*1024){i.width=i.height=1;r=i.getContext("2d");r.drawImage(e,-t+1,0);return r.getImageData(0,0,1,1).data[3]===0}else{return false}}function t(e,t,n){var i=document.createElement("canvas"),r=0,o=n,s=n,a,l,u,c;i.width=1;i.height=n;a=i.getContext("2d");a.drawImage(e,0,0);l=a.getImageData(0,0,1,n).data;while(s>r){u=l[(s-1)*4+3];if(u===0){o=s}else{r=s}s=o+r>>1}c=s/n;return c===0?1:c}function n(e,t,n,i){var o=document.createElement("canvas"),s=n.mime||"image/jpeg",a=new qq.Promise;r(e,t,o,n,i).then(function(){a.success(o.toDataURL(s,n.quality||.8))});return a}function i(e){var t=5241e3;if(!qq.ios()){throw new qq.Error("Downsampled dimensions can only be reliably calculated for iOS!")}if(e.origHeight*e.origWidth>t){return{newHeight:Math.round(Math.sqrt(t*(e.origHeight/e.origWidth))),newWidth:Math.round(Math.sqrt(t*(e.origWidth/e.origHeight)))}}}function r(n,r,a,l,u){var c=n.naturalWidth,d=n.naturalHeight,f=l.width,p=l.height,h=a.getContext("2d"),q=new qq.Promise,g;h.save();if(l.resize){return o({blob:r,canvas:a,image:n,imageHeight:d,imageWidth:c,orientation:l.orientation,resize:l.resize,targetHeight:p,targetWidth:f})}if(!qq.supportedFeatures.unlimitedScaledImageSize){g=i({origWidth:f,origHeight:p});if(g){qq.log(qq.format("Had to reduce dimensions due to device limitations from {}w / {}h to {}w / {}h",f,p,g.newWidth,g.newHeight),"warn");f=g.newWidth;p=g.newHeight}}s(a,f,p,l.orientation);if(qq.ios()){(function(){if(e(n)){c/=2;d/=2}var i=1024,r=document.createElement("canvas"),o=u?t(n,c,d):1,s=Math.ceil(i*f/c),a=Math.ceil(i*p/d/o),l=0,q=0,g,m,_;r.width=r.height=i;g=r.getContext("2d");while(l<d){m=0;_=0;while(m<c){g.clearRect(0,0,i,i);g.drawImage(n,-m,-l);h.drawImage(r,0,0,i,i,_,q,s,a);m+=i;_+=s}l+=i;q+=a}h.restore();r=g=null})()}else{h.drawImage(n,0,0,f,p)}a.qqImageRendered&&a.qqImageRendered();q.success();return q}function o(e){var t=e.blob,n=e.image,i=e.imageHeight,r=e.imageWidth,o=e.orientation,a=new qq.Promise,l=e.resize,u=document.createElement("canvas"),c=u.getContext("2d"),d=e.canvas,f=e.targetHeight,p=e.targetWidth;s(u,r,i,o);d.height=f;d.width=p;c.drawImage(n,0,0);l({blob:t,height:f,image:n,sourceCanvas:u,targetCanvas:d,width:p}).then(function e(){d.qqImageRendered&&d.qqImageRendered();a.success()},a.failure);return a}function s(e,t,n,i){switch(i){case 5:case 6:case 7:case 8:e.width=n;e.height=t;break;default:e.width=t;e.height=n}var r=e.getContext("2d");switch(i){case 2:r.translate(t,0);r.scale(-1,1);break;case 3:r.translate(t,n);r.rotate(Math.PI);break;case 4:r.translate(0,n);r.scale(1,-1);break;case 5:r.rotate(.5*Math.PI);r.scale(1,-1);break;case 6:r.rotate(.5*Math.PI);r.translate(0,-n);break;case 7:r.rotate(.5*Math.PI);r.translate(t,-n);r.scale(-1,1);break;case 8:r.rotate(-.5*Math.PI);r.translate(-t,0);break;default:break}}function a(e,t){var n=this;if(window.Blob&&e instanceof Blob){(function(){var t=new Image,i=window.URL&&window.URL.createObjectURL?window.URL:window.webkitURL&&window.webkitURL.createObjectURL?window.webkitURL:null;if(!i){throw Error("No createObjectURL function found to create blob url")}t.src=i.createObjectURL(e);n.blob=e;e=t})()}if(!e.naturalWidth&&!e.naturalHeight){e.onload=function(){var e=n.imageLoadListeners;if(e){n.imageLoadListeners=null;setTimeout(function(){for(var t=0,n=e.length;t<n;t++){e[t]()}},0)}};e.onerror=t;this.imageLoadListeners=[]}this.srcImage=e}a.prototype.render=function(e,t){t=t||{};var i=this,o=this.srcImage.naturalWidth,s=this.srcImage.naturalHeight,a=t.width,l=t.height,u=t.maxWidth,c=t.maxHeight,d=!this.blob||this.blob.type==="image/jpeg",f=e.tagName.toLowerCase(),p;if(this.imageLoadListeners){this.imageLoadListeners.push(function(){i.render(e,t)});return}if(a&&!l){l=s*a/o<<0}else if(l&&!a){a=o*l/s<<0}else{a=o;l=s}if(u&&a>u){a=u;l=s*a/o<<0}if(c&&l>c){l=c;a=o*l/s<<0}p={width:a,height:l},qq.each(t,function(e,t){p[e]=t});if(f==="img"){(function(){var t=e.src;n(i.srcImage,i.blob,p,d).then(function(n){e.src=n;t===e.src&&e.onload()})})()}else if(f==="canvas"){r(this.srcImage,this.blob,e,p,d)}if(typeof this.onrender==="function"){this.onrender(e)}};qq.MegaPixImage=a})();qq.ImageGenerator=function(e){"use strict";function t(e){return e.tagName.toLowerCase()==="img"}function n(e){return e.tagName.toLowerCase()==="canvas"}function i(){return(new Image).crossOrigin!==undefined}function r(){var e=document.createElement("canvas");return e.getContext&&e.getContext("2d")}function o(e){var t=e.split("/"),n=t[t.length-1].split("?")[0],i=qq.getExtension(n);i=i&&i.toLowerCase();switch(i){case"jpeg":case"jpg":return"image/jpeg";case"png":return"image/png";case"bmp":return"image/bmp";case"gif":return"image/gif";case"tiff":case"tif":return"image/tiff"}}function s(e){var t=document.createElement("a"),n,i,r;t.href=e;n=t.protocol;r=t.port;i=t.hostname;if(n.toLowerCase()!==window.location.protocol.toLowerCase()){return true}if(i.toLowerCase()!==window.location.hostname.toLowerCase()){return true}if(r!==window.location.port&&!qq.ie()){return true}return false}function a(t,n){t.onload=function(){t.onload=null;t.onerror=null;n.success(t)};t.onerror=function(){t.onload=null;t.onerror=null;e("Problem drawing thumbnail!","error");n.failure(t,"Problem drawing thumbnail!")}}function l(e,t){e.qqImageRendered=function(){t.success(e)}}function u(i,r){var o=t(i)||n(i);if(t(i)){a(i,r)}else if(n(i)){l(i,r)}else{r.failure(i);e(qq.format("Element container of type {} is not supported!",i.tagName),"error")}return o}function c(t,n,i){var r=new qq.Promise,o=new qq.Identify(t,e),s=i.maxSize,a=i.orient==null?true:i.orient,l=function(){n.onerror=null;n.onload=null;e("Could not render preview, file may be too large!","error");r.failure(n,"Browser cannot render image!")};o.isPreviewable().then(function(o){var c={parse:function(){return(new qq.Promise).success()}},d=a?new qq.Exif(t,e):c,f=new qq.MegaPixImage(t,l);if(u(n,r)){d.parse().then(function(e){var t=e&&e.Orientation;f.render(n,{maxWidth:s,maxHeight:s,orientation:t,mime:o,resize:i.customResizeFunction})},function(t){e(qq.format("EXIF data could not be parsed ({}).  Assuming orientation = 1.",t));f.render(n,{maxWidth:s,maxHeight:s,mime:o,resize:i.customResizeFunction})})}},function(){e("Not previewable");r.failure(n,"Not previewable")});return r}function d(e,t,n,i,r){var a=new Image,l=new qq.Promise;u(a,l);if(s(e)){a.crossOrigin="anonymous"}a.src=e;l.then(function s(){u(t,n);var l=new qq.MegaPixImage(a);l.render(t,{maxWidth:i,maxHeight:i,mime:o(e),resize:r})},n.failure)}function f(e,t,n,i){u(t,n);qq(t).css({maxWidth:i+"px",maxHeight:i+"px"});t.src=e}function p(e,o,a){var l=new qq.Promise,c=a.scale,p=c?a.maxSize:null;if(c&&t(o)){if(r()){if(s(e)&&!i()){f(e,o,l,p)}else{d(e,o,l,p)}}else{f(e,o,l,p)}}else if(n(o)){d(e,o,l,p)}else if(u(o,l)){o.src=e}return l}qq.extend(this,{generate:function(t,n,i){if(qq.isString(t)){e("Attempting to update thumbnail based on server response.");return p(t,n,i||{})}else{e("Attempting to draw client-side image preview.");return c(t,n,i||{})}}});this._testing={};this._testing.isImg=t;this._testing.isCanvas=n;this._testing.isCrossOrigin=s;this._testing.determineMimeOfFileName=o};qq.Exif=function(e,t){"use strict";var n=[274],i={274:{name:"Orientation",bytes:2}};function r(e){var t=0,n=0;while(e.length>0){t+=parseInt(e.substring(0,2),16)*Math.pow(2,n);e=e.substring(2,e.length);n+=8}return t}function o(t,n){var i=t,r=n;if(i===undefined){i=2;r=new qq.Promise}qq.readBlobToHex(e,i,4).then(function(e){var t=/^ffe([0-9])/.exec(e),n;if(t){if(t[1]!=="1"){n=parseInt(e.slice(4,8),16);o(i+n+2,r)}else{r.success(i)}}else{r.failure("No EXIF header to be found!")}});return r}function s(){var t=new qq.Promise;qq.readBlobToHex(e,0,6).then(function(e){if(e.indexOf("ffd8")!==0){t.failure("Not a valid JPEG!")}else{o().then(function(e){t.success(e)},function(e){t.failure(e)})}});return t}function a(t){var n=new qq.Promise;qq.readBlobToHex(e,t+10,2).then(function(e){n.success(e==="4949")});return n}function l(t,n){var i=new qq.Promise;qq.readBlobToHex(e,t+18,2).then(function(e){if(n){return i.success(r(e))}else{i.success(parseInt(e,16))}});return i}function u(t,n){var i=t+20,r=n*12;return qq.readBlobToHex(e,i,r)}function c(e){var t=[],n=0;while(n+24<=e.length){t.push(e.slice(n,n+24));n+=24}return t}function d(e,t){var o=16,s=qq.extend([],n),a={};qq.each(t,function(t,n){var l=n.slice(0,4),u=e?r(l):parseInt(l,16),c=s.indexOf(u),d,f,p;if(c>=0){f=i[u].name;p=i[u].bytes;d=n.slice(o,o+p*2);a[f]=e?r(d):parseInt(d,16);s.splice(c,1)}if(s.length===0){return false}});return a}qq.extend(this,{parse:function(){var n=new qq.Promise,i=function(e){t(qq.format("EXIF header parse failed: '{}' ",e));n.failure(e)};s().then(function(r){t(qq.format("Moving forward with EXIF header parsing for '{}'",e.name===undefined?"blob":e.name));a(r).then(function(e){t(qq.format("EXIF Byte order is {} endian",e?"little":"big"));l(r,e).then(function(o){t(qq.format("Found {} APP1 directory entries",o));u(r,o).then(function(i){var r=c(i),o=d(e,r);t("Successfully parsed some EXIF tags");n.success(o)},i)},i)},i)},i);return n}});this._testing={};this._testing.parseLittleEndian=r};qq.Identify=function(e,t){"use strict";function n(e,t){var n=false,i=[].concat(e);qq.each(i,function(e,i){if(t.indexOf(i)===0){n=true;return false}});return n}qq.extend(this,{isPreviewable:function(){var i=this,r=new qq.Promise,o=false,s=e.name===undefined?"blob":e.name;t(qq.format("Attempting to determine if {} can be rendered in this browser",s));t("First pass: check type attribute of blob object.");if(this.isPreviewableSync()){t("Second pass: check for magic bytes in file header.");qq.readBlobToHex(e,0,4).then(function(e){qq.each(i.PREVIEWABLE_MIME_TYPES,function(t,i){if(n(i,e)){if(t!=="image/tiff"||qq.supportedFeatures.tiffPreviews){o=true;r.success(t)}return false}});t(qq.format("'{}' is {} able to be rendered in this browser",s,o?"":"NOT"));if(!o){r.failure()}},function(){t("Error reading file w/ name '"+s+"'.  Not able to be rendered in this browser.");r.failure()})}else{r.failure()}return r},isPreviewableSync:function(){var n=e.type,i=qq.indexOf(Object.keys(this.PREVIEWABLE_MIME_TYPES),n)>=0,r=false,o=e.name===undefined?"blob":e.name;if(i){if(n==="image/tiff"){r=qq.supportedFeatures.tiffPreviews}else{r=true}}!r&&t(o+" is not previewable in this browser per the blob's type attr");return r}})};qq.Identify.prototype.PREVIEWABLE_MIME_TYPES={"image/jpeg":"ffd8ff","image/gif":"474946","image/png":"89504e","image/bmp":"424d","image/tiff":["49492a00","4d4d002a"]};qq.ImageValidation=function(e,t){"use strict";function n(e){var t=false;qq.each(e,function(e,n){if(n>0){t=true;return false}});return t}function i(){var n=new qq.Promise;new qq.Identify(e,t).isPreviewable().then(function(){var i=new Image,r=window.URL&&window.URL.createObjectURL?window.URL:window.webkitURL&&window.webkitURL.createObjectURL?window.webkitURL:null;if(r){i.onerror=function(){t("Cannot determine dimensions for image.  May be too large.","error");n.failure()};i.onload=function(){n.success({width:this.width,height:this.height})};i.src=r.createObjectURL(e)}else{t("No createObjectURL function available to generate image URL!","error");n.failure()}},n.failure);return n}function r(e,t){var n;qq.each(e,function(e,i){if(i>0){var r=/(max|min)(Width|Height)/.exec(e),o=r[2].charAt(0).toLowerCase()+r[2].slice(1),s=t[o];switch(r[1]){case"min":if(s<i){n=e;return false}break;case"max":if(s>i){n=e;return false}break}}});return n}this.validate=function(e){var o=new qq.Promise;t("Attempting to validate image.");if(n(e)){i().then(function(t){var n=r(e,t);if(n){o.failure(n)}else{o.success()}},o.success)}else{o.success()}return o}};qq.Session=function(e){"use strict";var t={endpoint:null,params:{},customHeaders:{},cors:{},addFileRecord:function(e){},log:function(e,t){}};qq.extend(t,e,true);function n(e){if(qq.isArray(e)){return true}t.log("Session response is not an array.","error")}function i(e,i,r,o){var s=false;i=i&&n(e);if(i){qq.each(e,function(e,n){if(n.uuid==null){s=true;t.log(qq.format("Session response item {} did not include a valid UUID - ignoring.",e),"error")}else if(n.name==null){s=true;t.log(qq.format("Session response item {} did not include a valid name - ignoring.",e),"error")}else{try{t.addFileRecord(n);return true}catch(e){s=true;t.log(e.message,"error")}}return false})}o[i&&!s?"success":"failure"](e,r)}this.refresh=function(){var e=new qq.Promise,n=function(t,n,r){i(t,n,r,e)},r=qq.extend({},t),o=new qq.SessionAjaxRequester(qq.extend(r,{onComplete:n}));o.queryServer();return e}};qq.SessionAjaxRequester=function(e){"use strict";var t,n={endpoint:null,customHeaders:{},params:{},cors:{expected:false,sendCredentials:false},onComplete:function(e,t,n){},log:function(e,t){}};qq.extend(n,e);function i(e,t,i){var r=null;if(t.responseText!=null){try{r=qq.parseJson(t.responseText)}catch(e){n.log("Problem parsing session response: "+e.message,"error");i=true}}n.onComplete(r,!i,t)}t=qq.extend(this,new qq.AjaxRequester({acceptHeader:"application/json",validMethods:["GET"],method:"GET",endpointStore:{get:function(){return n.endpoint}},customHeaders:n.customHeaders,log:n.log,onComplete:i,cors:n.cors}));qq.extend(this,{queryServer:function(){var e=qq.extend({},n.params);n.log("Session query request.");t.initTransport("sessionRefresh").withParams(e).withCacheBuster().send()}})};qq.Scaler=function(e,t){"use strict";var n=this,i=e.customResizer,r=e.sendOriginal,o=e.orient,s=e.defaultType,a=e.defaultQuality/100,l=e.failureText,u=e.includeExif,c=this._getSortedSizes(e.sizes);qq.extend(this,{enabled:qq.supportedFeatures.scaling&&c.length>0,getFileRecords:function(e,n,d){var f=this,p=[],h=d.blob?d.blob:d,q=new qq.Identify(h,t);if(q.isPreviewableSync()){qq.each(c,function(e,r){var c=f._determineOutputType({defaultType:s,requestedType:r.type,refType:h.type});p.push({uuid:qq.getUniqueId(),name:f._getName(n,{name:r.name,type:c,refType:h.type}),blob:new qq.BlobProxy(h,qq.bind(f._generateScaledImage,f,{customResizeFunction:i,maxSize:r.maxSize,orient:o,type:c,quality:a,failedText:l,includeExif:u,log:t}))})});p.push({uuid:e,name:n,size:h.size,blob:r?h:null})}else{p.push({uuid:e,name:n,size:h.size,blob:h})}return p},handleNewFile:function(e,t,n,i,r,o,s,a){var l=this,u=e.qqButtonId||e.blob&&e.blob.qqButtonId,c=[],d=null,f=a.addFileToHandler,p=a.uploadData,h=a.paramsStore,q=qq.getUniqueId();qq.each(l.getFileRecords(n,t,e),function(e,t){var n=t.size,i;if(t.blob instanceof qq.BlobProxy){n=-1}i=p.addFile({uuid:t.uuid,name:t.name,size:n,batchId:o,proxyGroupId:q});if(t.blob instanceof qq.BlobProxy){c.push(i)}else{d=i}if(t.blob){f(i,t.blob);r.push({id:i,file:t.blob})}else{p.setStatus(i,qq.status.REJECTED)}});if(d!==null){qq.each(c,function(e,t){var n={qqparentuuid:p.retrieve({id:d}).uuid,qqparentsize:p.retrieve({id:d}).size};n[s]=p.retrieve({id:t}).uuid;p.setParentId(t,d);h.addReadOnly(t,n)});if(c.length){(function(){var e={};e[s]=p.retrieve({id:d}).uuid;h.addReadOnly(d,e)})()}}}})};qq.extend(qq.Scaler.prototype,{scaleImage:function(e,t,n){"use strict";if(!qq.supportedFeatures.scaling){throw new qq.Error("Scaling is not supported in this browser!")}var i=new qq.Promise,r=n.log,o=n.getFile(e),s=n.uploadData.retrieve({id:e}),a=s&&s.name,l=s&&s.uuid,u={customResizer:t.customResizer,sendOriginal:false,orient:t.orient,defaultType:t.type||null,defaultQuality:t.quality,failedToScaleText:"Unable to scale",sizes:[{name:"",maxSize:t.maxSize}]},c=new qq.Scaler(u,r);if(!qq.Scaler||!qq.supportedFeatures.imagePreviews||!o){i.failure();r("Could not generate requested scaled image for "+e+".  "+"Scaling is either not possible in this browser, or the file could not be located.","error")}else{qq.bind(function(){var t=c.getFileRecords(l,a,o)[0];if(t&&t.blob instanceof qq.BlobProxy){t.blob.create().then(i.success,i.failure)}else{r(e+" is not a scalable image!","error");i.failure()}},this)()}return i},_determineOutputType:function(e){"use strict";var t=e.requestedType,n=e.defaultType,i=e.refType;if(!n&&!t){if(i!=="image/jpeg"){return"image/png"}return i}if(!t){return n}if(qq.indexOf(Object.keys(qq.Identify.prototype.PREVIEWABLE_MIME_TYPES),t)>=0){if(t==="image/tiff"){return qq.supportedFeatures.tiffPreviews?t:n}return t}return n},_getName:function(e,t){"use strict";var n=e.lastIndexOf("."),i=t.type||"image/png",r=t.refType,o="",s=qq.getExtension(e),a="";if(t.name&&t.name.trim().length){a=" ("+t.name+")"}if(n>=0){o=e.substr(0,n);if(r!==i){s=i.split("/")[1]}o+=a+"."+s}else{o=e+a}return o},_getSortedSizes:function(e){"use strict";e=qq.extend([],e);return e.sort(function(e,t){if(e.maxSize>t.maxSize){return 1}if(e.maxSize<t.maxSize){return-1}return 0})},_generateScaledImage:function(e,t){"use strict";var n=this,i=e.customResizeFunction,r=e.log,o=e.maxSize,s=e.orient,a=e.type,l=e.quality,u=e.failedText,c=e.includeExif&&t.type==="image/jpeg"&&a==="image/jpeg",d=new qq.Promise,f=new qq.ImageGenerator(r),p=document.createElement("canvas");r("Attempting to generate scaled version for "+t.name);f.generate(t,p,{maxSize:o,orient:s,customResizeFunction:i}).then(function(){var e=p.toDataURL(a,l),i=function(){r("Success generating scaled version for "+t.name);var n=qq.dataUriToBlob(e);d.success(n)};if(c){n._insertExifHeader(t,e,r).then(function(t){e=t;i()},function(){r("Problem inserting EXIF header into scaled image.  Using scaled image w/out EXIF data.","error");i()})}else{i()}},function(){r("Failed attempt to generate scaled version for "+t.name,"error");d.failure(u)});return d},_insertExifHeader:function(e,t,n){"use strict";var i=new FileReader,r=new qq.Promise,o="";i.onload=function(){o=i.result;r.success(qq.ExifRestorer.restore(o,t))};i.onerror=function(){n("Problem reading "+e.name+" during attempt to transfer EXIF data to scaled version.","error");r.failure()};i.readAsDataURL(e);return r},_dataUriToBlob:function(e){"use strict";var t,n,i,r;if(e.split(",")[0].indexOf("base64")>=0){t=atob(e.split(",")[1])}else{t=decodeURI(e.split(",")[1])}n=e.split(",")[0].split(":")[1].split(";")[0];i=new ArrayBuffer(t.length);r=new Uint8Array(i);qq.each(t,function(e,t){r[e]=t.charCodeAt(0)});return this._createBlob(i,n)},_createBlob:function(e,t){"use strict";var n=window.BlobBuilder||window.WebKitBlobBuilder||window.MozBlobBuilder||window.MSBlobBuilder,i=n&&new n;if(i){i.append(e);return i.getBlob(t)}else{return new Blob([e],{type:t})}}});qq.ExifRestorer=function(){var e={};e.KEY_STR="ABCDEFGHIJKLMNOP"+"QRSTUVWXYZabcdef"+"ghijklmnopqrstuv"+"wxyz0123456789+/"+"=";e.encode64=function(e){var t="",n,i,r="",o,s,a,l="",u=0;do{n=e[u++];i=e[u++];r=e[u++];o=n>>2;s=(n&3)<<4|i>>4;a=(i&15)<<2|r>>6;l=r&63;if(isNaN(i)){a=l=64}else if(isNaN(r)){l=64}t=t+this.KEY_STR.charAt(o)+this.KEY_STR.charAt(s)+this.KEY_STR.charAt(a)+this.KEY_STR.charAt(l);n=i=r="";o=s=a=l=""}while(u<e.length);return t};e.restore=function(e,t){var n="data:image/jpeg;base64,";if(!e.match(n)){return t}var i=this.decode64(e.replace(n,""));var r=this.slice2Segments(i);var o=this.exifManipulation(t,r);return n+this.encode64(o)};e.exifManipulation=function(e,t){var n=this.getExifArray(t),i=this.insertExif(e,n),r=new Uint8Array(i);return r};e.getExifArray=function(e){var t;for(var n=0;n<e.length;n++){t=e[n];if(t[0]==255&t[1]==225){return t}}return[]};e.insertExif=function(e,t){var n=e.replace("data:image/jpeg;base64,",""),i=this.decode64(n),r=i.indexOf(255,3),o=i.slice(0,r),s=i.slice(r),a=o;a=a.concat(t);a=a.concat(s);return a};e.slice2Segments=function(e){var t=0,n=[];while(1){if(e[t]==255&e[t+1]==218){break}if(e[t]==255&e[t+1]==216){t+=2}else{var i=e[t+2]*256+e[t+3],r=t+i+2,o=e.slice(t,r);n.push(o);t=r}if(t>e.length){break}}return n};e.decode64=function(e){var t="",n,i,r="",o,s,a,l="",u=0,c=[];var d=/[^A-Za-z0-9\+\/\=]/g;if(d.exec(e)){throw new Error("There were invalid base64 characters in the input text.  "+"Valid base64 characters are A-Z, a-z, 0-9, '+', '/',and '='")}e=e.replace(/[^A-Za-z0-9\+\/\=]/g,"");do{o=this.KEY_STR.indexOf(e.charAt(u++));s=this.KEY_STR.indexOf(e.charAt(u++));a=this.KEY_STR.indexOf(e.charAt(u++));l=this.KEY_STR.indexOf(e.charAt(u++));n=o<<2|s>>4;i=(s&15)<<4|a>>2;r=(a&3)<<6|l;c.push(n);if(a!=64){c.push(i)}if(l!=64){c.push(r)}n=i=r="";o=s=a=l=""}while(u<e.length);return c};return e}();qq.TotalProgress=function(e,t){"use strict";var n={},i=0,r=0,o=-1,s=-1,a=function(t,n){if(t!==o||n!==s){e(t,n)}o=t;s=n},l=function(e,t){var n=true;qq.each(e,function(e,i){if(qq.indexOf(t,i)>=0){n=false;return false}});return n},u=function(e){f(e,-1,-1);delete n[e]},c=function(e,t,n){if(t.length===0||l(t,n)){a(r,r);this.reset()}},d=function(e){var i=t(e);if(i>0){f(e,0,i);n[e]={loaded:0,total:i}}},f=function(e,t,o){var s=n[e]?n[e].loaded:0,l=n[e]?n[e].total:0;if(t===-1&&o===-1){i-=s;r-=l}else{if(t){i+=t-s}if(o){r+=o-l}}a(i,r)};qq.extend(this,{onAllComplete:c,onStatusChange:function(e,t,n){if(n===qq.status.CANCELED||n===qq.status.REJECTED){u(e)}else if(n===qq.status.SUBMITTING){d(e)}},onIndividualProgress:function(e,t,i){f(e,t,i);n[e]={loaded:t,total:i}},onNewSize:function(e){d(e)},reset:function(){n={};i=0;r=0}})};qq.PasteSupport=function(e){"use strict";var t,n;t={targetElement:null,callbacks:{log:function(e,t){},pasteReceived:function(e){}}};function i(e){return e.type&&e.type.indexOf("image/")===0}function r(){n=qq(t.targetElement).attach("paste",function(e){var n=e.clipboardData;if(n){qq.each(n.items,function(e,n){if(i(n)){var r=n.getAsFile();t.callbacks.pasteReceived(r)}})}})}function o(){if(n){n()}}qq.extend(t,e);r();qq.extend(this,{reset:function(){o()}})};qq.FormSupport=function(e,t,n){"use strict";var i=this,r=e.interceptSubmit,o=e.element,s=e.autoUpload;qq.extend(this,{newEndpoint:null,newAutoUpload:s,attachedToForm:false,getFormInputsAsObject:function(){if(o==null){return null}return i._form2Obj(o)}});function a(e){if(e.getAttribute("action")){i.newEndpoint=e.getAttribute("action")}}function l(e,t){if(e.checkValidity&&!e.checkValidity()){n("Form did not pass validation checks - will not upload.","error");t()}else{return true}}function u(e){var n=e.submit;qq(e).attach("submit",function(i){i=i||window.event;if(i.preventDefault){i.preventDefault()}else{i.returnValue=false}l(e,n)&&t()});e.submit=function(){l(e,n)&&t()}}function c(e){if(e){if(qq.isString(e)){e=document.getElementById(e)}if(e){n("Attaching to form element.");a(e);r&&u(e)}}return e}o=c(o);this.attachedToForm=!!o};qq.extend(qq.FormSupport.prototype,{_form2Obj:function(e){"use strict";var t={},n=function(e){var t=["button","image","reset","submit"];return qq.indexOf(t,e.toLowerCase())<0},i=function(e){return qq.indexOf(["checkbox","radio"],e.toLowerCase())>=0},r=function(e){if(i(e.type)&&!e.checked){return true}return e.disabled&&e.type.toLowerCase()!=="hidden"},o=function(e){var t=null;qq.each(qq(e).children(),function(e,n){if(n.tagName.toLowerCase()==="option"&&n.selected){t=n.value;return false}});return t};qq.each(e.elements,function(e,i){if((qq.isInput(i,true)||i.tagName.toLowerCase()==="textarea")&&n(i.type)&&!r(i)){t[i.name]=i.value}else if(i.tagName.toLowerCase()==="select"&&!r(i)){var s=o(i);if(s!==null){t[i.name]=s}}});return t}});qq.CryptoJS=function(e,t){var n={};var i=n.lib={};var r=i.Base=function(){function e(){}return{extend:function(t){e.prototype=this;var n=new e;if(t){n.mixIn(t)}if(!n.hasOwnProperty("init")){n.init=function(){n.$super.init.apply(this,arguments)}}n.init.prototype=n;n.$super=this;return n},create:function(){var e=this.extend();e.init.apply(e,arguments);return e},init:function(){},mixIn:function(e){for(var t in e){if(e.hasOwnProperty(t)){this[t]=e[t]}}if(e.hasOwnProperty("toString")){this.toString=e.toString}},clone:function(){return this.init.prototype.extend(this)}}}();var o=i.WordArray=r.extend({init:function(e,n){e=this.words=e||[];if(n!=t){this.sigBytes=n}else{this.sigBytes=e.length*4}},toString:function(e){return(e||a).stringify(this)},concat:function(e){var t=this.words;var n=e.words;var i=this.sigBytes;var r=e.sigBytes;this.clamp();if(i%4){for(var o=0;o<r;o++){var s=n[o>>>2]>>>24-o%4*8&255;t[i+o>>>2]|=s<<24-(i+o)%4*8}}else if(n.length>65535){for(var o=0;o<r;o+=4){t[i+o>>>2]=n[o>>>2]}}else{t.push.apply(t,n)}this.sigBytes+=r;return this},clamp:function(){var t=this.words;var n=this.sigBytes;t[n>>>2]&=4294967295<<32-n%4*8;t.length=e.ceil(n/4)},clone:function(){var e=r.clone.call(this);e.words=this.words.slice(0);return e},random:function(t){var n=[];for(var i=0;i<t;i+=4){n.push(e.random()*4294967296|0)}return new o.init(n,t)}});var s=n.enc={};var a=s.Hex={stringify:function(e){var t=e.words;var n=e.sigBytes;var i=[];for(var r=0;r<n;r++){var o=t[r>>>2]>>>24-r%4*8&255;i.push((o>>>4).toString(16));i.push((o&15).toString(16))}return i.join("")},parse:function(e){var t=e.length;var n=[];for(var i=0;i<t;i+=2){n[i>>>3]|=parseInt(e.substr(i,2),16)<<24-i%8*4}return new o.init(n,t/2)}};var l=s.Latin1={stringify:function(e){var t=e.words;var n=e.sigBytes;var i=[];for(var r=0;r<n;r++){var o=t[r>>>2]>>>24-r%4*8&255;i.push(String.fromCharCode(o))}return i.join("")},parse:function(e){var t=e.length;var n=[];for(var i=0;i<t;i++){n[i>>>2]|=(e.charCodeAt(i)&255)<<24-i%4*8}return new o.init(n,t)}};var u=s.Utf8={stringify:function(e){try{return decodeURIComponent(escape(l.stringify(e)))}catch(e){throw new Error("Malformed UTF-8 data")}},parse:function(e){return l.parse(unescape(encodeURIComponent(e)))}};var c=i.BufferedBlockAlgorithm=r.extend({reset:function(){this._data=new o.init;this._nDataBytes=0},_append:function(e){if(typeof e=="string"){e=u.parse(e)}this._data.concat(e);this._nDataBytes+=e.sigBytes},_process:function(t){var n=this._data;var i=n.words;var r=n.sigBytes;var s=this.blockSize;var a=s*4;var l=r/a;if(t){l=e.ceil(l)}else{l=e.max((l|0)-this._minBufferSize,0)}var u=l*s;var c=e.min(u*4,r);if(u){for(var d=0;d<u;d+=s){this._doProcessBlock(i,d)}var f=i.splice(0,u);n.sigBytes-=c}return new o.init(f,c)},clone:function(){var e=r.clone.call(this);e._data=this._data.clone();return e},_minBufferSize:0});var d=i.Hasher=c.extend({cfg:r.extend(),init:function(e){this.cfg=this.cfg.extend(e);this.reset()},reset:function(){c.reset.call(this);this._doReset()},update:function(e){this._append(e);this._process();return this},finalize:function(e){if(e){this._append(e)}var t=this._doFinalize();return t},blockSize:512/32,_createHelper:function(e){return function(t,n){return new e.init(n).finalize(t)}},_createHmacHelper:function(e){return function(t,n){return new f.HMAC.init(e,n).finalize(t)}}});var f=n.algo={};return n}(Math);(function(){var e=qq.CryptoJS;var t=e.lib;var n=t.WordArray;var i=e.enc;var r=i.Base64={stringify:function(e){var t=e.words;var n=e.sigBytes;var i=this._map;e.clamp();var r=[];for(var o=0;o<n;o+=3){var s=t[o>>>2]>>>24-o%4*8&255;var a=t[o+1>>>2]>>>24-(o+1)%4*8&255;var l=t[o+2>>>2]>>>24-(o+2)%4*8&255;var u=s<<16|a<<8|l;for(var c=0;c<4&&o+c*.75<n;c++){r.push(i.charAt(u>>>6*(3-c)&63))}}var d=i.charAt(64);if(d){while(r.length%4){r.push(d)}}return r.join("")},parse:function(e){var t=e.length;var i=this._map;var r=i.charAt(64);if(r){var o=e.indexOf(r);if(o!=-1){t=o}}var s=[];var a=0;for(var l=0;l<t;l++){if(l%4){var u=i.indexOf(e.charAt(l-1))<<l%4*2;var c=i.indexOf(e.charAt(l))>>>6-l%4*2;s[a>>>2]|=(u|c)<<24-a%4*8;a++}}return n.create(s,a)},_map:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/="}})();(function(){var e=qq.CryptoJS;var t=e.lib;var n=t.Base;var i=e.enc;var r=i.Utf8;var o=e.algo;var s=o.HMAC=n.extend({init:function(e,t){e=this._hasher=new e.init;if(typeof t=="string"){t=r.parse(t)}var n=e.blockSize;var i=n*4;if(t.sigBytes>i){t=e.finalize(t)}t.clamp();var o=this._oKey=t.clone();var s=this._iKey=t.clone();var a=o.words;var l=s.words;for(var u=0;u<n;u++){a[u]^=1549556828;l[u]^=909522486}o.sigBytes=s.sigBytes=i;this.reset()},reset:function(){var e=this._hasher;e.reset();e.update(this._iKey)},update:function(e){this._hasher.update(e);return this},finalize:function(e){var t=this._hasher;var n=t.finalize(e);t.reset();var i=t.finalize(this._oKey.clone().concat(n));return i}})})();(function(){var e=qq.CryptoJS;var t=e.lib;var n=t.WordArray;var i=t.Hasher;var r=e.algo;var o=[];var s=r.SHA1=i.extend({_doReset:function(){this._hash=new n.init([1732584193,4023233417,2562383102,271733878,3285377520])},_doProcessBlock:function(e,t){var n=this._hash.words;var i=n[0];var r=n[1];var s=n[2];var a=n[3];var l=n[4];for(var u=0;u<80;u++){if(u<16){o[u]=e[t+u]|0}else{var c=o[u-3]^o[u-8]^o[u-14]^o[u-16];o[u]=c<<1|c>>>31}var d=(i<<5|i>>>27)+l+o[u];if(u<20){d+=(r&s|~r&a)+1518500249}else if(u<40){d+=(r^s^a)+1859775393}else if(u<60){d+=(r&s|r&a|s&a)-1894007588}else{d+=(r^s^a)-899497514}l=a;a=s;s=r<<30|r>>>2;r=i;i=d}n[0]=n[0]+i|0;n[1]=n[1]+r|0;n[2]=n[2]+s|0;n[3]=n[3]+a|0;n[4]=n[4]+l|0},_doFinalize:function(){var e=this._data;var t=e.words;var n=this._nDataBytes*8;var i=e.sigBytes*8;t[i>>>5]|=128<<24-i%32;t[(i+64>>>9<<4)+14]=Math.floor(n/4294967296);t[(i+64>>>9<<4)+15]=n;e.sigBytes=t.length*4;this._process();return this._hash},clone:function(){var e=i.clone.call(this);e._hash=this._hash.clone();return e}});e.SHA1=i._createHelper(s);e.HmacSHA1=i._createHmacHelper(s)})();(function(e){var t=qq.CryptoJS;var n=t.lib;var i=n.WordArray;var r=n.Hasher;var o=t.algo;var s=[];var a=[];(function(){function t(t){var n=e.sqrt(t);for(var i=2;i<=n;i++){if(!(t%i)){return false}}return true}function n(e){return(e-(e|0))*4294967296|0}var i=2;var r=0;while(r<64){if(t(i)){if(r<8){s[r]=n(e.pow(i,1/2))}a[r]=n(e.pow(i,1/3));r++}i++}})();var l=[];var u=o.SHA256=r.extend({_doReset:function(){this._hash=new i.init(s.slice(0))},_doProcessBlock:function(e,t){var n=this._hash.words;var i=n[0];var r=n[1];var o=n[2];var s=n[3];var u=n[4];var c=n[5];var d=n[6];var f=n[7];for(var p=0;p<64;p++){if(p<16){l[p]=e[t+p]|0}else{var h=l[p-15];var q=(h<<25|h>>>7)^(h<<14|h>>>18)^h>>>3;var g=l[p-2];var m=(g<<15|g>>>17)^(g<<13|g>>>19)^g>>>10;l[p]=q+l[p-7]+m+l[p-16]}var _=u&c^~u&d;var v=i&r^i&o^r&o;var b=(i<<30|i>>>2)^(i<<19|i>>>13)^(i<<10|i>>>22);var y=(u<<26|u>>>6)^(u<<21|u>>>11)^(u<<7|u>>>25);var S=f+y+_+a[p]+l[p];var w=b+v;f=d;d=c;c=u;u=s+S|0;s=o;o=r;r=i;i=S+w|0}n[0]=n[0]+i|0;n[1]=n[1]+r|0;n[2]=n[2]+o|0;n[3]=n[3]+s|0;n[4]=n[4]+u|0;n[5]=n[5]+c|0;n[6]=n[6]+d|0;n[7]=n[7]+f|0},_doFinalize:function(){var t=this._data;var n=t.words;var i=this._nDataBytes*8;var r=t.sigBytes*8;n[r>>>5]|=128<<24-r%32;n[(r+64>>>9<<4)+14]=e.floor(i/4294967296);n[(r+64>>>9<<4)+15]=i;t.sigBytes=n.length*4;this._process();return this._hash},clone:function(){var e=r.clone.call(this);e._hash=this._hash.clone();return e}});t.SHA256=r._createHelper(u);t.HmacSHA256=r._createHmacHelper(u)})(Math);(function(){if(typeof ArrayBuffer!="function"){return}var e=qq.CryptoJS;var t=e.lib;var n=t.WordArray;var i=n.init;var r=n.init=function(e){if(e instanceof ArrayBuffer){e=new Uint8Array(e)}if(e instanceof Int8Array||e instanceof Uint8ClampedArray||e instanceof Int16Array||e instanceof Uint16Array||e instanceof Int32Array||e instanceof Uint32Array||e instanceof Float32Array||e instanceof Float64Array){e=new Uint8Array(e.buffer,e.byteOffset,e.byteLength)}if(e instanceof Uint8Array){var t=e.byteLength;var n=[];for(var r=0;r<t;r++){n[r>>>2]|=e[r]<<24-r%4*8}i.call(this,n,t)}else{i.apply(this,arguments)}};r.prototype=n})();qq.s3=qq.s3||{};qq.s3.util=qq.s3.util||function(){"use strict";return{ALGORITHM_PARAM_NAME:"x-amz-algorithm",AWS_PARAM_PREFIX:"x-amz-meta-",CREDENTIAL_PARAM_NAME:"x-amz-credential",DATE_PARAM_NAME:"x-amz-date",REDUCED_REDUNDANCY_PARAM_NAME:"x-amz-storage-class",REDUCED_REDUNDANCY_PARAM_VALUE:"REDUCED_REDUNDANCY",SERVER_SIDE_ENCRYPTION_PARAM_NAME:"x-amz-server-side-encryption",SERVER_SIDE_ENCRYPTION_PARAM_VALUE:"AES256",SESSION_TOKEN_PARAM_NAME:"x-amz-security-token",V4_ALGORITHM_PARAM_VALUE:"AWS4-HMAC-SHA256",V4_SIGNATURE_PARAM_NAME:"x-amz-signature",CASE_SENSITIVE_PARAM_NAMES:["Cache-Control","Content-Disposition","Content-Encoding","Content-MD5"],UNSIGNABLE_REST_HEADER_NAMES:["Cache-Control","Content-Disposition","Content-Encoding","Content-MD5"],UNPREFIXED_PARAM_NAMES:["Cache-Control","Content-Disposition","Content-Encoding","Content-MD5","x-amz-server-side-encryption-customer-algorithm","x-amz-server-side-encryption-customer-key","x-amz-server-side-encryption-customer-key-MD5"],getBucket:function(e){var t=[/^(?:https?:\/\/)?([a-z0-9.\-_]+)\.s3(?:-[a-z0-9\-]+)?\.amazonaws\.com/i,/^(?:https?:\/\/)?s3(?:-[a-z0-9\-]+)?\.amazonaws\.com\/([a-z0-9.\-_]+)/i,/^(?:https?:\/\/)?([a-z0-9.\-_]+)/i],n;qq.each(t,function(t,i){var r=i.exec(e);if(r){n=r[1];return false}});return n},_getPrefixedParamName:function(e){if(qq.indexOf(qq.s3.util.UNPREFIXED_PARAM_NAMES,e)>=0){return e}return qq.s3.util.AWS_PARAM_PREFIX+e},getPolicy:function(e){var t={},n=[],i=e.bucket,r=e.date,o=e.clockDrift,s=e.key,a=e.accessKey,l=e.acl,u=e.type,c=e.expectedStatus,d=e.sessionToken,f=e.params,p=qq.s3.util.getSuccessRedirectAbsoluteUrl(e.successRedirectUrl),h=e.minFileSize,q=e.maxFileSize,g=e.reducedRedundancy,m=e.region,_=e.serverSideEncryption,v=e.signatureVersion;t.expiration=qq.s3.util.getPolicyExpirationDate(r,o);n.push({acl:l});n.push({bucket:i});if(u){n.push({"Content-Type":u})}if(c){n.push({success_action_status:c.toString()})}if(p){n.push({success_action_redirect:p})}if(g){n.push({});n[n.length-1][qq.s3.util.REDUCED_REDUNDANCY_PARAM_NAME]=qq.s3.util.REDUCED_REDUNDANCY_PARAM_VALUE}if(d){n.push({});n[n.length-1][qq.s3.util.SESSION_TOKEN_PARAM_NAME]=d}if(_){n.push({});n[n.length-1][qq.s3.util.SERVER_SIDE_ENCRYPTION_PARAM_NAME]=qq.s3.util.SERVER_SIDE_ENCRYPTION_PARAM_VALUE}if(v===2){n.push({key:s})}else if(v===4){n.push({});n[n.length-1][qq.s3.util.ALGORITHM_PARAM_NAME]=qq.s3.util.V4_ALGORITHM_PARAM_VALUE;n.push({});n[n.length-1].key=s;n.push({});n[n.length-1][qq.s3.util.CREDENTIAL_PARAM_NAME]=qq.s3.util.getV4CredentialsString({date:r,key:a,region:m});n.push({});n[n.length-1][qq.s3.util.DATE_PARAM_NAME]=qq.s3.util.getV4PolicyDate(r,o)}qq.each(f,function(e,t){var i=qq.s3.util._getPrefixedParamName(e),r={};if(qq.indexOf(qq.s3.util.UNPREFIXED_PARAM_NAMES,i)>=0){r[i]=t}else{r[i]=encodeURIComponent(t)}n.push(r)});t.conditions=n;qq.s3.util.enforceSizeLimits(t,h,q);return t},refreshPolicyCredentials:function(e,t){var n=false;qq.each(e.conditions,function(e,i){qq.each(i,function(e,r){if(e===qq.s3.util.SESSION_TOKEN_PARAM_NAME){i[e]=t;n=true}})});if(!n){e.conditions.push({});e.conditions[e.conditions.length-1][qq.s3.util.SESSION_TOKEN_PARAM_NAME]=t}},generateAwsParams:function(e,t){var n={},i=e.params,r=new qq.Promise,o=e.sessionToken,s=e.clockDrift,a=e.type,l=e.key,u=e.accessKey,c=e.acl,d=e.expectedStatus,f=qq.s3.util.getSuccessRedirectAbsoluteUrl(e.successRedirectUrl),p=e.reducedRedundancy,h=e.region,q=e.serverSideEncryption,g=e.signatureVersion,m=new Date,_=e.log,v;e.date=m;v=qq.s3.util.getPolicy(e);n.key=l;if(a){n["Content-Type"]=a}if(d){n.success_action_status=d}if(f){n.success_action_redirect=f}if(p){n[qq.s3.util.REDUCED_REDUNDANCY_PARAM_NAME]=qq.s3.util.REDUCED_REDUNDANCY_PARAM_VALUE}if(q){n[qq.s3.util.SERVER_SIDE_ENCRYPTION_PARAM_NAME]=qq.s3.util.SERVER_SIDE_ENCRYPTION_PARAM_VALUE}if(o){n[qq.s3.util.SESSION_TOKEN_PARAM_NAME]=o}n.acl=c;qq.each(i,function(e,t){var i=qq.s3.util._getPrefixedParamName(e);if(qq.indexOf(qq.s3.util.UNPREFIXED_PARAM_NAMES,i)>=0){n[i]=t}else{n[i]=encodeURIComponent(t)}});if(g===2){n.AWSAccessKeyId=u}else if(g===4){n[qq.s3.util.ALGORITHM_PARAM_NAME]=qq.s3.util.V4_ALGORITHM_PARAM_VALUE;n[qq.s3.util.CREDENTIAL_PARAM_NAME]=qq.s3.util.getV4CredentialsString({date:m,key:u,region:h});n[qq.s3.util.DATE_PARAM_NAME]=qq.s3.util.getV4PolicyDate(m,s)}t(v).then(function(t,i,o){n.policy=t.policy;if(e.signatureVersion===2){n.signature=t.signature;if(i){n.AWSAccessKeyId=i}}else if(e.signatureVersion===4){n[qq.s3.util.V4_SIGNATURE_PARAM_NAME]=t.signature}if(o){n[qq.s3.util.SESSION_TOKEN_PARAM_NAME]=o}r.success(n)},function(e){e=e||"Can't continue further with request to S3 as we did not receive "+"a valid signature and policy from the server.";_("Policy signing failed.  "+e,"error");r.failure(e)});return r},enforceSizeLimits:function(e,t,n){var i=t<0?0:t,r=n<=0?9007199254740992:n;if(t>0||n>0){e.conditions.push(["content-length-range",i.toString(),r.toString()])}},getPolicyExpirationDate:function(e,t){var n=new Date(e.getTime()+t);return qq.s3.util.getPolicyDate(n,5)},getCredentialsDate:function(e){return e.getUTCFullYear()+""+("0"+(e.getUTCMonth()+1)).slice(-2)+("0"+e.getUTCDate()).slice(-2)},getPolicyDate:function(e,t){var n=t||0,i,r;e.setMinutes(e.getMinutes()+(n||0));if(Date.prototype.toISOString){return e.toISOString()}else{i=function(e){r=String(e);if(r.length===1){r="0"+r}return r};return e.getUTCFullYear()+"-"+i(e.getUTCMonth()+1)+"-"+i(e.getUTCDate())+"T"+i(e.getUTCHours())+":"+i(e.getUTCMinutes())+":"+i(e.getUTCSeconds())+"."+String((e.getUTCMilliseconds()/1e3).toFixed(3)).slice(2,5)+"Z"}},parseIframeResponse:function(e){var t=e.contentDocument||e.contentWindow.document,n=t.location.search,i=/bucket=(.+)&key=(.+)&etag=(.+)/.exec(n);if(i){return{bucket:i[1],key:i[2],etag:i[3].replace(/%22/g,"")}}},getSuccessRedirectAbsoluteUrl:function(e){if(e){var t=document.createElement("div"),n;if(qq.ie7()){t.innerHTML="<a href='"+e+"'></a>";n=t.firstChild;return n.href}else{n=document.createElement("a");n.href=e;n.href=n.href;return n.href}}},getV4CredentialsString:function(e){return e.key+"/"+qq.s3.util.getCredentialsDate(e.date)+"/"+e.region+"/s3/aws4_request"},getV4PolicyDate:function(e,t){var n=new Date(e.getTime()+t);return qq.s3.util.getCredentialsDate(n)+"T"+("0"+n.getUTCHours()).slice(-2)+("0"+n.getUTCMinutes()).slice(-2)+("0"+n.getUTCSeconds()).slice(-2)+"Z"},encodeQueryStringParam:function(e){var t=encodeURIComponent(e);t=t.replace(/[!'()]/g,escape);t=t.replace(/\*/g,"%2A");return t.replace(/%20/g,"+")},uriEscape:function(e){var t=encodeURIComponent(e);t=t.replace(/[^A-Za-z0-9_.~\-%]+/g,escape);t=t.replace(/[*]/g,function(e){return"%"+e.charCodeAt(0).toString(16).toUpperCase()});return t},uriEscapePath:function(e){var t=[];qq.each(e.split("/"),function(e,n){t.push(qq.s3.util.uriEscape(n))});return t.join("/")}}}();(function(){"use strict";qq.nonTraditionalBasePublicApi={setUploadSuccessParams:function(e,t){this._uploadSuccessParamsStore.set(e,t)},setUploadSuccessEndpoint:function(e,t){this._uploadSuccessEndpointStore.set(e,t)}};qq.nonTraditionalBasePrivateApi={_onComplete:function(e,t,n,i){var r=n.success?true:false,o=this,s=arguments,a=this._uploadSuccessEndpointStore.get(e),l=this._options.uploadSuccess.customHeaders,u=this._options.uploadSuccess.method,c=this._options.cors,d=new qq.Promise,f=this._uploadSuccessParamsStore.get(e),p=this._paramsStore.get(e),h=function(t){delete o._failedSuccessRequestCallbacks[e];qq.extend(n,t);qq.FineUploaderBasic.prototype._onComplete.apply(o,s);d.success(t)},q=function(r){var a=g;qq.extend(n,r);if(n&&n.reset){a=null}if(!a){delete o._failedSuccessRequestCallbacks[e]}else{o._failedSuccessRequestCallbacks[e]=a}if(!o._onAutoRetry(e,t,n,i,a)){qq.FineUploaderBasic.prototype._onComplete.apply(o,s);d.failure(r)}},g,m;if(r&&a){m=new qq.UploadSuccessAjaxRequester({endpoint:a,method:u,customHeaders:l,cors:c,log:qq.bind(this.log,this)});qq.extend(f,o._getEndpointSpecificParams(e,n,i),true);p&&qq.extend(f,p,true);g=qq.bind(function(){m.sendSuccessRequest(e,f).then(h,q)},o);g();return d}return qq.FineUploaderBasic.prototype._onComplete.apply(this,arguments)},_manualRetry:function(e){var t=this._failedSuccessRequestCallbacks[e];return qq.FineUploaderBasic.prototype._manualRetry.call(this,e,t)}}})();(function(){"use strict";qq.s3.FineUploaderBasic=function(e){var t={request:{accessKey:null,clockDrift:0},objectProperties:{acl:"private",bucket:qq.bind(function(e){return qq.s3.util.getBucket(this.getEndpoint(e))},this),host:qq.bind(function(e){return/(?:http|https):\/\/(.+)(?:\/.+)?/.exec(this._endpointStore.get(e))[1]},this),key:"uuid",reducedRedundancy:false,region:"us-east-1",serverSideEncryption:false},credentials:{accessKey:null,secretKey:null,expiration:null,sessionToken:null},signature:{customHeaders:{},endpoint:null,version:2},uploadSuccess:{endpoint:null,method:"POST",params:{},customHeaders:{}},iframeSupport:{localBlankPagePath:null},chunking:{partSize:5242880},cors:{allowXdr:true},callbacks:{onCredentialsExpired:function(){}}};qq.extend(t,e,true);if(!this.setCredentials(t.credentials,true)){this._currentCredentials.accessKey=t.request.accessKey}this._aclStore=this._createStore(t.objectProperties.acl);qq.FineUploaderBasic.call(this,t);this._uploadSuccessParamsStore=this._createStore(this._options.uploadSuccess.params);this._uploadSuccessEndpointStore=this._createStore(this._options.uploadSuccess.endpoint);this._failedSuccessRequestCallbacks={};this._cannedKeys={};this._cannedBuckets={};this._buckets={};this._hosts={}};qq.extend(qq.s3.FineUploaderBasic.prototype,qq.basePublicApi);qq.extend(qq.s3.FineUploaderBasic.prototype,qq.basePrivateApi);qq.extend(qq.s3.FineUploaderBasic.prototype,qq.nonTraditionalBasePublicApi);qq.extend(qq.s3.FineUploaderBasic.prototype,qq.nonTraditionalBasePrivateApi);qq.extend(qq.s3.FineUploaderBasic.prototype,{getBucket:function(e){if(this._cannedBuckets[e]==null){return this._buckets[e]}return this._cannedBuckets[e]},getKey:function(e){if(this._cannedKeys[e]==null){return this._handler.getThirdPartyFileId(e)}return this._cannedKeys[e]},reset:function(){qq.FineUploaderBasic.prototype.reset.call(this);this._failedSuccessRequestCallbacks=[];this._buckets={};this._hosts={}},setCredentials:function(e,t){if(e&&e.secretKey){if(!e.accessKey){throw new qq.Error("Invalid credentials: no accessKey")}else if(!e.expiration){throw new qq.Error("Invalid credentials: no expiration")}else{this._currentCredentials=qq.extend({},e);if(qq.isString(e.expiration)){this._currentCredentials.expiration=new Date(e.expiration)}}return true}else if(!t){throw new qq.Error("Invalid credentials parameter!")}else{this._currentCredentials={}}},setAcl:function(e,t){this._aclStore.set(e,t)},_createUploadHandler:function(){var e=this,t={aclStore:this._aclStore,getBucket:qq.bind(this._determineBucket,this),getHost:qq.bind(this._determineHost,this),getKeyName:qq.bind(this._determineKeyName,this),iframeSupport:this._options.iframeSupport,objectProperties:this._options.objectProperties,signature:this._options.signature,clockDrift:this._options.request.clockDrift,validation:{minSizeLimit:this._options.validation.minSizeLimit,maxSizeLimit:this._options.validation.sizeLimit}};qq.override(this._endpointStore,function(e){return{get:function(t){var n=e.get(t);if(n.indexOf("http")<0){return"http://"+n}return n}}});qq.override(this._paramsStore,function(e){return{get:function(t){var n=e.get(t),i={};qq.each(n,function(e,t){var n=e;if(qq.indexOf(qq.s3.util.CASE_SENSITIVE_PARAM_NAMES,n)<0){n=n.toLowerCase()}i[n]=qq.isFunction(t)?t():t});return i}}});t.signature.credentialsProvider={get:function(){return e._currentCredentials},onExpired:function(){var t=new qq.Promise,n=e._options.callbacks.onCredentialsExpired();if(qq.isGenericPromise(n)){n.then(function(n){try{e.setCredentials(n);t.success()}catch(n){e.log("Invalid credentials returned from onCredentialsExpired callback! ("+n.message+")","error");t.failure("onCredentialsExpired did not return valid credentials.")}},function(n){e.log("onCredentialsExpired callback indicated failure! ("+n+")","error");t.failure("onCredentialsExpired callback failed.")})}else{e.log("onCredentialsExpired callback did not return a promise!","error");t.failure("Unexpected return value for onCredentialsExpired.")}return t}};return qq.FineUploaderBasic.prototype._createUploadHandler.call(this,t,"s3")},_determineObjectPropertyValue:function(e,t){var n=this._options.objectProperties[t],i=new qq.Promise,r=this;if(qq.isFunction(n)){n=n(e);if(qq.isGenericPromise(n)){i=n}else{i.success(n)}}else if(qq.isString(n)){i.success(n)}i.then(function n(i){r["_"+t+"s"][e]=i},function n(i){qq.log("Problem determining "+t+" for ID "+e+" ("+i+")","error")});return i},_determineBucket:function(e){return this._determineObjectPropertyValue(e,"bucket")},_determineHost:function(e){return this._determineObjectPropertyValue(e,"host")},_determineKeyName:function(e,t){var n=new qq.Promise,i=this._options.objectProperties.key,r=qq.getExtension(t),o=n.failure,s=function(e,t){var i=e;if(t!==undefined){i+="."+t}n.success(i)};switch(i){case"uuid":s(this.getUuid(e),r);break;case"filename":s(t);break;default:if(qq.isFunction(i)){this._handleKeynameFunction(i,e,s,o)}else{this.log(i+" is not a valid value for the s3.keyname option!","error");o()}}return n},_handleKeynameFunction:function(e,t,n,i){var r=this,o=function(e){n(e)},s=function(e){r.log(qq.format("Failed to retrieve key name for {}.  Reason: {}",t,e||"null"),"error");i(e)},a=e.call(this,t);if(qq.isGenericPromise(a)){a.then(o,s)}else if(a==null){s()}else{o(a)}},_getEndpointSpecificParams:function(e,t,n){var i={key:this.getKey(e),uuid:this.getUuid(e),name:this.getName(e),bucket:this.getBucket(e)};if(n&&n.getResponseHeader("ETag")){i.etag=n.getResponseHeader("ETag")}else if(t.etag){i.etag=t.etag}return i},_onSubmitDelete:function(e,t){var n={key:this.getKey(e),bucket:this.getBucket(e)};return qq.FineUploaderBasic.prototype._onSubmitDelete.call(this,e,t,n)},_addCannedFile:function(e){var t;if(e.s3Key==null){throw new qq.Error("Did not find s3Key property in server session response.  This is required!")}else{t=qq.FineUploaderBasic.prototype._addCannedFile.apply(this,arguments);this._cannedKeys[t]=e.s3Key;this._cannedBuckets[t]=e.s3Bucket}return t}})})();if(!window.Uint8ClampedArray){window.Uint8ClampedArray=function(){}}qq.s3.RequestSigner=function(e){"use strict";var t,n=this,i={},r={expectingPolicy:false,method:"POST",signatureSpec:{drift:0,credentialsProvider:{},endpoint:null,customHeaders:{},version:2},maxConnections:3,endpointStore:{},paramsStore:{},cors:{expected:false,sendCredentials:false},log:function(e,t){}},o,s=function(e,t,n){var i=e.getHeaders();if(r.signatureSpec.version===4){i.Authorization=qq.s3.util.V4_ALGORITHM_PARAM_VALUE+" Credential="+r.signatureSpec.credentialsProvider.get().accessKey+"/"+qq.s3.util.getCredentialsDate(e.getRequestDate())+"/"+r.signatureSpec.region+"/"+"s3/aws4_request,"+"SignedHeaders="+e.getSignedHeaders()+","+"Signature="+t}else{i.Authorization="AWS "+r.signatureSpec.credentialsProvider.get().accessKey+":"+t}n.success(i,e.getEndOfUrl())},a={getStringToSign:function(e){return qq.format("{}\n{}\n{}\n\n{}/{}/{}",e.method,e.contentMd5||"",e.contentType||"",e.headersStr||"\n",e.bucket,e.endOfUrl)},signApiRequest:function(e,t,n){var i=qq.CryptoJS.enc.Utf8.parse(t),r=qq.CryptoJS.HmacSHA1(i,o.get().secretKey),a=qq.CryptoJS.enc.Base64.stringify(r);s(e,a,n)},signPolicy:function(e,t,n,i){var r=JSON.stringify(e),s=qq.CryptoJS.enc.Utf8.parse(r),a=qq.CryptoJS.enc.Base64.stringify(s),l=qq.CryptoJS.HmacSHA1(a,o.get().secretKey),u=qq.CryptoJS.enc.Base64.stringify(l);t.success({policy:a,signature:u},n,i)}},l={getCanonicalQueryString:function(e){var t=e.indexOf("?"),n="",i,r,o;if(t>=0){i={};o=e.substr(t+1).split("&");qq.each(o,function(e,t){var n=t.split("="),r=n[1];if(r==null){r=""}i[encodeURIComponent(n[0])]=encodeURIComponent(r)});r=Object.keys(i).sort();r.forEach(function(e,t){n+=e+"="+i[e];if(t<r.length-1){n+="&"}})}return n},getCanonicalRequest:function(e){return qq.format("{}\n{}\n{}\n{}\n{}\n{}",e.method,l.getCanonicalUri(e.endOfUrl),l.getCanonicalQueryString(e.endOfUrl),e.headersStr||"\n",l.getSignedHeaders(e.headerNames),e.hashedContent)},getCanonicalUri:function(e){var t=e,n=e.indexOf("?");if(n>0){t=e.substr(0,n)}return"/"+t},getEncodedHashedPayload:function(e){var t=new qq.Promise,n;if(qq.isBlob(e)){n=new FileReader;n.onloadend=function(e){if(e.target.readyState===FileReader.DONE){if(e.target.error){t.failure(e.target.error)}else{var n=qq.CryptoJS.lib.WordArray.create(e.target.result);t.success(qq.CryptoJS.SHA256(n).toString())}}};n.readAsArrayBuffer(e)}else{e=e||"";t.success(qq.CryptoJS.SHA256(e).toString())}return t},getScope:function(e,t){return qq.s3.util.getCredentialsDate(e)+"/"+t+"/s3/aws4_request"},getStringToSign:function(e){var t=l.getCanonicalRequest(e),n=qq.s3.util.getV4PolicyDate(e.date,e.drift),i=qq.CryptoJS.SHA256(t).toString(),o=l.getScope(e.date,r.signatureSpec.region),s="AWS4-HMAC-SHA256\n{}\n{}\n{}";return{hashed:qq.format(s,n,o,i),raw:qq.format(s,n,o,t)}},getSignedHeaders:function(e){var t="";e.forEach(function(n,i){t+=n.toLowerCase();if(i<e.length-1){t+=";"}});return t},signApiRequest:function(e,t,n){var i=o.get().secretKey,r=/.+\n.+\n(\d+)\/(.+)\/s3\/.+\n(.+)/,a=r.exec(t),l,u,c,d;l=qq.CryptoJS.HmacSHA256(a[1],"AWS4"+i);u=qq.CryptoJS.HmacSHA256(a[2],l);c=qq.CryptoJS.HmacSHA256("s3",u);d=qq.CryptoJS.HmacSHA256("aws4_request",c);s(e,qq.CryptoJS.HmacSHA256(t,d),n)},signPolicy:function(e,t,n,i){var r=JSON.stringify(e),s=qq.CryptoJS.enc.Utf8.parse(r),a=qq.CryptoJS.enc.Base64.stringify(s),l=o.get().secretKey,u=/.+\/(.+)\/(.+)\/s3\/aws4_request/,c=function(){var t=null;qq.each(e.conditions,function(e,n){var i=n["x-amz-credential"];if(i){t=i;return false}});return t}(),d,f,p,h,q;d=u.exec(c);f=qq.CryptoJS.HmacSHA256(d[1],"AWS4"+l);p=qq.CryptoJS.HmacSHA256(d[2],f);h=qq.CryptoJS.HmacSHA256("s3",p);q=qq.CryptoJS.HmacSHA256("aws4_request",h);t.success({policy:a,signature:qq.CryptoJS.HmacSHA256(a,q).toString()},n,i)}};qq.extend(r,e,true);o=r.signatureSpec.credentialsProvider;function u(e,t,n){var o=t.responseText,a=i[e],l=a.promise,u=a.signatureConstructor,c,d;delete i[e];if(o){try{d=qq.parseJson(o)}catch(e){r.log("Error attempting to parse signature response: "+e,"error")}}if(d&&d.error){n=true;c=d.error}else if(d&&d.invalid){n=true;c="Invalid policy document or request headers!"}else if(d){if(r.expectingPolicy&&!d.policy){n=true;c="Response does not include the base64 encoded policy!"}else if(!d.signature){n=true;c="Response does not include the signature!"}}else{n=true;c="Received an empty or invalid response from the server!"}if(n){if(c){r.log(c,"error")}l.failure(c)}else if(u){s(u,d.signature,l)}else{l.success(d)}}function c(e,t,i){var o=new qq.Promise,s="POST",u=[],c="",d=new Date,f,p,h,q=function(e){var n,i=[];qq.each(e.headers,function(e){u.push(e)});u.sort();qq.each(u,function(t,r){if(qq.indexOf(qq.s3.util.UNSIGNABLE_REST_HEADER_NAMES,r)<0){c+=r.toLowerCase()+":"+e.headers[r].trim()+"\n"}else if(r==="Content-MD5"){n=e.headers[r]}else{i.unshift(t)}});qq.each(i,function(e,t){u.splice(t,1)});p={bucket:e.bucket,contentMd5:n,contentType:e.contentType,date:d,drift:r.signatureSpec.drift,endOfUrl:f,hashedContent:e.hashedContent,headerNames:u,headersStr:c,method:s};h=t===2?a.getStringToSign(p):l.getStringToSign(p);return{date:d,endOfUrl:f,signedHeaders:t===4?l.getSignedHeaders(p.headerNames):null,toSign:t===4?h.hashed:h,toSignRaw:t===4?h.raw:h}};switch(i.type){case n.REQUEST_TYPE.MULTIPART_ABORT:s="DELETE";f=qq.format("uploadId={}",i.uploadId);break;case n.REQUEST_TYPE.MULTIPART_INITIATE:f="uploads";break;case n.REQUEST_TYPE.MULTIPART_COMPLETE:f=qq.format("uploadId={}",i.uploadId);break;case n.REQUEST_TYPE.MULTIPART_UPLOAD:s="PUT";f=qq.format("partNumber={}&uploadId={}",i.partNum,i.uploadId);break}f=i.key+"?"+f;if(t===4){l.getEncodedHashedPayload(i.content).then(function(e){i.headers["x-amz-content-sha256"]=e;i.headers.Host=i.host;i.headers["x-amz-date"]=qq.s3.util.getV4PolicyDate(d,r.signatureSpec.drift);i.hashedContent=e;o.success(q(i))},function(e){o.failure(e)})}else{o.success(q(i))}return o}function d(e,t,n,i,r){var o;if(t.signatureConstructor){if(r){o=t.signatureConstructor.getHeaders();o[qq.s3.util.SESSION_TOKEN_PARAM_NAME]=r;t.signatureConstructor.withHeaders(o)}t.signatureConstructor.getToSign(e).then(function(e){p(t.signatureConstructor,e.stringToSign,n)},function(e){n.failure(e)})}else{r&&qq.s3.util.refreshPolicyCredentials(t,r);f(t,n,i,r)}}function f(e,t,n,i){if(r.signatureSpec.version===4){l.signPolicy(e,t,n,i)}else{a.signPolicy(e,t,n,i)}}function p(e,t,n){if(r.signatureSpec.version===4){l.signApiRequest(e,t,n)}else{a.signApiRequest(e,t,n)}}t=qq.extend(this,new qq.AjaxRequester({acceptHeader:"application/json",method:r.method,contentType:"application/json; charset=utf-8",endpointStore:{get:function(){return r.signatureSpec.endpoint}},paramsStore:r.paramsStore,maxConnections:r.maxConnections,customHeaders:r.signatureSpec.customHeaders,log:r.log,onComplete:u,cors:r.cors}));qq.extend(this,{getSignature:function(e,n){var s=n,a=n.signatureConstructor,l=new qq.Promise,u;if(r.signatureSpec.version===4){u={v4:true}}if(o.get().secretKey&&qq.CryptoJS){if(o.get().expiration.getTime()>Date.now()){d(e,n,l)}else{o.onExpired().then(function(){d(e,n,l,o.get().accessKey,o.get().sessionToken)},function(e){r.log("Attempt to update expired credentials apparently failed! Unable to sign request.  ","error");l.failure("Unable to sign request - expired credentials.")})}}else{r.log("Submitting S3 signature request for "+e);if(a){a.getToSign(e).then(function(n){s={headers:n.stringToSignRaw};t.initTransport(e).withParams(s).withQueryParams(u).send()},function(e){r.log("Failed to construct signature. ","error");l.failure("Failed to construct signature.")})}else{t.initTransport(e).withParams(s).withQueryParams(u).send()}i[e]={promise:l,signatureConstructor:a}}return l},constructStringToSign:function(e,t,n,i){var s={},a,l,u,d,f;return{withHeaders:function(e){s=e;return this},withUploadId:function(e){a=e;return this},withContent:function(e){l=e;return this},withContentType:function(e){u=e;return this},withPartNum:function(e){d=e;return this},getToSign:function(p){var h=o.get().sessionToken,q=new qq.Promise,g=new Date(Date.now()+r.signatureSpec.drift);s["x-amz-date"]=g.toUTCString();if(h){s[qq.s3.util.SESSION_TOKEN_PARAM_NAME]=h}c(p,r.signatureSpec.version,{bucket:t,content:l,contentType:u,headers:s,host:n,key:i,partNum:d,type:e,uploadId:a}).then(function(e){f=e;q.success({headers:function(){if(u){s["Content-Type"]=u}delete s.Host;return s}(),date:f.date,endOfUrl:f.endOfUrl,signedHeaders:f.signedHeaders,stringToSign:f.toSign,stringToSignRaw:f.toSignRaw})},function(e){q.failure(e)});return q},getHeaders:function(){return qq.extend({},s)},getEndOfUrl:function(){return f&&f.endOfUrl},getRequestDate:function(){return f&&f.date},getSignedHeaders:function(){return f&&f.signedHeaders}}}})};qq.s3.RequestSigner.prototype.REQUEST_TYPE={MULTIPART_INITIATE:"multipart_initiate",MULTIPART_COMPLETE:"multipart_complete",MULTIPART_ABORT:"multipart_abort",MULTIPART_UPLOAD:"multipart_upload"};qq.UploadSuccessAjaxRequester=function(e){"use strict";var t,n=[],i={method:"POST",endpoint:null,maxConnections:3,customHeaders:{},paramsStore:{},cors:{expected:false,sendCredentials:false},log:function(e,t){}};qq.extend(i,e);function r(e,t,r){var o=n[e],s=t.responseText,a={success:true},l={success:false},u;delete n[e];i.log(qq.format("Received the following response body to an upload success request for id {}: {}",e,s));try{u=qq.parseJson(s);if(r||u&&(u.error||u.success===false)){i.log("Upload success request was rejected by the server.","error");o.failure(qq.extend(u,l))}else{i.log("Upload success was acknowledged by the server.");o.success(qq.extend(u,a))}}catch(t){if(r){i.log(qq.format("Your server indicated failure in its upload success request response for id {}!",e),"error");o.failure(l)}else{i.log("Upload success was acknowledged by the server.");o.success(a)}}}t=qq.extend(this,new qq.AjaxRequester({acceptHeader:"application/json",method:i.method,endpointStore:{get:function(){return i.endpoint}},paramsStore:i.paramsStore,maxConnections:i.maxConnections,customHeaders:i.customHeaders,log:i.log,onComplete:r,cors:i.cors}));qq.extend(this,{sendSuccessRequest:function(e,r){var o=new qq.Promise;i.log("Submitting upload success request/notification for "+e);t.initTransport(e).withParams(r).send();n[e]=o;return o}})};qq.s3.InitiateMultipartAjaxRequester=function(e){"use strict";var t,n={},i={filenameParam:"qqfilename",method:"POST",endpointStore:null,paramsStore:null,signatureSpec:null,aclStore:null,reducedRedundancy:false,serverSideEncryption:false,maxConnections:3,getContentType:function(e){},getBucket:function(e){},getHost:function(e){},getKey:function(e){},getName:function(e){},log:function(e,t){}},r;qq.extend(i,e);r=new qq.s3.RequestSigner({endpointStore:i.endpointStore,signatureSpec:i.signatureSpec,cors:i.cors,log:i.log});function o(e){var t=i.getBucket(e),n=i.getHost(e),o={},s=new qq.Promise,a=i.getKey(e),l;o["x-amz-acl"]=i.aclStore.get(e);if(i.reducedRedundancy){o[qq.s3.util.REDUCED_REDUNDANCY_PARAM_NAME]=qq.s3.util.REDUCED_REDUNDANCY_PARAM_VALUE}if(i.serverSideEncryption){o[qq.s3.util.SERVER_SIDE_ENCRYPTION_PARAM_NAME]=qq.s3.util.SERVER_SIDE_ENCRYPTION_PARAM_VALUE}o[qq.s3.util.AWS_PARAM_PREFIX+i.filenameParam]=encodeURIComponent(i.getName(e));qq.each(i.paramsStore.get(e),function(e,t){if(qq.indexOf(qq.s3.util.UNPREFIXED_PARAM_NAMES,e)>=0){o[e]=t}else{o[qq.s3.util.AWS_PARAM_PREFIX+e]=encodeURIComponent(t)}});l=r.constructStringToSign(r.REQUEST_TYPE.MULTIPART_INITIATE,t,n,a).withContentType(i.getContentType(e)).withHeaders(o);r.getSignature(e,{signatureConstructor:l}).then(s.success,s.failure);return s}function s(e,t,r){var o=n[e],s=new DOMParser,a=s.parseFromString(t.responseText,"application/xml"),l,u,c,d,f;delete n[e];if(r){f=t.status;u=a.getElementsByTagName("Message");if(u.length>0){d=u[0].textContent}}else{l=a.getElementsByTagName("UploadId");if(l.length>0){c=l[0].textContent}else{d="Upload ID missing from request"}}if(c===undefined){if(d){i.log(qq.format("Specific problem detected initiating multipart upload request for {}: '{}'.",e,d),"error")}else{i.log(qq.format("Unexplained error with initiate multipart upload request for {}.  Status code {}.",e,f),"error")}o.failure("Problem initiating upload request.",t)}else{i.log(qq.format("Initiate multipart upload request successful for {}.  Upload ID is {}",e,c));o.success(c,t)}}t=qq.extend(this,new qq.AjaxRequester({method:i.method,contentType:null,endpointStore:i.endpointStore,maxConnections:i.maxConnections,allowXRequestedWithAndCacheControl:false,log:i.log,onComplete:s,successfulResponseCodes:{POST:[200]}}));qq.extend(this,{send:function(e){var r=new qq.Promise;o(e).then(function(o,s){i.log("Submitting S3 initiate multipart upload request for "+e);n[e]=r;t.initTransport(e).withPath(s).withHeaders(o).send()},r.failure);return r}})};qq.s3.CompleteMultipartAjaxRequester=function(e){"use strict";var t,n={},i={method:"POST",contentType:"text/xml",endpointStore:null,signatureSpec:null,maxConnections:3,getBucket:function(e){},getHost:function(e){},getKey:function(e){},log:function(e,t){}},r;qq.extend(i,e);r=new qq.s3.RequestSigner({endpointStore:i.endpointStore,signatureSpec:i.signatureSpec,cors:i.cors,log:i.log});function o(e,t,n){var o={},s=new qq.Promise,a=i.getBucket(e),l=i.getHost(e),u=r.constructStringToSign(r.REQUEST_TYPE.MULTIPART_COMPLETE,a,l,i.getKey(e)).withUploadId(t).withContent(n).withContentType("application/xml; charset=UTF-8");r.getSignature(e,{signatureConstructor:u}).then(s.success,s.failure);return s}function s(e,t,r){var o=n[e],s=new DOMParser,a=i.getBucket(e),l=i.getKey(e),u=s.parseFromString(t.responseText,"application/xml"),c=u.getElementsByTagName("Bucket"),d=u.getElementsByTagName("Key");delete n[e];i.log(qq.format("Complete response status {}, body = {}",t.status,t.responseText));if(r){i.log(qq.format("Complete Multipart Upload request for {} failed with status {}.",e,t.status),"error")}else{if(c.length&&d.length){if(c[0].textContent!==a){r=true;i.log(qq.format("Wrong bucket in response to Complete Multipart Upload request for {}.",e),"error")}}else{r=true;i.log(qq.format("Missing bucket and/or key in response to Complete Multipart Upload request for {}.",e),"error")}}if(r){o.failure("Problem combining the file parts!",t)}else{o.success({},t)}}function a(e){var t=document.implementation.createDocument(null,"CompleteMultipartUpload",null);e.sort(function(e,t){return e.part-t.part});qq.each(e,function(e,n){var i=n.part,r=n.etag,o=t.createElement("Part"),s=t.createElement("PartNumber"),a=t.createTextNode(i),l=t.createTextNode(r),u=t.createElement("ETag");u.appendChild(l);s.appendChild(a);o.appendChild(s);o.appendChild(u);qq(t).children()[0].appendChild(o)});return(new XMLSerializer).serializeToString(t)}t=qq.extend(this,new qq.AjaxRequester({method:i.method,contentType:"application/xml; charset=UTF-8",endpointStore:i.endpointStore,maxConnections:i.maxConnections,allowXRequestedWithAndCacheControl:false,log:i.log,onComplete:s,successfulResponseCodes:{POST:[200]}}));qq.extend(this,{send:function(e,r,s){var l=new qq.Promise,u=a(s);o(e,r,u).then(function(r,o){i.log("Submitting S3 complete multipart upload request for "+e);n[e]=l;delete r["Content-Type"];t.initTransport(e).withPath(o).withHeaders(r).withPayload(u).send()},l.failure);return l}})};qq.s3.AbortMultipartAjaxRequester=function(e){"use strict";var t,n={method:"DELETE",endpointStore:null,signatureSpec:null,maxConnections:3,getBucket:function(e){},getHost:function(e){},getKey:function(e){},log:function(e,t){}},i;qq.extend(n,e);i=new qq.s3.RequestSigner({endpointStore:n.endpointStore,signatureSpec:n.signatureSpec,cors:n.cors,log:n.log});function r(e,t){var r={},o=new qq.Promise,s=n.getBucket(e),a=n.getHost(e),l=i.constructStringToSign(i.REQUEST_TYPE.MULTIPART_ABORT,s,a,n.getKey(e)).withUploadId(t);i.getSignature(e,{signatureConstructor:l}).then(o.success,o.failure);return o}function o(e,t,i){var r=new DOMParser,o=r.parseFromString(t.responseText,"application/xml"),s=o.getElementsByTagName("Error"),a;n.log(qq.format("Abort response status {}, body = {}",t.status,t.responseText));if(i){n.log(qq.format("Abort Multipart Upload request for {} failed with status {}.",e,t.status),"error")}else{if(s.length){i=true;a=o.getElementsByTagName("Message")[0].textContent;n.log(qq.format("Failed to Abort Multipart Upload request for {}.  Error: {}",e,a),"error")}else{n.log(qq.format("Abort MPU request succeeded for file ID {}.",e))}}}t=qq.extend(this,new qq.AjaxRequester({validMethods:["DELETE"],method:n.method,contentType:null,endpointStore:n.endpointStore,maxConnections:n.maxConnections,allowXRequestedWithAndCacheControl:false,log:n.log,onComplete:o,successfulResponseCodes:{DELETE:[204]}}));qq.extend(this,{send:function(e,i){r(e,i).then(function(i,r){n.log("Submitting S3 Abort multipart upload request for "+e);t.initTransport(e).withPath(r).withHeaders(i).send()})}})};qq.s3.XhrUploadHandler=function(e,t){"use strict";var n=t.getName,i=t.log,r=e.clockDrift,o=200,s=e.getBucket,a=e.getHost,l=e.getKeyName,u=e.filenameParam,c=e.paramsStore,d=e.endpointStore,f=e.aclStore,p=e.objectProperties.reducedRedundancy,h=e.objectProperties.region,q=e.objectProperties.serverSideEncryption,g=e.validation,m=qq.extend({region:h,drift:r},e.signature),_=this,v=e.signature.credentialsProvider,b={combine:function(e){var t=_._getPersistableData(e).uploadId,n=_._getPersistableData(e).etags,i=new qq.Promise;y.completeMultipart.send(e,t,n).then(i.success,function t(n,r){i.failure(w.done(e,r).response,r)});return i},done:function(e,t,n){var i=w.response.parse(e,t),r;if(i.success){r=t.getResponseHeader("ETag");if(!_._getPersistableData(e).etags){_._getPersistableData(e).etags=[]}_._getPersistableData(e).etags.push({part:n+1,etag:r})}},initHeaders:function(e,t,n){var i={},r=w.bucket.getName(e),o=w.host.getName(e),s=w.key.urlSafe(e),a=new qq.Promise,l=y.restSignature.constructStringToSign(y.restSignature.REQUEST_TYPE.MULTIPART_UPLOAD,r,o,s).withPartNum(t+1).withContent(n).withUploadId(_._getPersistableData(e).uploadId);y.restSignature.getSignature(e+"."+t,{signatureConstructor:l}).then(a.success,a.failure);return a},put:function(t,n){var r=_._createXhr(t,n),o=_._getChunkData(t,n),s=e.endpointStore.get(t),a=new qq.Promise;b.initHeaders(t,n,o.blob).then(function(e,l){if(r._cancelled){i(qq.format("Upload of item {}.{} cancelled. Upload will not start after successful signature request.",t,n));a.failure({error:"Chunk upload cancelled"})}else{var u=s+"/"+l;_._registerProgressHandler(t,n,o.size);w.track(t,r,n).then(a.success,a.failure);r.open("PUT",u,true);qq.each(e,function(e,t){r.setRequestHeader(e,t)});r.send(o.blob)}},function(){a.failure({error:"Problem signing the chunk!"},r)});return a},send:function(e,t){var n=new qq.Promise;b.setup(e).then(function(){b.put(e,t).then(n.success,n.failure)},function(e,t){n.failure({error:e},t)});return n},setup:function(e){var t=new qq.Promise,n=_._getPersistableData(e).uploadId,i=new qq.Promise;if(!n){_._getPersistableData(e).uploadId=i;y.initiateMultipart.send(e).then(function(n){_._getPersistableData(e).uploadId=n;i.success(n);t.success(n)},function(n,r){_._getPersistableData(e).uploadId=null;t.failure(n,r);i.failure(n,r)})}else if(n instanceof qq.Promise){n.then(function(e){t.success(e)})}else{t.success(n)}return t}},y={abortMultipart:new qq.s3.AbortMultipartAjaxRequester({endpointStore:d,signatureSpec:m,cors:e.cors,log:i,getBucket:function(e){return w.bucket.getName(e)},getHost:function(e){return w.host.getName(e)},getKey:function(e){return w.key.urlSafe(e)}}),completeMultipart:new qq.s3.CompleteMultipartAjaxRequester({endpointStore:d,signatureSpec:m,cors:e.cors,log:i,getBucket:function(e){return w.bucket.getName(e)},getHost:function(e){return w.host.getName(e)},getKey:function(e){return w.key.urlSafe(e)}}),initiateMultipart:new qq.s3.InitiateMultipartAjaxRequester({filenameParam:u,endpointStore:d,paramsStore:c,signatureSpec:m,aclStore:f,reducedRedundancy:p,serverSideEncryption:q,cors:e.cors,log:i,getContentType:function(e){return _._getMimeType(e)},getBucket:function(e){return w.bucket.getName(e)},getHost:function(e){return w.host.getName(e)},getKey:function(e){return w.key.urlSafe(e)},getName:function(e){return n(e)}}),policySignature:new qq.s3.RequestSigner({expectingPolicy:true,signatureSpec:m,cors:e.cors,log:i}),restSignature:new qq.s3.RequestSigner({endpointStore:d,signatureSpec:m,cors:e.cors,log:i})},S={initParams:function(e){var t=c.get(e);t[u]=n(e);return qq.s3.util.generateAwsParams({endpoint:d.get(e),clockDrift:r,params:t,type:_._getMimeType(e),bucket:w.bucket.getName(e),key:_.getThirdPartyFileId(e),accessKey:v.get().accessKey,sessionToken:v.get().sessionToken,acl:f.get(e),expectedStatus:o,minFileSize:g.minSizeLimit,maxFileSize:g.maxSizeLimit,reducedRedundancy:p,region:h,serverSideEncryption:q,signatureVersion:m.version,log:i},qq.bind(y.policySignature.getSignature,this,e))},send:function(e){var t=new qq.Promise,n=_._createXhr(e),r=_.getFile(e);_._registerProgressHandler(e);w.track(e,n).then(t.success,t.failure);S.setup(e,n,r).then(function(t){i("Sending upload request for "+e);n.send(t)},t.failure);return t},setup:function(e,t,n){var i=new FormData,r=d.get(e),o=r,s=new qq.Promise;S.initParams(e).then(function(e){t.open("POST",o,true);qq.obj2FormData(e,i);i.append("file",n);s.success(i)},function(e){s.failure({error:e})});return s}},w={bucket:{promise:function(e){var t=new qq.Promise,n=_._getFileState(e).bucket;if(n){t.success(n)}else{s(e).then(function(n){_._getFileState(e).bucket=n;t.success(n)},t.failure)}return t},getName:function(e){return _._getFileState(e).bucket}},host:{promise:function(e){var t=new qq.Promise,n=_._getFileState(e).host;if(n){t.success(n)}else{a(e).then(function(n){_._getFileState(e).host=n;t.success(n)},t.failure)}return t},getName:function(e){return _._getFileState(e).host}},done:function(e,t){var n=w.response.parse(e,t),r=n.success!==true;if(r&&w.response.shouldReset(n.code)){i("This is an unrecoverable error, we must restart the upload entirely on the next retry attempt.","error");n.reset=true}return{success:!r,response:n}},key:{promise:function(e){var t=new qq.Promise,i=_.getThirdPartyFileId(e);if(i==null){_._setThirdPartyFileId(e,t);l(e,n(e)).then(function(n){_._setThirdPartyFileId(e,n);t.success(n)},function(n){_._setThirdPartyFileId(e,null);t.failure(n)})}else if(qq.isGenericPromise(i)){i.then(t.success,t.failure)}else{t.success(i)}return t},urlSafe:function(e){var t=_.getThirdPartyFileId(e);return qq.s3.util.uriEscapePath(t)}},response:{parse:function(e,t){var n={},r;try{i(qq.format("Received response status {} with body: {}",t.status,t.responseText));if(t.status===o){n.success=true}else{r=w.response.parseError(t.responseText);if(r){n.error=r.message;n.code=r.code}}}catch(e){i("Error when attempting to parse xhr response text ("+e.message+")","error")}return n},parseError:function(e){var t=new DOMParser,n=t.parseFromString(e,"application/xml"),i=n.getElementsByTagName("Error"),r={},o,s;if(i.length){o=n.getElementsByTagName("Code");s=n.getElementsByTagName("Message");if(s.length){r.message=s[0].textContent}if(o.length){r.code=o[0].textContent}return r}},shouldReset:function(e){return e==="EntityTooSmall"||e==="InvalidPart"||e==="InvalidPartOrder"||e==="NoSuchUpload"}},start:function(e,t){var n=new qq.Promise;w.key.promise(e).then(function(){w.bucket.promise(e).then(function(){w.host.promise(e).then(function(){if(t==null){S.send(e).then(n.success,n.failure)}else{b.send(e,t).then(n.success,n.failure)}})})},function(e){n.failure({error:e})});return n},track:function(e,t,n){var i=new qq.Promise;t.onreadystatechange=function(){if(t.readyState===4){var r;if(n==null){r=w.done(e,t);i[r.success?"success":"failure"](r.response,t)}else{b.done(e,t,n);r=w.done(e,t);i[r.success?"success":"failure"](r.response,t)}}};return i}};qq.extend(this,{uploadChunk:w.start,uploadFile:w.start});qq.extend(this,new qq.XhrUploadHandler({options:qq.extend({namespace:"s3"},e),proxy:qq.extend({getEndpoint:e.endpointStore.get},t)}));qq.override(this,function(e){return{expunge:function(t){var n=_._getPersistableData(t)&&_._getPersistableData(t).uploadId,i=_._maybeDeletePersistedChunkData(t);if(n!==undefined&&i){y.abortMultipart.send(t,n)}e.expunge(t)},finalizeChunks:function(e){return b.combine(e)},_getLocalStorageId:function(t){var n=e._getLocalStorageId(t),i=w.bucket.getName(t);return n+"-"+i}}})};qq.s3.FormUploadHandler=function(e,t){"use strict";var n=this,i=e.clockDrift,r=t.onUuidChanged,o=t.getName,s=t.getUuid,a=t.log,l=e.getBucket,u=e.getKeyName,c=e.filenameParam,d=e.paramsStore,f=e.endpointStore,p=e.aclStore,h=e.objectProperties.reducedRedundancy,q=e.objectProperties.region,g=e.objectProperties.serverSideEncryption,m=e.validation,_=e.signature,v=e.iframeSupport.localBlankPagePath,b=e.signature.credentialsProvider,y=new qq.s3.RequestSigner({signatureSpec:_,cors:e.cors,log:a});if(v===undefined){throw new Error("successRedirectEndpoint MUST be defined if you intend to use browsers that do not support the File API!")}function S(t,i){var r,o=e.endpointStore.get(t),s=n._getFileState(t).bucket,l,u,c;try{l=i.contentDocument||i.contentWindow.document;u=l.body.innerHTML;c=qq.s3.util.parseIframeResponse(i);if(c.bucket===s&&c.key===qq.s3.util.encodeQueryStringParam(n.getThirdPartyFileId(t))){return true}a("Response from AWS included an unexpected bucket or key name.","error")}catch(e){a("Error when attempting to parse form upload response ("+e.message+")","error")}return false}function w(e){var t=d.get(e);t[c]=o(e);return qq.s3.util.generateAwsParams({endpoint:f.get(e),clockDrift:i,params:t,bucket:n._getFileState(e).bucket,key:n.getThirdPartyFileId(e),accessKey:b.get().accessKey,sessionToken:b.get().sessionToken,acl:p.get(e),minFileSize:m.minSizeLimit,maxFileSize:m.maxSizeLimit,successRedirectUrl:v,reducedRedundancy:h,region:q,serverSideEncryption:g,signatureVersion:_.version,log:a},qq.bind(y.getSignature,this,e))}function C(t,i){var r=new qq.Promise,s="POST",a=e.endpointStore.get(t),l=o(t);w(t).then(function(e){var t=n._initFormForUpload({method:s,endpoint:a,params:e,paramsInBody:true,targetName:i.name});r.success(t)},function(e){r.failure(e);x(t,i,l,{error:e})});return r}function E(e){var t=n._createIframe(e),i=n.getInput(e),r=new qq.Promise;C(e,t).then(function(o){o.appendChild(i);n._attachLoadEvent(t,function(n){a("iframe loaded");if(n){if(n.success===false){a("Amazon likely rejected the upload request","error");r.failure(n)}}else{n={};n.success=S(e,t);if(n.success===false){a("A success response was received by Amazon, but it was invalid in some way.","error");r.failure(n)}else{qq.extend(n,qq.s3.util.parseIframeResponse(t));r.success(n)}}x(e,t)});a("Sending upload request for "+e);o.submit();qq(o).remove()},r.failure);return r}function x(e,t){n._detachLoadEvent(e);t&&qq(t).remove()}qq.extend(this,new qq.FormUploadHandler({options:{isCors:false,inputName:"file"},proxy:{onCancel:e.onCancel,onUuidChanged:r,getName:o,getUuid:s,log:a}}));qq.extend(this,{uploadFile:function(e){var t=o(e),i=new qq.Promise;if(n.getThirdPartyFileId(e)){if(n._getFileState(e).bucket){E(e).then(i.success,i.failure)}else{l(e).then(function(t){n._getFileState(e).bucket=t;E(e).then(i.success,i.failure)})}}else{u(e,t).then(function(t){l(e).then(function(r){n._getFileState(e).bucket=r;n._setThirdPartyFileId(e,t);E(e).then(i.success,i.failure)},function(e){i.failure({error:e})})},function(e){i.failure({error:e})})}return i}})};qq.DragAndDrop=function(e){"use strict";var t,n="qq-hidezones",i="qq-hide-dropzone",r=[],o=[],s=new qq.DisposeSupport;t={dropZoneElements:[],allowMultipleItems:true,classes:{dropActive:null},callbacks:new qq.DragAndDrop.callbacks};qq.extend(t,e,true);function a(e,n){var i=Array.prototype.slice.call(e);t.callbacks.dropLog("Grabbed "+e.length+" dropped files.");n.dropDisabled(false);t.callbacks.processingDroppedFilesComplete(i,n.getElement())}function l(e){var n=new qq.Promise;if(e.isFile){e.file(function(t){var i=e.name,r=e.fullPath,s=r.indexOf(i);r=r.substr(0,s);if(r.charAt(0)==="/"){r=r.substr(1)}t.qqPath=r;o.push(t);n.success()},function(i){t.callbacks.dropLog("Problem parsing '"+e.fullPath+"'.  FileError code "+i.code+".","error");n.failure()})}else if(e.isDirectory){u(e).then(function e(t){var i=t.length;qq.each(t,function(e,t){l(t).done(function(){i-=1;if(i===0){n.success()}})});if(!t.length){n.success()}},function i(r){t.callbacks.dropLog("Problem parsing '"+e.fullPath+"'.  FileError code "+r.code+".","error");n.failure()})}return n}function u(e,t,n,i){var r=i||new qq.Promise,o=t||e.createReader();o.readEntries(function t(i){var s=n?n.concat(i):i;if(i.length){setTimeout(function(){u(e,o,s,r)},0)}else{r.success(s)}},r.failure);return r}function c(e,n){var i=[],r=new qq.Promise;t.callbacks.processingDroppedFiles();n.dropDisabled(true);if(e.files.length>1&&!t.allowMultipleItems){t.callbacks.processingDroppedFilesComplete([]);t.callbacks.dropError("tooManyFilesError","");n.dropDisabled(false);r.failure()}else{o=[];if(qq.isFolderDropSupported(e)){qq.each(e.items,function(e,t){var n=t.webkitGetAsEntry();if(n){if(n.isFile){o.push(t.getAsFile())}else{i.push(l(n).done(function(){i.pop();if(i.length===0){r.success()}}))}}})}else{o=e.files}if(i.length===0){r.success()}}return r}function d(e){var l=new qq.UploadDropZone({HIDE_ZONES_EVENT_NAME:n,element:e,onEnter:function(n){qq(e).addClass(t.classes.dropActive);n.stopPropagation()},onLeaveNotDescendants:function(n){qq(e).removeClass(t.classes.dropActive)},onDrop:function(e){c(e.dataTransfer,l).then(function(){a(o,l)},function(){t.callbacks.dropLog("Drop event DataTransfer parsing failed.  No files will be uploaded.","error")})}});s.addDisposer(function(){l.dispose()});qq(e).hasAttribute(i)&&qq(e).hide();r.push(l);return l}function f(e){var t;qq.each(e.dataTransfer.types,function(e,n){if(n==="Files"){t=true;return false}});return t}function p(e){if(qq.firefox()){return!e.relatedTarget}if(qq.safari()){return e.x<0||e.y<0}return e.x===0&&e.y===0}function h(){var e=t.dropZoneElements,r=function(){setTimeout(function(){qq.each(e,function(e,n){qq(n).hasAttribute(i)&&qq(n).hide();qq(n).removeClass(t.classes.dropActive)})},10)};qq.each(e,function(t,n){var r=d(n);if(e.length&&qq.supportedFeatures.fileDrop){s.attach(document,"dragenter",function(t){if(!r.dropDisabled()&&f(t)){qq.each(e,function(e,t){if(t instanceof HTMLElement&&qq(t).hasAttribute(i)){qq(t).css({display:"block"})}})}})}});s.attach(document,"dragleave",function(e){if(p(e)){r()}});s.attach(qq(document).children()[0],"mouseenter",function(e){r()});s.attach(document,"drop",function(e){e.preventDefault();r()});s.attach(document,n,r)}h();qq.extend(this,{setupExtraDropzone:function(e){t.dropZoneElements.push(e);d(e)},removeDropzone:function(e){var n,i=t.dropZoneElements;for(n in i){if(i[n]===e){return i.splice(n,1)}}},dispose:function(){s.dispose();qq.each(r,function(e,t){t.dispose()})}})};qq.DragAndDrop.callbacks=function(){"use strict";return{processingDroppedFiles:function(){},processingDroppedFilesComplete:function(e,t){},dropError:function(e,t){qq.log("Drag & drop error code '"+e+" with these specifics: '"+t+"'","error")},dropLog:function(e,t){qq.log(e,t)}}};qq.UploadDropZone=function(e){"use strict";var t=new qq.DisposeSupport,n,i,r,o;n={element:null,onEnter:function(e){},onLeave:function(e){},onLeaveNotDescendants:function(e){},onDrop:function(e){}};qq.extend(n,e);i=n.element;function s(){return qq.safari()||qq.firefox()&&qq.windows()}function a(e){if(!o){if(s){t.attach(document,"dragover",function(e){e.preventDefault()})}else{t.attach(document,"dragover",function(e){if(e.dataTransfer){e.dataTransfer.dropEffect="none";e.preventDefault()}})}o=true}}function l(e){if(!qq.supportedFeatures.fileDrop){return false}var t,n=e.dataTransfer,i=qq.safari();t=qq.ie()&&qq.supportedFeatures.fileDrop?true:n.effectAllowed!=="none";return n&&t&&(n.files||!i&&n.types.contains&&n.types.contains("Files"))}function u(e){if(e!==undefined){r=e}return r}function c(){var e;function t(){e=document.createEvent("Event");e.initEvent(n.HIDE_ZONES_EVENT_NAME,true,true)}if(window.CustomEvent){try{e=new CustomEvent(n.HIDE_ZONES_EVENT_NAME)}catch(e){t()}}else{t()}document.dispatchEvent(e)}function d(){t.attach(i,"dragover",function(e){if(!l(e)){return}var t=qq.ie()&&qq.supportedFeatures.fileDrop?null:e.dataTransfer.effectAllowed;if(t==="move"||t==="linkMove"){e.dataTransfer.dropEffect="move"}else{e.dataTransfer.dropEffect="copy"}e.stopPropagation();e.preventDefault()});t.attach(i,"dragenter",function(e){if(!u()){if(!l(e)){return}n.onEnter(e)}});t.attach(i,"dragleave",function(e){if(!l(e)){return}n.onLeave(e);var t=document.elementFromPoint(e.clientX,e.clientY);if(qq(this).contains(t)){return}n.onLeaveNotDescendants(e)});t.attach(i,"drop",function(e){if(!u()){if(!l(e)){return}e.preventDefault();e.stopPropagation();n.onDrop(e);c()}})}a();d();qq.extend(this,{dropDisabled:function(e){return u(e)},dispose:function(){t.dispose()},getElement:function(){return i}})};(function(){"use strict";qq.uiPublicApi={addInitialFiles:function(e){this._parent.prototype.addInitialFiles.apply(this,arguments);this._templating.addCacheToDom()},clearStoredFiles:function(){this._parent.prototype.clearStoredFiles.apply(this,arguments);this._templating.clearFiles()},addExtraDropzone:function(e){this._dnd&&this._dnd.setupExtraDropzone(e)},removeExtraDropzone:function(e){if(this._dnd){return this._dnd.removeDropzone(e)}},getItemByFileId:function(e){if(!this._templating.isHiddenForever(e)){return this._templating.getFileContainer(e)}},reset:function(){this._parent.prototype.reset.apply(this,arguments);this._templating.reset();if(!this._options.button&&this._templating.getButton()){this._defaultButtonId=this._createUploadButton({element:this._templating.getButton(),title:this._options.text.fileInputTitle}).getButtonId()}if(this._dnd){this._dnd.dispose();this._dnd=this._setupDragAndDrop()}this._totalFilesInBatch=0;this._filesInBatchAddedToUi=0;this._setupClickAndEditEventHandlers()},setName:function(e,t){var n=this._options.formatFileName(t);this._parent.prototype.setName.apply(this,arguments);this._templating.updateFilename(e,n)},pauseUpload:function(e){var t=this._parent.prototype.pauseUpload.apply(this,arguments);t&&this._templating.uploadPaused(e);return t},continueUpload:function(e){var t=this._parent.prototype.continueUpload.apply(this,arguments);t&&this._templating.uploadContinued(e);return t},getId:function(e){return this._templating.getFileId(e)},getDropTarget:function(e){var t=this.getFile(e);return t.qqDropTarget}};qq.uiPrivateApi={_getButton:function(e){var t=this._parent.prototype._getButton.apply(this,arguments);if(!t){if(e===this._defaultButtonId){t=this._templating.getButton()}}return t},_removeFileItem:function(e){this._templating.removeFile(e)},_setupClickAndEditEventHandlers:function(){this._fileButtonsClickHandler=qq.FileButtonsClickHandler&&this._bindFileButtonsClickEvent();this._focusinEventSupported=!qq.firefox();if(this._isEditFilenameEnabled()){this._filenameClickHandler=this._bindFilenameClickEvent();this._filenameInputFocusInHandler=this._bindFilenameInputFocusInEvent();this._filenameInputFocusHandler=this._bindFilenameInputFocusEvent()}},_setupDragAndDrop:function(){var e=this,t=this._options.dragAndDrop.extraDropzones,n=this._templating,i=n.getDropZone();i&&t.push(i);return new qq.DragAndDrop({dropZoneElements:t,allowMultipleItems:this._options.multiple,classes:{dropActive:this._options.classes.dropActive},callbacks:{processingDroppedFiles:function(){n.showDropProcessing()},processingDroppedFilesComplete:function(t,i){n.hideDropProcessing();qq.each(t,function(e,t){t.qqDropTarget=i});if(t.length){e.addFiles(t,null,null)}},dropError:function(t,n){e._itemError(t,n)},dropLog:function(t,n){e.log(t,n)}}})},_bindFileButtonsClickEvent:function(){var e=this;return new qq.FileButtonsClickHandler({templating:this._templating,log:function(t,n){e.log(t,n)},onDeleteFile:function(t){e.deleteFile(t)},onCancel:function(t){e.cancel(t)},onRetry:function(t){e.retry(t)},onPause:function(t){e.pauseUpload(t)},onContinue:function(t){e.continueUpload(t)},onGetName:function(t){return e.getName(t)}})},_isEditFilenameEnabled:function(){return this._templating.isEditFilenamePossible()&&!this._options.autoUpload&&qq.FilenameClickHandler&&qq.FilenameInputFocusHandler&&qq.FilenameInputFocusHandler},_filenameEditHandler:function(){var e=this,t=this._templating;return{templating:t,log:function(t,n){e.log(t,n)},onGetUploadStatus:function(t){return e.getUploads({id:t}).status},onGetName:function(t){return e.getName(t)},onSetName:function(t,n){e.setName(t,n)},onEditingStatusChange:function(e,n){var i=qq(t.getEditInput(e)),r=qq(t.getFileContainer(e));if(n){i.addClass("qq-editing");t.hideFilename(e);t.hideEditIcon(e)}else{i.removeClass("qq-editing");t.showFilename(e);t.showEditIcon(e)}r.addClass("qq-temp").removeClass("qq-temp")}}},_onUploadStatusChange:function(e,t,n){this._parent.prototype._onUploadStatusChange.apply(this,arguments);if(this._isEditFilenameEnabled()){if(this._templating.getFileContainer(e)&&n!==qq.status.SUBMITTED){this._templating.markFilenameEditable(e);this._templating.hideEditIcon(e)}}if(t===qq.status.UPLOAD_RETRYING&&n===qq.status.UPLOADING){this._templating.hideRetry(e);this._templating.setStatusText(e);qq(this._templating.getFileContainer(e)).removeClass(this._classes.retrying)}else if(n===qq.status.UPLOAD_FAILED){this._templating.hidePause(e)}},_bindFilenameInputFocusInEvent:function(){var e=qq.extend({},this._filenameEditHandler());return new qq.FilenameInputFocusInHandler(e)},_bindFilenameInputFocusEvent:function(){var e=qq.extend({},this._filenameEditHandler());return new qq.FilenameInputFocusHandler(e)},_bindFilenameClickEvent:function(){var e=qq.extend({},this._filenameEditHandler());return new qq.FilenameClickHandler(e)},_storeForLater:function(e){this._parent.prototype._storeForLater.apply(this,arguments);this._templating.hideSpinner(e)},_onAllComplete:function(e,t){this._parent.prototype._onAllComplete.apply(this,arguments);this._templating.resetTotalProgress()},_onSubmit:function(e,t){var n=this.getFile(e);if(n&&n.qqPath&&this._options.dragAndDrop.reportDirectoryPaths){this._paramsStore.addReadOnly(e,{qqpath:n.qqPath})}this._parent.prototype._onSubmit.apply(this,arguments);this._addToList(e,t)},_onSubmitted:function(e){if(this._isEditFilenameEnabled()){this._templating.markFilenameEditable(e);this._templating.showEditIcon(e);if(!this._focusinEventSupported){this._filenameInputFocusHandler.addHandler(this._templating.getEditInput(e))}}},_onProgress:function(e,t,n,i){this._parent.prototype._onProgress.apply(this,arguments);this._templating.updateProgress(e,n,i);if(i===0||Math.round(n/i*100)===100){this._templating.hideCancel(e);this._templating.hidePause(e);this._templating.hideProgress(e);this._templating.setStatusText(e,this._options.text.waitingForResponse);this._displayFileSize(e)}else{this._displayFileSize(e,n,i)}},_onTotalProgress:function(e,t){this._parent.prototype._onTotalProgress.apply(this,arguments);this._templating.updateTotalProgress(e,t)},_onComplete:function(e,t,n,i){var r=this._parent.prototype._onComplete.apply(this,arguments),o=this._templating,s=o.getFileContainer(e),a=this;function l(t){if(!s){return}o.setStatusText(e);qq(s).removeClass(a._classes.retrying);o.hideProgress(e);if(a.getUploads({id:e}).status!==qq.status.UPLOAD_FAILED){o.hideCancel(e)}o.hideSpinner(e);if(t.success){a._markFileAsSuccessful(e)}else{qq(s).addClass(a._classes.fail);o.showCancel(e);if(o.isRetryPossible()&&!a._preventRetries[e]){qq(s).addClass(a._classes.retryable);o.showRetry(e)}a._controlFailureTextDisplay(e,t)}}if(r instanceof qq.Promise){r.done(function(e){l(e)})}else{l(n)}return r},_markFileAsSuccessful:function(e){var t=this._templating;if(this._isDeletePossible()){t.showDeleteButton(e)}qq(t.getFileContainer(e)).addClass(this._classes.success);this._maybeUpdateThumbnail(e)},_onUploadPrep:function(e){this._parent.prototype._onUploadPrep.apply(this,arguments);this._templating.showSpinner(e)},_onUpload:function(e,t){var n=this._parent.prototype._onUpload.apply(this,arguments);this._templating.showSpinner(e);return n},_onUploadChunk:function(e,t){this._parent.prototype._onUploadChunk.apply(this,arguments);if(t.partIndex>0&&this._handler.isResumable(e)){this._templating.allowPause(e)}},_onCancel:function(e,t){this._parent.prototype._onCancel.apply(this,arguments);this._removeFileItem(e);if(this._getNotFinished()===0){this._templating.resetTotalProgress()}},_onBeforeAutoRetry:function(e){var t,n,i;this._parent.prototype._onBeforeAutoRetry.apply(this,arguments);this._showCancelLink(e);if(this._options.retry.showAutoRetryNote){t=this._autoRetries[e];n=this._options.retry.maxAutoAttempts;i=this._options.retry.autoRetryNote.replace(/\{retryNum\}/g,t);i=i.replace(/\{maxAuto\}/g,n);this._templating.setStatusText(e,i);qq(this._templating.getFileContainer(e)).addClass(this._classes.retrying)}},_onBeforeManualRetry:function(e){if(this._parent.prototype._onBeforeManualRetry.apply(this,arguments)){this._templating.resetProgress(e);qq(this._templating.getFileContainer(e)).removeClass(this._classes.fail);this._templating.setStatusText(e);this._templating.showSpinner(e);this._showCancelLink(e);return true}else{qq(this._templating.getFileContainer(e)).addClass(this._classes.retryable);this._templating.showRetry(e);return false}},_onSubmitDelete:function(e){var t=qq.bind(this._onSubmitDeleteSuccess,this);this._parent.prototype._onSubmitDelete.call(this,e,t)},_onSubmitDeleteSuccess:function(e,t,n){if(this._options.deleteFile.forceConfirm){this._showDeleteConfirm.apply(this,arguments)}else{this._sendDeleteRequest.apply(this,arguments)}},_onDeleteComplete:function(e,t,n){this._parent.prototype._onDeleteComplete.apply(this,arguments);this._templating.hideSpinner(e);if(n){this._templating.setStatusText(e,this._options.deleteFile.deletingFailedText);this._templating.showDeleteButton(e)}else{this._removeFileItem(e)}},_sendDeleteRequest:function(e,t,n){this._templating.hideDeleteButton(e);this._templating.showSpinner(e);this._templating.setStatusText(e,this._options.deleteFile.deletingStatusText);this._deleteHandler.sendDelete.apply(this,arguments)},_showDeleteConfirm:function(e,t,n){var i=this.getName(e),r=this._options.deleteFile.confirmMessage.replace(/\{filename\}/g,i),t=this.getUuid(e),o=arguments,s=this,a;a=this._options.showConfirm(r);if(qq.isGenericPromise(a)){a.then(function(){s._sendDeleteRequest.apply(s,o)})}else if(a!==false){s._sendDeleteRequest.apply(s,o)}},_addToList:function(e,t,n){var i,r=0,o=this._handler.isProxied(e)&&this._options.scaling.hideScaled,s;if(this._options.display.prependFiles){if(this._totalFilesInBatch>1&&this._filesInBatchAddedToUi>0){r=this._filesInBatchAddedToUi-1}i={index:r}}if(!n){if(this._options.disableCancelForFormUploads&&!qq.supportedFeatures.ajaxUploading){this._templating.disableCancel()}if(!this._options.multiple){s=this.getUploads({id:e});this._handledProxyGroup=this._handledProxyGroup||s.proxyGroupId;if(s.proxyGroupId!==this._handledProxyGroup||!s.proxyGroupId){this._handler.cancelAll();this._clearList();this._handledProxyGroup=null}}}if(n){this._templating.addFileToCache(e,this._options.formatFileName(t),i,o);this._templating.updateThumbnail(e,this._thumbnailUrls[e],true,this._options.thumbnails.customResizer)}else{this._templating.addFile(e,this._options.formatFileName(t),i,o);this._templating.generatePreview(e,this.getFile(e),this._options.thumbnails.customResizer)}this._filesInBatchAddedToUi+=1;if(n||this._options.display.fileSizeOnSubmit&&qq.supportedFeatures.ajaxUploading){this._displayFileSize(e)}},_clearList:function(){this._templating.clearFiles();this.clearStoredFiles()},_displayFileSize:function(e,t,n){var i=this.getSize(e),r=this._formatSize(i);if(i>=0){if(t!==undefined&&n!==undefined){r=this._formatProgress(t,n)}this._templating.updateSize(e,r)}},_formatProgress:function(e,t){var n=this._options.text.formatProgress;function i(e,t){n=n.replace(e,t)}i("{percent}",Math.round(e/t*100));i("{total_size}",this._formatSize(t));return n},_controlFailureTextDisplay:function(e,t){var n,i,r;n=this._options.failedUploadTextDisplay.mode;i=this._options.failedUploadTextDisplay.responseProperty;if(n==="custom"){r=t[i];if(!r){r=this._options.text.failUpload}this._templating.setStatusText(e,r);if(this._options.failedUploadTextDisplay.enableTooltip){this._showTooltip(e,r)}}else if(n==="default"){this._templating.setStatusText(e,this._options.text.failUpload)}else if(n!=="none"){this.log("failedUploadTextDisplay.mode value of '"+n+"' is not valid","warn")}},_showTooltip:function(e,t){this._templating.getFileContainer(e).title=t},_showCancelLink:function(e){if(!this._options.disableCancelForFormUploads||qq.supportedFeatures.ajaxUploading){this._templating.showCancel(e)}},_itemError:function(e,t,n){var i=this._parent.prototype._itemError.apply(this,arguments);this._options.showMessage(i)},_batchError:function(e){this._parent.prototype._batchError.apply(this,arguments);this._options.showMessage(e)},_setupPastePrompt:function(){var e=this;this._options.callbacks.onPasteReceived=function(){var t=e._options.paste.namePromptMessage,n=e._options.paste.defaultName;return e._options.showPrompt(t,n)}},_fileOrBlobRejected:function(e,t){this._totalFilesInBatch-=1;this._parent.prototype._fileOrBlobRejected.apply(this,arguments)},_prepareItemsForUpload:function(e,t,n){this._totalFilesInBatch=e.length;this._filesInBatchAddedToUi=0;this._parent.prototype._prepareItemsForUpload.apply(this,arguments)},_maybeUpdateThumbnail:function(e){var t=this._thumbnailUrls[e],n=this.getUploads({id:e}).status;if(n!==qq.status.DELETED&&(t||this._options.thumbnails.placeholders.waitUntilResponse||!qq.supportedFeatures.imagePreviews)){this._templating.updateThumbnail(e,t,this._options.thumbnails.customResizer)}},_addCannedFile:function(e){var t=this._parent.prototype._addCannedFile.apply(this,arguments);this._addToList(t,this.getName(t),true);this._templating.hideSpinner(t);this._templating.hideCancel(t);this._markFileAsSuccessful(t);return t},_setSize:function(e,t){this._parent.prototype._setSize.apply(this,arguments);this._templating.updateSize(e,this._formatSize(t))},_sessionRequestComplete:function(){this._templating.addCacheToDom();this._parent.prototype._sessionRequestComplete.apply(this,arguments)}}})();qq.FineUploader=function(e,t){"use strict";var n=this;this._parent=t?qq[t].FineUploaderBasic:qq.FineUploaderBasic;this._parent.apply(this,arguments);qq.extend(this._options,{element:null,button:null,listElement:null,dragAndDrop:{extraDropzones:[],reportDirectoryPaths:false},text:{formatProgress:"{percent}% of {total_size}",failUpload:"Upload failed",waitingForResponse:"Processing...",paused:"Paused"},template:"qq-template",classes:{retrying:"qq-upload-retrying",retryable:"qq-upload-retryable",success:"qq-upload-success",fail:"qq-upload-fail",editable:"qq-editable",hide:"qq-hide",dropActive:"qq-upload-drop-area-active"},failedUploadTextDisplay:{mode:"default",responseProperty:"error",enableTooltip:true},messages:{tooManyFilesError:"You may only drop one file",unsupportedBrowser:"Unrecoverable error - this browser does not permit file uploading of any kind."},retry:{showAutoRetryNote:true,autoRetryNote:"Retrying {retryNum}/{maxAuto}..."},deleteFile:{forceConfirm:false,confirmMessage:"Are you sure you want to delete {filename}?",deletingStatusText:"Deleting...",deletingFailedText:"Delete failed"},display:{fileSizeOnSubmit:false,prependFiles:false},paste:{promptForName:false,namePromptMessage:"Please name this image"},thumbnails:{customResizer:null,maxCount:0,placeholders:{waitUntilResponse:false,notAvailablePath:null,waitingPath:null},timeBetweenThumbs:750},scaling:{hideScaled:false},showMessage:function(e){if(n._templating.hasDialog("alert")){return n._templating.showDialog("alert",e)}else{setTimeout(function(){window.alert(e)},0)}},showConfirm:function(e){if(n._templating.hasDialog("confirm")){return n._templating.showDialog("confirm",e)}else{return window.confirm(e)}},showPrompt:function(e,t){if(n._templating.hasDialog("prompt")){return n._templating.showDialog("prompt",e,t)}else{return window.prompt(e,t)}}},true);qq.extend(this._options,e,true);this._templating=new qq.Templating({log:qq.bind(this.log,this),templateIdOrEl:this._options.template,containerEl:this._options.element,fileContainerEl:this._options.listElement,button:this._options.button,imageGenerator:this._imageGenerator,classes:{hide:this._options.classes.hide,editable:this._options.classes.editable},limits:{maxThumbs:this._options.thumbnails.maxCount,timeBetweenThumbs:this._options.thumbnails.timeBetweenThumbs},placeholders:{waitUntilUpdate:this._options.thumbnails.placeholders.waitUntilResponse,thumbnailNotAvailable:this._options.thumbnails.placeholders.notAvailablePath,waitingForThumbnail:this._options.thumbnails.placeholders.waitingPath},text:this._options.text});if(this._options.workarounds.ios8SafariUploads&&qq.ios800()&&qq.iosSafari()){this._templating.renderFailure(this._options.messages.unsupportedBrowserIos8Safari)}else if(!qq.supportedFeatures.uploading||this._options.cors.expected&&!qq.supportedFeatures.uploadCors){this._templating.renderFailure(this._options.messages.unsupportedBrowser)}else{this._wrapCallbacks();this._templating.render();this._classes=this._options.classes;if(!this._options.button&&this._templating.getButton()){this._defaultButtonId=this._createUploadButton({element:this._templating.getButton(),title:this._options.text.fileInputTitle}).getButtonId()}this._setupClickAndEditEventHandlers();if(qq.DragAndDrop&&qq.supportedFeatures.fileDrop){this._dnd=this._setupDragAndDrop()}if(this._options.paste.targetElement&&this._options.paste.promptForName){if(qq.PasteSupport){this._setupPastePrompt()}else{this.log("Paste support module not found.","error")}}this._totalFilesInBatch=0;this._filesInBatchAddedToUi=0}};qq.extend(qq.FineUploader.prototype,qq.basePublicApi);qq.extend(qq.FineUploader.prototype,qq.basePrivateApi);qq.extend(qq.FineUploader.prototype,qq.uiPublicApi);qq.extend(qq.FineUploader.prototype,qq.uiPrivateApi);qq.Templating=function(e){"use strict";var t="qq-file-id",n="qq-file-id-",i="qq-max-size",r="qq-server-scale",o="qq-hide-dropzone",s="qq-drop-area-text",a="qq-in-progress",l="qq-hidden-forever",u={content:document.createDocumentFragment(),map:{}},c=false,d=0,f=false,p=[],h=-1,q={log:null,limits:{maxThumbs:0,timeBetweenThumbs:750},templateIdOrEl:"qq-template",containerEl:null,fileContainerEl:null,button:null,imageGenerator:null,classes:{hide:"qq-hide",editable:"qq-editable"},placeholders:{waitUntilUpdate:false,thumbnailNotAvailable:null,waitingForThumbnail:null},text:{paused:"Paused"}},g={button:"qq-upload-button-selector",alertDialog:"qq-alert-dialog-selector",dialogCancelButton:"qq-cancel-button-selector",confirmDialog:"qq-confirm-dialog-selector",dialogMessage:"qq-dialog-message-selector",dialogOkButton:"qq-ok-button-selector",promptDialog:"qq-prompt-dialog-selector",uploader:"qq-uploader-selector",drop:"qq-upload-drop-area-selector",list:"qq-upload-list-selector",progressBarContainer:"qq-progress-bar-container-selector",progressBar:"qq-progress-bar-selector",totalProgressBarContainer:"qq-total-progress-bar-container-selector",totalProgressBar:"qq-total-progress-bar-selector",file:"qq-upload-file-selector",spinner:"qq-upload-spinner-selector",size:"qq-upload-size-selector",cancel:"qq-upload-cancel-selector",pause:"qq-upload-pause-selector",continueButton:"qq-upload-continue-selector",deleteButton:"qq-upload-delete-selector",retry:"qq-upload-retry-selector",statusText:"qq-upload-status-text-selector",editFilenameInput:"qq-edit-filename-selector",editNameIcon:"qq-edit-filename-icon-selector",dropText:"qq-upload-drop-area-text-selector",dropProcessing:"qq-drop-processing-selector",dropProcessingSpinner:"qq-drop-processing-spinner-selector",thumbnail:"qq-thumbnail-selector"},m={},_=new qq.Promise,v=new qq.Promise,b,y,S,w,C,E,x,F,P=function(){var e=q.placeholders.thumbnailNotAvailable,t=q.placeholders.waitingForThumbnail,n={maxSize:h,scale:F};if(x){if(e){q.imageGenerator.generate(e,new Image,n).then(function(e){_.success(e)},function(){_.failure();b("Problem loading 'not available' placeholder image at "+e,"error")})}else{_.failure()}if(t){q.imageGenerator.generate(t,new Image,n).then(function(e){v.success(e)},function(){v.failure();b("Problem loading 'waiting for thumbnail' placeholder image at "+t,"error")})}else{v.failure()}}},T=function(e){var t=new qq.Promise;v.then(function(n){K(n,e);if(!e.src){e.src=n.src;e.onload=function(){e.onload=null;te(e);t.success()}}else{t.success()}},function(){G(e);t.success()});return t},A=function(e,t,n){var i=W(e);b("Generating new thumbnail for "+e);t.qqThumbnailId=e;return q.imageGenerator.generate(t,i,n).then(function(){d++;te(i);m[e].success()},function(){m[e].failure();if(!q.placeholders.waitUntilUpdate){X(e,i)}})},U=function(){if(p.length){f=true;var e=p.shift();if(e.update){Z(e)}else{Q(e)}}else{f=false}},I=function(e){return V(N(e),g.cancel)},D=function(e){return V(N(e),g.continueButton)},R=function(e){return V(C,g[e+"Dialog"])},k=function(e){return V(N(e),g.deleteButton)},M=function(){return V(C,g.dropProcessing)},B=function(e){return V(N(e),g.editNameIcon)},N=function(e){return u.map[e]||qq(E).getFirstByClass(n+e)},O=function(e){return V(N(e),g.file)},H=function(e){return V(N(e),g.pause)},L=function(e){if(e==null){return V(C,g.totalProgressBarContainer)||V(C,g.totalProgressBar)}return V(N(e),g.progressBarContainer)||V(N(e),g.progressBar)},z=function(e){return V(N(e),g.retry)},j=function(e){return V(N(e),g.size)},$=function(e){return V(N(e),g.spinner)},V=function(e,t){return e&&qq(e).getFirstByClass(t)},W=function(e){return x&&V(N(e),g.thumbnail)},G=function(e){e&&qq(e).addClass(q.classes.hide)},K=function(e,t){var n=e.style.maxWidth,i=e.style.maxHeight;if(i&&n&&!t.style.maxWidth&&!t.style.maxHeight){qq(t).css({maxWidth:n,maxHeight:i})}},X=function(e,t){var n=m[e]||(new qq.Promise).failure(),i=new qq.Promise;_.then(function(e){n.then(function(){i.success()},function(){K(e,t);t.onload=function(){t.onload=null;i.success()};t.src=e.src;te(t)})});return i},Y=function(){var e,t,n,a,l,u,c,d,f,p,m;b("Parsing template");if(q.templateIdOrEl==null){throw new Error("You MUST specify either a template element or ID!")}if(qq.isString(q.templateIdOrEl)){e=document.getElementById(q.templateIdOrEl);if(e===null){throw new Error(qq.format("Cannot find template script at ID '{}'!",q.templateIdOrEl))}t=e.innerHTML}else{if(q.templateIdOrEl.innerHTML===undefined){throw new Error("You have specified an invalid value for the template option!  "+"It must be an ID or an Element.")}t=q.templateIdOrEl.innerHTML}t=qq.trimStr(t);a=document.createElement("div");a.appendChild(qq.toElement(t));m=qq(a).getFirstByClass(g.uploader);if(q.button){u=qq(a).getFirstByClass(g.button);if(u){qq(u).remove()}}if(!qq.DragAndDrop||!qq.supportedFeatures.fileDrop){f=qq(a).getFirstByClass(g.dropProcessing);if(f){qq(f).remove()}}c=qq(a).getFirstByClass(g.drop);if(c&&!qq.DragAndDrop){b("DnD module unavailable.","info");qq(c).remove()}if(!qq.supportedFeatures.fileDrop){m.removeAttribute(s);if(c&&qq(c).hasAttribute(o)){qq(c).css({display:"none"})}}else if(qq(m).hasAttribute(s)&&c){p=qq(c).getFirstByClass(g.dropText);p&&qq(p).remove()}d=qq(a).getFirstByClass(g.thumbnail);if(!x){d&&qq(d).remove()}else if(d){h=parseInt(d.getAttribute(i));h=h>0?h:null;F=qq(d).hasAttribute(r)}x=x&&d;y=qq(a).getByClass(g.editFilenameInput).length>0;S=qq(a).getByClass(g.retry).length>0;n=qq(a).getFirstByClass(g.list);if(n==null){throw new Error("Could not find the file list container in the template!")}l=n.innerHTML;n.innerHTML="";if(a.getElementsByTagName("DIALOG").length){document.createElement("dialog")}b("Template parsing complete");return{template:qq.trimStr(a.innerHTML),fileTemplate:qq.trimStr(l)}},J=function(e,t,n){var i=n,r=i.firstChild;if(t>0){r=qq(i).children()[t].nextSibling}i.insertBefore(e,r)},Q=function(e){var t=e.id,n=e.optFileOrBlob,i=n&&n.qqThumbnailId,r=W(t),o={customResizeFunction:e.customResizeFunction,maxSize:h,orient:true,scale:true};if(qq.supportedFeatures.imagePreviews){if(r){if(q.limits.maxThumbs&&q.limits.maxThumbs<=d){X(t,r);U()}else{T(r).done(function(){m[t]=new qq.Promise;m[t].done(function(){setTimeout(U,q.limits.timeBetweenThumbs)});if(i!=null){ne(t,i)}else{A(t,n,o)}})}}else{U()}}else if(r){T(r);U()}},Z=function(e){var t=e.id,n=e.thumbnailUrl,i=e.showWaitingImg,r=W(t),o={customResizeFunction:e.customResizeFunction,scale:F,maxSize:h};if(r){if(n){if(q.limits.maxThumbs&&q.limits.maxThumbs<=d){X(t,r);U()}else{if(i){T(r)}return q.imageGenerator.generate(n,r,o).then(function(){te(r);d++;setTimeout(U,q.limits.timeBetweenThumbs)},function(){X(t,r);setTimeout(U,q.limits.timeBetweenThumbs)})}}else{X(t,r);U()}}},ee=function(e,t){var n=L(e),i=e==null?g.totalProgressBar:g.progressBar;if(n&&!qq(n).hasClass(i)){n=qq(n).getFirstByClass(i)}if(n){qq(n).css({width:t+"%"});n.setAttribute("aria-valuenow",t)}},te=function(e){e&&qq(e).removeClass(q.classes.hide)},ne=function(e,t){var n=W(e),i=W(t);b(qq.format("ID {} is the same file as ID {}.  Will use generated thumbnail from ID {} instead.",e,t,t));m[t].then(function(){d++;m[e].success();b(qq.format("Now using previously generated thumbnail created for ID {} on ID {}.",t,e));n.src=i.src;te(n)},function(){m[e].failure();if(!q.placeholders.waitUntilUpdate){X(e,n)}})};qq.extend(q,e);b=q.log;if(!qq.supportedFeatures.imagePreviews){q.limits.timeBetweenThumbs=0;q.limits.maxThumbs=0}C=q.containerEl;x=q.imageGenerator!==undefined;w=Y();P();qq.extend(this,{render:function(){b("Rendering template in DOM.");d=0;C.innerHTML=w.template;G(M());this.hideTotalProgress();E=q.fileContainerEl||V(C,g.list);b("Template rendering complete")},renderFailure:function(e){var t=qq.toElement(e);C.innerHTML="";C.appendChild(t)},reset:function(){this.render()},clearFiles:function(){E.innerHTML=""},disableCancel:function(){c=true},addFile:function(e,i,r,o,a){var d=qq.toElement(w.fileTemplate),f=V(d,g.file),p=V(C,g.uploader),h=a?u.content:E,q;if(a){u.map[e]=d}qq(d).addClass(n+e);p.removeAttribute(s);if(f){qq(f).setText(i);f.setAttribute("title",i)}d.setAttribute(t,e);if(r){J(d,r.index,h)}else{h.appendChild(d)}if(o){d.style.display="none";qq(d).addClass(l)}else{G(L(e));G(j(e));G(k(e));G(z(e));G(H(e));G(D(e));if(c){this.hideCancel(e)}q=W(e);if(q&&!q.src){v.then(function(e){q.src=e.src;if(e.style.maxHeight&&e.style.maxWidth){qq(q).css({maxHeight:e.style.maxHeight,maxWidth:e.style.maxWidth})}te(q)})}}},addFileToCache:function(e,t,n,i){this.addFile(e,t,n,i,true)},addCacheToDom:function(){E.appendChild(u.content);u.content=document.createDocumentFragment();u.map={}},removeFile:function(e){qq(N(e)).remove()},getFileId:function(e){var n=e;if(n){while(n.getAttribute(t)==null){n=n.parentNode}return parseInt(n.getAttribute(t))}},getFileList:function(){return E},markFilenameEditable:function(e){var t=O(e);t&&qq(t).addClass(q.classes.editable)},updateFilename:function(e,t){var n=O(e);if(n){qq(n).setText(t);n.setAttribute("title",t)}},hideFilename:function(e){G(O(e))},showFilename:function(e){te(O(e))},isFileName:function(e){return qq(e).hasClass(g.file)},getButton:function(){return q.button||V(C,g.button)},hideDropProcessing:function(){G(M())},showDropProcessing:function(){te(M())},getDropZone:function(){return V(C,g.drop)},isEditFilenamePossible:function(){return y},hideRetry:function(e){G(z(e))},isRetryPossible:function(){return S},showRetry:function(e){te(z(e))},getFileContainer:function(e){return N(e)},showEditIcon:function(e){var t=B(e);t&&qq(t).addClass(q.classes.editable)},isHiddenForever:function(e){return qq(N(e)).hasClass(l)},hideEditIcon:function(e){var t=B(e);t&&qq(t).removeClass(q.classes.editable)},isEditIcon:function(e){return qq(e).hasClass(g.editNameIcon,true)},getEditInput:function(e){return V(N(e),g.editFilenameInput)},isEditInput:function(e){return qq(e).hasClass(g.editFilenameInput,true)},updateProgress:function(e,t,n){var i=L(e),r;if(i&&n>0){r=Math.round(t/n*100);if(r===100){G(i)}else{te(i)}ee(e,r)}},updateTotalProgress:function(e,t){this.updateProgress(null,e,t)},hideProgress:function(e){var t=L(e);t&&G(t)},hideTotalProgress:function(){this.hideProgress()},resetProgress:function(e){ee(e,0);this.hideTotalProgress(e)},resetTotalProgress:function(){this.resetProgress()},showCancel:function(e){if(!c){var t=I(e);t&&qq(t).removeClass(q.classes.hide)}},hideCancel:function(e){G(I(e))},isCancel:function(e){return qq(e).hasClass(g.cancel,true)},allowPause:function(e){te(H(e));G(D(e))},uploadPaused:function(e){this.setStatusText(e,q.text.paused);this.allowContinueButton(e);G($(e))},hidePause:function(e){G(H(e))},isPause:function(e){return qq(e).hasClass(g.pause,true)},isContinueButton:function(e){return qq(e).hasClass(g.continueButton,true)},allowContinueButton:function(e){te(D(e));G(H(e))},uploadContinued:function(e){this.setStatusText(e,"");this.allowPause(e);te($(e))},showDeleteButton:function(e){te(k(e))},hideDeleteButton:function(e){G(k(e))},isDeleteButton:function(e){return qq(e).hasClass(g.deleteButton,true)},isRetry:function(e){return qq(e).hasClass(g.retry,true)},updateSize:function(e,t){var n=j(e);if(n){te(n);qq(n).setText(t)}},setStatusText:function(e,t){var n=V(N(e),g.statusText);if(n){if(t==null){qq(n).clearText()}else{qq(n).setText(t)}}},hideSpinner:function(e){qq(N(e)).removeClass(a);G($(e))},showSpinner:function(e){qq(N(e)).addClass(a);te($(e))},generatePreview:function(e,t,n){if(!this.isHiddenForever(e)){p.push({id:e,customResizeFunction:n,optFileOrBlob:t});!f&&U()}},updateThumbnail:function(e,t,n,i){if(!this.isHiddenForever(e)){p.push({customResizeFunction:i,update:true,id:e,thumbnailUrl:t,showWaitingImg:n});!f&&U()}},hasDialog:function(e){return qq.supportedFeatures.dialogElement&&!!R(e)},showDialog:function(e,t,n){var i=R(e),r=V(i,g.dialogMessage),o=i.getElementsByTagName("INPUT")[0],s=V(i,g.dialogCancelButton),a=V(i,g.dialogOkButton),l=new qq.Promise,u=function(){s.removeEventListener("click",c);a&&a.removeEventListener("click",d);l.failure()},c=function(){s.removeEventListener("click",c);i.close()},d=function(){i.removeEventListener("close",u);a.removeEventListener("click",d);i.close();l.success(o&&o.value)};i.addEventListener("close",u);s.addEventListener("click",c);a&&a.addEventListener("click",d);if(o){o.value=n}r.textContent=t;i.showModal();return l}})};qq.UiEventHandler=function(e,t){"use strict";var n=new qq.DisposeSupport,i={eventType:"click",attachTo:null,onHandled:function(e,t){}};qq.extend(this,{addHandler:function(e){r(e)},dispose:function(){n.dispose()}});function r(e){n.attach(e,i.eventType,function(e){e=e||window.event;var t=e.target||e.srcElement;i.onHandled(t,e)})}qq.extend(t,{getFileIdFromItem:function(e){return e.qqFileId},getDisposeSupport:function(){return n}});qq.extend(i,e);if(i.attachTo){r(i.attachTo)}};qq.FileButtonsClickHandler=function(e){"use strict";var t={},n={templating:null,log:function(e,t){},onDeleteFile:function(e){},onCancel:function(e){},onRetry:function(e){},onPause:function(e){},onContinue:function(e){},onGetName:function(e){}},i={cancel:function(e){n.onCancel(e)},retry:function(e){n.onRetry(e)},deleteButton:function(e){n.onDeleteFile(e)},pause:function(e){n.onPause(e)},continueButton:function(e){n.onContinue(e)}};function r(e,t){qq.each(i,function(i,r){var o=i.charAt(0).toUpperCase()+i.slice(1),s;if(n.templating["is"+o](e)){s=n.templating.getFileId(e);qq.preventDefault(t);n.log(qq.format("Detected valid file button click event on file '{}', ID: {}.",n.onGetName(s),s));r(s);return false}})}qq.extend(n,e);n.eventType="click";n.onHandled=r;n.attachTo=n.templating.getFileList();qq.extend(this,new qq.UiEventHandler(n,t))};qq.FilenameClickHandler=function(e){"use strict";var t={},n={templating:null,log:function(e,t){},classes:{file:"qq-upload-file",editNameIcon:"qq-edit-filename-icon"},onGetUploadStatus:function(e){},onGetName:function(e){}};qq.extend(n,e);function i(e,i){if(n.templating.isFileName(e)||n.templating.isEditIcon(e)){var r=n.templating.getFileId(e),o=n.onGetUploadStatus(r);if(o===qq.status.SUBMITTED){n.log(qq.format("Detected valid filename click event on file '{}', ID: {}.",n.onGetName(r),r));qq.preventDefault(i);t.handleFilenameEdit(r,e,true)}}}n.eventType="click";n.onHandled=i;qq.extend(this,new qq.FilenameEditHandler(n,t))};qq.FilenameInputFocusInHandler=function(e,t){"use strict";var n={templating:null,onGetUploadStatus:function(e){},log:function(e,t){}};if(!t){t={}}function i(e,i){if(n.templating.isEditInput(e)){var r=n.templating.getFileId(e),o=n.onGetUploadStatus(r);if(o===qq.status.SUBMITTED){n.log(qq.format("Detected valid filename input focus event on file '{}', ID: {}.",n.onGetName(r),r));t.handleFilenameEdit(r,e)}}}n.eventType="focusin";n.onHandled=i;qq.extend(n,e);qq.extend(this,new qq.FilenameEditHandler(n,t))};qq.FilenameInputFocusHandler=function(e){"use strict";e.eventType="focus";e.attachTo=null;qq.extend(this,new qq.FilenameInputFocusInHandler(e,{}))};qq.FilenameEditHandler=function(e,t){"use strict";var n={templating:null,log:function(e,t){},onGetUploadStatus:function(e){},onGetName:function(e){},onSetName:function(e,t){},onEditingStatusChange:function(e,t){}};function i(e){var t=n.onGetName(e),i=t.lastIndexOf(".");if(i>0){t=t.substr(0,i)}return t}function r(e){var t=n.onGetName(e);return qq.getExtension(t)}function o(e,t){var i=e.value,o;if(i!==undefined&&qq.trimStr(i).length>0){o=r(t);if(o!==undefined){i=i+"."+o}n.onSetName(t,i)}n.onEditingStatusChange(t,false)}function s(e,n){t.getDisposeSupport().attach(e,"blur",function(){o(e,n)})}function a(e,n){t.getDisposeSupport().attach(e,"keyup",function(t){var i=t.keyCode||t.which;if(i===13){o(e,n)}})}qq.extend(n,e);n.attachTo=n.templating.getFileList();qq.extend(this,new qq.UiEventHandler(n,t));qq.extend(t,{handleFilenameEdit:function(e,t,r){var o=n.templating.getEditInput(e);n.onEditingStatusChange(e,true);o.value=i(e);if(r){o.focus()}s(o,e);a(o,e)}})};(function(){"use strict";qq.s3.FineUploader=function(e){var t={failedUploadTextDisplay:{mode:"custom"}};qq.extend(t,e,true);qq.FineUploader.call(this,t,"s3");if(!qq.supportedFeatures.ajaxUploading&&t.iframeSupport.localBlankPagePath===undefined){this._options.element.innerHTML="<div>You MUST set the <code>localBlankPagePath</code> property "+"of the <code>iframeSupport</code> option since this browser does not support the File API!</div>"}};qq.extend(qq.s3.FineUploader.prototype,qq.s3.FineUploaderBasic.prototype);qq.extend(qq.s3.FineUploader.prototype,qq.uiPublicApi);qq.extend(qq.s3.FineUploader.prototype,qq.uiPrivateApi)})()})(window);var SM=window.SM||{};function UploaderException(e){this.message=e;this.name="UserLoaderException"}SM.Uploader=function(e){var t,n={debug:false,template:"uploader",request:{endpoint:"https://sm-assets-mt3.s3.amazonaws.com",accessKey:"AKIAJYLN6ZHWH7RBRY5A"},signature:{endpoint:"/team/uploader/s3/signature/"},uploadSuccess:{endpoint:"/team/uploader/s3/success/"},iframeSupport:{localBlankPagePath:"/team/uploader/iframe-uploader.html"},retry:{enableAuto:false},deleteFile:{enabled:true,endpoint:"/s3handler"},validation:{allowedExtensions:["gif","jpeg","jpg","png"],acceptFiles:"image/gif, image/jpeg, image/png",sizeLimit:1e6,itemLimit:3},objectProperties:{acl:"public-read"},callbacks:{},multiple:false};SM.Global=SM.Global||{};function i(){if(!e.hasOwnProperty("uploader")){throw new UploaderException("Missing configuration value: uploader")}$.extend(n,e.uploader);t=$(e.container).fineUploaderS3(n)}i();return t};SM.FileUploadUtil={getUploader:function(e,t){var n="general";return SM.Uploader({uploader:{multiple:false,messages:t.messages,template:t.template,validation:{allowedExtensions:t.validation.allowedExtensions,itemLimit:t.itemLimit||1,sizeLimit:e[n].size_limit},showMessage:function(e){},keyPath:e.key_path,request:{endpoint:e.s3_url,accessKey:e.public_key},signature:{endpoint:e.s3_signature_path,customHeaders:null,version:e.signature_version},uploadSuccess:{endpoint:e.upload_success_path,customHeaders:null},iframeSupport:{localBlankPagePath:e.iframe_path},retry:{enableAuto:false},objectProperties:{acl:e[n].acl,key:function(e){var t=this.getUploads(),n=t[0],i=t[e].name,r=i.split("."),o=[n.uuid,".",r[r.length-1]];return this._options.keyPath+o.join("")},region:e.region,serverSideEncryption:e.server_side_encryption}},container:t.container})}};SM.SurveyFilesDialogView=SM.Views.deepExtend(SM.DialogView,{__NAME:"surveyFilesDialog",__templateID:"survey-files-dialog-template",__defaults:{isModal:true,width:710},__afterRender:function(){var e,t,n;SM.DialogView.__afterRender.call(this);e=SM.Views.create(SM.FromComputerPanelView,{dialogView:this,uploaderConfig:this.__settings.uploaderConfig,uploadAreaTemplateId:this.__settings.uploadAreaTemplateId,fileTypes:this.__settings.fileTypes,errorMessages:this.__settings.errorMessages}).el;n=$(e).find("ul.type-list");n.text("");for(t=0;t<this.__settings.fileTypes.length;t++){n.append("<li>"+this.__settings.fileTypes[t].toUpperCase()+"</li>")}this.$el.find("section").html(e)},__onBeforeOpen:function(){var e=this;SM.DialogView.__onBeforeOpen.call(e);this.render();this.position();this.$el.on("fileUploaded",function(){e.close()}).on("noFileUploaded",function(){e.close()}).on("fileUploadInProgress",function(){e.$el.parent().hide();if($("body").hasClass("sm-fixed-dialog-modal")){$("body").removeClass("sm-fixed-dialog-modal")}}).on("fileUploadFailed",function(){e.close()}).on("fileUploadError",function(){e.close()})},__onAfterOpen:function(){var e=this.$el.find(".browse-for-file"),t=this.$el.find(".dialog-close-btn"),n=this;SM.DialogView.__onAfterOpen.call(n);t.attr("tabindex",1);t.attr("aria-label","Close File Upload Dialog");e.attr("tabindex",1);e.on("keydown",function(e){if((e.keyCode||e.which)===SM.KeyCodes.TAB){n.$el.find(".dialog-close-btn").focus();n.$el.find(".browse-for-file").removeClass("no-outline");e.preventDefault()}else if(e.keyCode===SM.KeyCodes.ENTER){n.$el.find("input[type=file]").click()}});e.addClass("no-outline").focus()}});SM.FromComputerPanelView=SM.Views.register({__NAME:"fromComputerPanelView",__templateID:"from-computer-panel-template",__init:function(){var e=this,t=this.__settings.uploaderConfig;e.$uploader=SM.FileUploadUtil.getUploader(t,{template:this.__settings.uploadAreaTemplateId,messages:this.__settings.errorMessages,validation:{allowedExtensions:this.__settings.fileTypes},container:e.$el.find("[data-survey-file-uploader]")});e.uploadStartTime=null;e.$uploader.on("error",function(t,n,i,r){s3key=e.$uploader.fineUploader("getKey",n)||"";e.$el.trigger({type:"fileUploadError",uploadStartTime:e.uploadStartTime,errorData:{name:i,s3Key:s3key,message:r}})}).on("complete",{self:e},e._onUploadComplete).on("upload",function(){e.uploadStartTime=new Date;e.$el.trigger({type:"fileUploadInProgress",uploadStartTime:e.uploadStartTime})}).on("cancel",function(){e.$el.trigger({type:"fileUploadCancelled"})})},_onUploadComplete:function(e,t,n,i){var r=e.data.self,o,s;if(i.success){s=r.$uploader.fineUploader("getKey",t);o=[r.__settings.uploaderConfig.s3_url,"/",s].join("");r.$el.trigger({type:"fileUploaded",uploadStartTime:r.uploadStartTime,fileData:{s3Key:s,url:o,fileName:n}})}else{r.$el.trigger({type:"fileUploadFailed",uploadStartTime:r.uploadStartTime})}}});SM.FileUploadQuestion=SM.Widgets.register({__NAME:"fileUploadQuestion",_uploaderConfig:null,_uploadAreaTemplateId:null,_$fileUploadContainer:null,_$fileUploadBtn:null,_$fileUploadFileName:null,_$uploadTrigger:null,_validationMessage:null,_$uploader:null,_uploadStartTime:null,__init:function(e){this._uploaderConfig=e.uploaderConfig;this._uploadAreaTemplateId=e.uploadAreaTemplateId;this._initMembers();this._initHandlers()},_initHandlers:function(){var e=this;if(SM.Touch.isTouchDevice()){this._handleMobileUploads();this._$uploadTrigger=this._getMobileUploadTrigger();this._$uploadTrigger.text(this._$fileUploadContainer.find("#chooseFileText").val())}else{this._$uploadTrigger=this._$fileUploadBtn;this._handlePCUploads()}this._$fileUploadContainer.find(".file-upload-clear-btn").on("click",function(t){e._onClear(t)})},_getErrorMessages:function(){var e=$.extend({},FileUploadMessages.Errors);e.typeError=this._validationMessage;return e},_initMembers:function(){this._$fileUploadContainer=this.$el.find(".file-upload-container");this._$fileUploadBtn=this._$fileUploadContainer.find(".file-upload-btn");this._$fileUploadFileName=this._$fileUploadContainer.find(".question-fileupload-filename");this._validationMessage=this._$fileUploadContainer.find("#fileTypeValidationMsg").val();this._hasAutoScroll=$.find("html.auto-scroll").length==1},_resetControls:function(){this._$fileUploadFileName.removeClass("success failure").removeAttr("aria-invalid").show();this._$fileUploadContainer.find(".upload-status").removeClass("sm-spin spin-tiny");this._$fileUploadBtn.find("input[type=file]").removeAttr("disabled")},_getMobileUploadTrigger:function(){return this._$fileUploadBtn.find(".mobile-upload-button")},_resetMobileUploader:function(e){if(this._$uploader){this._$uploader.fineUploader("reset");this._$uploadTrigger=this._getMobileUploadTrigger();this._$uploadTrigger.text(e)}},_onUpload:function(){this._$fileUploadContainer.find(".upload-status").addClass("sm-spin spin-tiny");this._$fileUploadFileName.removeClass("success failure").removeAttr("aria-invalid").hide();this._$fileUploadContainer.find(".file-upload-clear-btn").hide()},_onUploadSuccess:function(e,t){this._resetControls();this._$fileUploadFileName.addClass("success").text(e);this._$fileUploadContainer.find(".file-upload-clear-btn").show();this._$fileUploadContainer.find(".file_name").val(t);this._$fileUploadContainer.find(".original_file_name").val(e);this._$uploadTrigger.text(FileUploadMessages.Defaults.Replace);this._$uploadTrigger.attr("aria-describedby",this._$fileUploadBtn.attr("data-replace-id"));if(this._hasAutoScroll){var n=this._$fileUploadFileName.closest("div.question-row"),i=n.find("button.new-button");if(i.length>0){i.removeClass("hide")}}},_onUploadFailure:function(e){this._resetControls();this._$fileUploadFileName.addClass("failure").attr("aria-invalid",true).text(e);this._$fileUploadContainer.find(".file-upload-clear-btn").hide();this._$uploadTrigger.text(FileUploadMessages.Defaults.Choose);this._$uploadTrigger.attr("aria-describedby",this._$fileUploadBtn.attr("data-choose-id"))},_onClear:function(e){e.preventDefault();this._$fileUploadFileName.removeClass("success failure").text(FileUploadMessages.Defaults.FileName);this._$uploadTrigger.text(FileUploadMessages.Defaults.Choose);this._$uploadTrigger.attr("aria-describedby",this._$fileUploadBtn.attr("data-choose-id"));this._$fileUploadContainer.find(".file_name").val("");this._$fileUploadContainer.find(".original_file_name").val("");$(e.target).hide();if(this._hasAutoScroll){var t=this._$fileUploadFileName.closest("div.question-row"),n=t.find("button.new-button");if(n.length>0){n.removeClass("hide")}}},_getErrorType:function(e){errorType="unknownError";$.each(this._getErrorMessages(),function(t,n){if(n==e){errorType=t}});return errorType},_reportFailure:function(e,t,n,i){$.post("/r/s3/failure",{type:e,name:t,message:n,object_id:i})},_handleMobileUploads:function(){var e=this._$fileUploadContainer.find("#allowedFileTypes").val().split(","),t=this;this._$fileUploadBtn.removeClass("btn");this._$fileUploadContainer.addClass("touch");this._$uploader=SM.FileUploadUtil.getUploader(this._uploaderConfig,{template:"mobile_uploader",messages:this._getErrorMessages(),itemLimit:2,validation:{allowedExtensions:e},container:this._$fileUploadBtn});this._$uploader.on("complete",function(e,n,i,r){var o,s;if(r.success){s=t._$uploader.fineUploader("getKey",n);o=[t.__settings.uploaderConfig.s3_url,"/",s].join("");t._onUploadSuccess(i,qq.s3.util.getBucket(o)+"/"+s);t._resetMobileUploader(FileUploadMessages.Defaults.Replace)}else{t._onUploadFailure(FileUploadMessages.Errors.Default);t._resetMobileUploader(FileUploadMessages.Defaults.Choose)}}).on("upload",function(){t._onUpload();t._$fileUploadContainer.find("input[type=file]").attr("disabled","true")}).on("error",function(e,n,i,r,o){var s=t._$uploader.fineUploader("getKey",n);t._reportFailure(t._getErrorType(r),i,r,s);t._onUploadFailure(r);t._resetMobileUploader(FileUploadMessages.Defaults.Choose)}).on("validate",function(){var e=t._$uploader.fineUploader("getUploads"),n;for(n=0;n<e.length;n++){if(e[n].status==="uploading"){t._$uploader.fineUploader("cancel",e[n].id)}}})},_handlePCUploads:function(){var e=this;this._$fileUploadBtn.on("click",function(t){var n=e._$fileUploadContainer.find("#allowedFileTypes").val().split(",");t.preventDefault();dialog=SM.Views.create(SM.SurveyFilesDialogView,{uploadAreaTemplateId:e._uploadAreaTemplateId,uploaderConfig:e._uploaderConfig,fileTypes:n,errorMessages:e._getErrorMessages()});dialog.$el.on("fileUploaded",function(t){if(t.uploadStartTime&&t.uploadStartTime!==e._uploadStartTime){return}fileKey=qq.s3.util.getBucket(t.fileData.url)+"/"+t.fileData.s3Key;e._onUploadSuccess(t.fileData.fileName,fileKey)}).on("fileUploadInProgress",function(t){e._uploadStartTime=t.uploadStartTime;e._onUpload()}).on("fileUploadFailed",function(){e._onUploadFailure(FileUploadMessages.Errors.Default)}).on("fileUploadError",function(t){if(t.uploadStartTime&&t.uploadStartTime!==e._uploadStartTime){return}e._onUploadFailure(t.errorData.message);e._reportFailure(e._getErrorType(t.errorData.message),t.errorData.name,t.errorData.message,t.errorData.s3Key)}).on("fileUploadCancelled",function(t){e._onUploadFailure(FileUploadMessages.Errors.Default)});dialog.open()}).on("keypress",function(t){if(t.keyCode===SM.KeyCodes.ENTER){e._$fileUploadBtn.click()}})}});